<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>متجر إلكتروني بسيط</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDKs -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-analytics.js";
        import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc, setDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";
        
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBRpvVBXQbc64JGVqNrbWJjXQfghLrAo3A",
            authDomain: "tchostore-60692.firebaseapp.com",
            databaseURL: "https://tchostore-60692-default-rtdb.firebaseio.com",
            projectId: "tchostore-60692",
            storageBucket: "tchostore-60692.firebasestorage.app",
            messagingSenderId: "817311903763",
            appId: "1:817311903763:web:9f5e5548ecce712a640fe6",
            measurementId: "G-BN5W2742Q8"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.firebaseApp = app;
        window.firebaseDb = db;
        window.firebaseAnalytics = analytics;
        window.firebaseFirestore = { collection, addDoc, getDocs, doc, updateDoc, deleteDoc, setDoc };
    </script>
    <!-- Google Sites Compatibility -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <style>
        /* Basic Reset */
        * {
            box-sizing: border-box;
        }
        
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            overflow-x: hidden;
        }
    </style>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f8f9fa;
            scroll-behavior: smooth;
        }
        
        .menu-overlay {
            transform: translateX(100%);
            transition: transform 0.3s ease-in-out;
            position: fixed;
            top: 0;
            right: 0;
            height: 100vh;
            width: 280px;
            max-width: 80vw;
            background: white;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            z-index: 1001;
        }
        
        .menu-overlay.active {
            transform: translateX(0);
        }
        
        .product-card {
            transition: all 0.3s ease;
            border-radius: 16px;
            overflow: hidden;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .product-image-container {
            position: relative;
            overflow: hidden;
            height: 300px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .product-image {
            width: 100%;
            height: 100%;
            object-fit: contain;
            transition: transform 0.3s ease;
            background: white;
        }

        .product-card:hover .product-image {
            transform: scale(1.1);
        }

        .discount-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(255, 107, 107, 0.3);
        }

        .product-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .badge-new {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .badge-hot {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .product-content {
            padding: 20px;
        }

        .product-title {
            font-size: 20px;
            font-weight: 800;
            color: #1f2937;
            margin-bottom: 8px;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            font-family: 'Tajawal', sans-serif;
            letter-spacing: -0.025em;
        }

        .product-description {
            color: #6b7280;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 16px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .product-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            font-size: 12px;
            color: #9ca3af;
        }

        .rating-stars {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .star {
            color: #fbbf24;
            font-size: 14px;
        }

        .price-section {
            margin-bottom: 20px;
        }

        .current-price {
            font-size: 28px;
            font-weight: 900;
            color: #3b82f6;
            margin-bottom: 4px;
            font-family: 'Tajawal', sans-serif;
            letter-spacing: -0.025em;
        }

        .price-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .original-price {
            font-size: 16px;
            color: #9ca3af;
            text-decoration: line-through;
        }

        .savings {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .stock-info {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .stock-available {
            color: #10b981;
        }

        .stock-low {
            color: #f59e0b;
        }

        .stock-out {
            color: #ef4444;
        }

        .product-actions {
            display: flex;
            gap: 8px;
        }

        .btn-primary {
            flex: 1;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }

        .btn-primary:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 15px rgba(59, 130, 246, 0.4);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 8px 15px rgba(59, 130, 246, 0.4);
            }
            50% {
                box-shadow: 0 8px 25px rgba(59, 130, 246, 0.6);
            }
            100% {
                box-shadow: 0 8px 15px rgba(59, 130, 246, 0.4);
            }
        }

        .btn-primary:active {
            transform: translateY(-1px) scale(1.01);
            transition: all 0.1s ease;
        }

        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-secondary {
            background: white;
            color: #6b7280;
            border: 2px solid #e5e7eb;
            padding: 12px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-secondary:hover {
            border-color: #3b82f6;
            color: #3b82f6;
            transform: translateY(-2px);
        }

        .wishlist-active {
            border-color: #ef4444 !important;
            color: #ef4444 !important;
            background: #fef2f2 !important;
        }

        .admin-panel {
            display: none;
        }
        
        .admin-panel.active {
            display: block;
        }
        
        .order-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1000;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
            padding: 16px;
        }
        
        .order-modal.active {
            display: flex;
        }
        
        .order-modal-content {
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            width: 100%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalFadeIn 0.3s ease-out;
        }
        
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            overflow: hidden;
            background: white;
        }
        
        .quantity-btn {
            background-color: #f9fafb;
            border: none;
            padding: 12px 16px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-weight: 600;
            color: #374151;
        }
        
        .quantity-btn:hover {
            background-color: #e5e7eb;
        }
        
        .quantity-input {
            width: 60px;
            text-align: center;
            border: none;
            border-right: 1px solid #e5e7eb;
            border-left: 1px solid #e5e7eb;
            padding: 12px 8px;
            font-weight: 600;
            color: #374151;
        }
        
        .quantity-input:focus {
            outline: none;
        }

        .admin-tabs {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            margin-bottom: 1.5rem;
            overflow-x: auto;
        }

        .admin-tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .admin-tab.active {
            border-bottom-color: #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }

        .admin-tab:hover {
            background-color: #f3f4f6;
        }

        .admin-content {
            display: none;
        }

        .admin-content.active {
            display: block;
        }

        .image-preview {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 0.5rem;
            border: 2px solid #e5e7eb;
            position: relative;
        }

        .image-preview-container {
            position: relative;
            display: inline-block;
        }

        .remove-image-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            z-index: 10;
        }

        .remove-image-btn:hover {
            background: #dc2626;
        }

        .product-image-gallery {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .image-indicators {
            position: absolute;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
            z-index: 5;
        }

        .indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .indicator.active {
            background: white;
            transform: scale(1.2);
        }

        .image-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.5);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 5;
        }

        .product-card:hover .image-nav {
            opacity: 1;
        }

        .image-nav:hover {
            background: rgba(0, 0, 0, 0.7);
        }

        .prev-btn {
            left: 12px;
        }

        .next-btn {
            right: 12px;
        }

        .product-preview-btn {
            position: absolute;
            bottom: 12px;
            right: 12px;
            background: rgba(59, 130, 246, 0.9);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            z-index: 5;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .product-card:hover .product-preview-btn {
            opacity: 1;
            transform: translateY(0);
        }

        .product-preview-btn:hover {
            background: rgba(59, 130, 246, 1);
            transform: translateY(-2px);
        }

        .product-preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 2000;
            background-color: rgba(0, 0, 0, 0.8);
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .product-preview-modal.active {
            display: flex;
        }

        .product-preview-content {
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            animation: modalFadeIn 0.3s ease-out;
        }

        .preview-image-gallery {
            position: relative;
            height: 400px;
            overflow: hidden;
            border-radius: 16px 16px 0 0;
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .preview-main-image {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            transition: transform 0.3s ease;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .preview-discount-badge {
            position: absolute;
            top: 16px;
            right: 16px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
            z-index: 10;
        }

        .preview-price-section {
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
            padding: 20px;
            border-radius: 0 0 16px 16px;
            border-top: 1px solid #e5e7eb;
        }

        .preview-current-price {
            font-size: 32px;
            font-weight: 900;
            color: #3b82f6;
            margin-bottom: 8px;
            font-family: 'Tajawal', sans-serif;
            letter-spacing: -0.025em;
        }

        .preview-price-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .preview-original-price {
            font-size: 18px;
            color: #9ca3af;
            text-decoration: line-through;
        }

        .preview-savings {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 13px;
            font-weight: 600;
        }

        .preview-order-btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            animation: pulse-order 2s infinite;
        }

        .preview-order-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .preview-order-btn:hover::before {
            left: 100%;
        }

        .preview-order-btn:hover {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
        }

        .preview-order-btn:active {
            transform: translateY(-1px) scale(1.02);
        }

        @keyframes pulse-order {
            0% {
                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            }
            50% {
                box-shadow: 0 8px 25px rgba(59, 130, 246, 0.5);
            }
            100% {
                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        .preview-thumbnails {
            display: flex;
            gap: 8px;
            padding: 16px;
            overflow-x: auto;
            border-bottom: 1px solid #e5e7eb;
        }

        .preview-thumbnail {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .preview-thumbnail.active {
            border-color: #3b82f6;
        }

        .preview-thumbnail:hover {
            transform: scale(1.05);
        }

        /* تصميم الأقسام الدائرية */
        .category-circle {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            padding: 16px;
            border-radius: 16px;
        }

        .category-circle:hover {
            transform: translateY(-8px);
            background: linear-gradient(135deg, #f8fafc, #e2e8f0);
        }

        .category-icon-container {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .category-icon-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(45deg);
            transition: all 0.6s ease;
            opacity: 0;
        }

        .category-circle:hover .category-icon-container::before {
            opacity: 1;
            transform: rotate(45deg) translate(50%, 50%);
        }

        .category-circle:hover .category-icon-container {
            transform: scale(1.1);
            box-shadow: 0 12px 35px rgba(59, 130, 246, 0.4);
        }

        .category-icon {
            font-size: 32px;
            color: white;
            z-index: 2;
            position: relative;
        }

        .category-name {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .category-count {
            font-size: 12px;
            color: #6b7280;
            background: #f3f4f6;
            padding: 2px 8px;
            border-radius: 12px;
        }

        /* ألوان متدرجة مختلفة للأقسام */
        .category-circle:nth-child(1) .category-icon-container {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .category-circle:nth-child(2) .category-icon-container {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .category-circle:nth-child(3) .category-icon-container {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .category-circle:nth-child(4) .category-icon-container {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .category-circle:nth-child(5) .category-icon-container {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .category-circle:nth-child(6) .category-icon-container {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
        }

        @media (max-width: 768px) {
            .category-icon-container {
                width: 60px;
                height: 60px;
            }

            .category-icon {
                font-size: 24px;
            }

            .category-name {
                font-size: 12px;
            }

            .category-count {
                font-size: 10px;
            }

            .category-circle {
                padding: 12px;
            }
        }

        /* Container Styles */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding-left: 1rem;
            padding-right: 1rem;
        }
        
        section {
            width: 100%;
        }
        
        header, main, section, footer {
            position: relative;
            z-index: 1;
        }
        
        .fixed {
            position: fixed;
        }
        
        /* تحسينات الجوال */
        @media (max-width: 768px) {
            .container {
                padding-left: 16px;
                padding-right: 16px;
            }

            .product-card {
                margin-bottom: 16px;
            }

            .product-image-container {
                height: 180px;
            }

            .product-content {
                padding: 16px;
            }

            .product-title {
                font-size: 16px;
            }

            .current-price {
                font-size: 20px;
            }

            .btn-primary {
                padding: 10px 12px;
                font-size: 13px;
            }

            .btn-secondary {
                padding: 10px;
            }

            .order-modal-content {
                margin: 8px;
                max-height: 95vh;
            }

            .admin-tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .admin-tab {
                padding: 0.5rem 1rem;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .product-actions {
                flex-direction: column;
            }

            .btn-secondary {
                order: -1;
                margin-bottom: 8px;
            }

            .price-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }
        }

        /* تحسين القائمة المنبثقة للجوال */
        .menu-overlay {
            width: 280px;
            max-width: 80vw;
        }

        @media (max-width: 480px) {
            .menu-overlay {
                width: 100vw;
                max-width: 100vw;
            }
        }

        /* Modal Styles */
        .order-modal,
        .product-preview-modal,
        .admin-panel,
        #adminLoginModal,
        #wishlistModal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 999999;
        }
        
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999998;
        }
        
        /* نظام الإشعارات */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 20px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 999999;
            transform: translateX(400px);
            transition: all 0.3s ease;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 300px;
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .notification.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .notification.warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .notification.info {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
        }

        .notification-icon {
            font-size: 20px;
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-size: 14px;
            font-weight: 700;
            margin-bottom: 2px;
        }

        .notification-message {
            font-size: 13px;
            opacity: 0.9;
        }

        .notification-close {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .notification-close:hover {
            opacity: 1;
            background: rgba(255, 255, 255, 0.1);
        }

        @media (max-width: 480px) {
            .notification {
                right: 10px;
                left: 10px;
                min-width: auto;
                max-width: none;
                transform: translateY(-100px);
            }

            .notification.show {
                transform: translateY(0);
            }
        }
        
        /* Touch Device Optimizations */
        .btn-primary,
        .btn-secondary,
        button {
            min-height: 44px;
            min-width: 44px;
        }
        
        .product-card {
            cursor: pointer;
        }
        
        /* Prevent zoom on input focus in iOS Safari */
        @media screen and (-webkit-min-device-pixel-ratio: 0) {
            input[type="text"],
            input[type="email"],
            input[type="tel"],
            input[type="number"],
            textarea,
            select {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>

    <!-- هيدر مع قائمة منبثقة -->
    <header class="bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center">
                <h1 class="text-xl md:text-2xl font-bold">متجر الأناقة</h1>
            </div>
            
            <div class="flex items-center space-x-4 space-x-reverse">
                <button id="menuBtn" class="text-xl p-2 hover:bg-blue-500 rounded-lg transition">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- القائمة المنبثقة -->
    <div id="menuOverlay" class="menu-overlay">
        <div class="p-6 flex justify-between items-center border-b bg-gradient-to-r from-blue-50 to-blue-100">
            <h2 class="text-xl font-bold text-blue-600">القائمة</h2>
            <button id="closeMenu" class="text-gray-500 hover:text-gray-700 p-2 hover:bg-gray-200 rounded-lg transition">
                <i class="fas fa-times text-lg"></i>
            </button>
        </div>
        <nav class="p-6">
            <ul class="space-y-2">
                <li>
                    <a href="#home" class="menu-link flex items-center py-3 px-4 hover:bg-blue-50 rounded-lg transition group">
                        <i class="fas fa-home ml-3 text-blue-600 group-hover:text-blue-700"></i>
                        <span class="font-medium">الرئيسية</span>
                    </a>
                </li>
                <li>
                    <a href="#products" class="menu-link flex items-center py-3 px-4 hover:bg-blue-50 rounded-lg transition group">
                        <i class="fas fa-shopping-bag ml-3 text-blue-600 group-hover:text-blue-700"></i>
                        <span class="font-medium">المنتجات</span>
                    </a>
                </li>
                <li>
                    <a href="#features" class="menu-link flex items-center py-3 px-4 hover:bg-blue-50 rounded-lg transition group">
                        <i class="fas fa-star ml-3 text-blue-600 group-hover:text-blue-700"></i>
                        <span class="font-medium">المميزات</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="adminLink" class="flex items-center py-3 px-4 hover:bg-blue-50 rounded-lg transition group">
                        <i class="fas fa-cog ml-3 text-blue-600 group-hover:text-blue-700"></i>
                        <span class="font-medium">الإدارة</span>
                        <i class="fas fa-lock text-xs text-gray-400 mr-2"></i>
                    </a>
                </li>
                <li>
                    <a href="#about" class="menu-link flex items-center py-3 px-4 hover:bg-blue-50 rounded-lg transition group">
                        <i class="fas fa-info-circle ml-3 text-blue-600 group-hover:text-blue-700"></i>
                        <span class="font-medium">من نحن</span>
                    </a>
                </li>
                <li>
                    <a href="#" id="wishlistLink" class="flex items-center py-3 px-4 hover:bg-blue-50 rounded-lg transition group">
                        <i class="fas fa-heart ml-3 text-blue-600 group-hover:text-blue-700"></i>
                        <span class="font-medium">المنتجات المفضلة</span>
                        <span id="wishlistCount" class="bg-red-500 text-white text-xs rounded-full px-2 py-1 mr-2 hidden">0</span>
                    </a>
                </li>
                <li>
                    <a href="#contact" class="menu-link flex items-center py-3 px-4 hover:bg-blue-50 rounded-lg transition group">
                        <i class="fas fa-envelope ml-3 text-blue-600 group-hover:text-blue-700"></i>
                        <span class="font-medium">اتصل بنا</span>
                    </a>
                </li>
            </ul>
        </nav>
    </div>

    <!-- الغطاء عند فتح القائمة -->
    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden"></div>

    <!-- نافذة تسجيل الدخول للإدارة -->
    <div id="adminLoginModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all" id="loginModalContent">
            <div class="p-8">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-shield-alt text-blue-600 text-2xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">تسجيل الدخول للإدارة</h3>
                    <p class="text-gray-600">يرجى إدخال بيانات الدخول للوصول إلى لوحة الإدارة</p>
                </div>
                
                <form id="adminLoginForm" class="space-y-4">
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">اسم المستخدم</label>
                        <div class="relative">
                            <input type="text" id="adminUsername" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-12" placeholder="أدخل اسم المستخدم" required>
                            <i class="fas fa-user absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 mb-2 font-medium">كلمة المرور</label>
                        <div class="relative">
                            <input type="password" id="adminPassword" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 pr-12" placeholder="أدخل كلمة المرور" required>
                            <i class="fas fa-lock absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                        </div>
                    </div>
                    
                    <div id="loginError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm">
                        <i class="fas fa-exclamation-triangle ml-2"></i>
                        <span>اسم المستخدم أو كلمة المرور غير صحيحة</span>
                    </div>
                    
                    <div class="flex gap-3 pt-4">
                        <button type="submit" class="flex-1 bg-blue-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-blue-700 transition-colors">
                            <i class="fas fa-sign-in-alt ml-2"></i>
                            دخول
                        </button>
                        <button type="button" id="cancelAdminLogin" class="flex-1 bg-gray-200 text-gray-800 px-6 py-3 rounded-xl font-semibold hover:bg-gray-300 transition-colors">
                            إلغاء
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- لوحة الإدارة -->
    <div id="adminPanel" class="admin-panel fixed inset-0 bg-white z-50 overflow-auto">
        <div class="container mx-auto px-4 py-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                <h2 class="text-2xl font-bold text-blue-600">لوحة الإدارة</h2>
                <div class="flex flex-wrap items-center gap-2">
                    <button id="exportData" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition text-sm">
                        <i class="fas fa-download ml-2"></i>تصدير البيانات
                    </button>
                    <button id="importData" class="bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 transition text-sm">
                        <i class="fas fa-upload ml-2"></i>استيراد البيانات
                    </button>
                    <input type="file" id="importFile" accept=".json" style="display: none;">
                    <button id="closeAdmin" class="text-gray-500 hover:text-gray-700 text-xl p-2">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <!-- التبويبات -->
            <div class="admin-tabs">
                <div class="admin-tab active" data-tab="products">
                    <i class="fas fa-box ml-2"></i>إدارة المنتجات
                </div>
                <div class="admin-tab" data-tab="categories">
                    <i class="fas fa-tags ml-2"></i>إدارة الأقسام
                </div>
                <div class="admin-tab" data-tab="discounts">
                    <i class="fas fa-percent ml-2"></i>إدارة التخفيضات
                </div>
                <div class="admin-tab" data-tab="database">
                    <i class="fas fa-database ml-2"></i>قاعدة البيانات
                </div>
                <div class="admin-tab" data-tab="settings">
                    <i class="fas fa-cog ml-2"></i>الإعدادات
                </div>
            </div>

            <!-- محتوى إدارة المنتجات -->
            <div id="products-content" class="admin-content active">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- إضافة/تعديل منتج -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold mb-4 text-blue-600" id="productFormTitle">إضافة منتج جديد</h3>
                        <form id="productForm">
                            <input type="hidden" id="editProductId">
                            
                            <!-- الصور -->
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">صور المنتج</label>
                                <input type="file" id="productImages" accept="image/*" multiple class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <small class="text-gray-500">يمكنك اختيار عدة صور (الحد الأقصى 5 صور)</small>
                                <div id="imagesPreview" class="mt-3 grid grid-cols-2 md:grid-cols-3 gap-3 hidden">
                                    <!-- سيتم عرض الصور هنا -->
                                </div>
                            </div>
                            
                            <!-- المعلومات الأساسية -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-700 mb-2">اسم المنتج *</label>
                                    <input type="text" id="productName" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">القسم *</label>
                                    <select id="productCategory" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                                        <option value="">اختر القسم</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- الكود بار -->
                            <div class="mb-4">
                                <div class="flex items-center mb-2">
                                    <input type="checkbox" id="enableBarcode" class="ml-2">
                                    <label class="text-gray-700 font-medium">إضافة كود بار</label>
                                </div>
                                <div id="barcodeSection" class="hidden">
                                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-gray-700 mb-2">الكود بار</label>
                                            <input type="text" id="productBarcode" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="سيتم إنشاؤه تلقائياً">
                                        </div>
                                        <div class="flex items-end">
                                            <button type="button" id="generateBarcode" class="bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition">
                                                <i class="fas fa-barcode ml-2"></i>إنشاء تلقائي
                                            </button>
                                        </div>
                                    </div>
                                    <small class="text-gray-500">يمكنك إدخال كود بار مخصص أو إنشاؤه تلقائياً</small>
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">وصف المنتج *</label>
                                <textarea id="productDesc" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3" required></textarea>
                            </div>
                            
                            <!-- السعر والتخفيض -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div>
                                    <label class="block text-gray-700 mb-2">السعر الأساسي *</label>
                                    <input type="number" id="productPrice" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required min="0" step="0.01">
                                </div>
                                <div>
                                    <label class="block text-gray-700 mb-2">نسبة التخفيض (%)</label>
                                    <input type="number" id="productDiscount" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" min="0" max="100" step="1">
                                </div>
                                <div>
                                    <div class="flex items-center mb-2">
                                        <input type="checkbox" id="enableStock" class="ml-2">
                                        <label class="text-gray-700 font-medium">تتبع الكمية المتوفرة</label>
                                    </div>
                                    <div id="stockSection" class="hidden">
                                        <input type="number" id="productStock" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" min="0" placeholder="أدخل الكمية">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- خصائص إضافية -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                                <div>
                                    <div class="flex items-center mb-2">
                                        <input type="checkbox" id="enableBrand" class="ml-2">
                                        <label class="text-gray-700 font-medium">إضافة العلامة التجارية</label>
                                    </div>
                                    <div id="brandSection" class="hidden">
                                        <input type="text" id="productBrand" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="أدخل العلامة التجارية">
                                    </div>
                                </div>
                                <div>
                                    <div class="flex items-center mb-2">
                                        <input type="checkbox" id="enableModel" class="ml-2">
                                        <label class="text-gray-700 font-medium">إضافة الموديل</label>
                                    </div>
                                    <div id="modelSection" class="hidden">
                                        <input type="text" id="productModel" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="أدخل الموديل">
                                    </div>
                                </div>
                            </div>

                            <!-- خصائص المنتج المتقدمة -->
                            <div class="mb-6 p-4 border rounded-lg bg-gray-50">
                                <h4 class="text-lg font-bold mb-4 text-gray-700">خصائص المنتج</h4>
                                
                                <!-- الألوان -->
                                <div class="mb-4">
                                    <label class="flex items-center mb-2">
                                        <input type="checkbox" id="enableColors" class="ml-2">
                                        <span class="text-gray-700 font-medium">الألوان المتاحة</span>
                                    </label>
                                    <div id="colorsSection" class="hidden">
                                        <input type="text" id="productColors" placeholder="أحمر, أزرق, أخضر" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <small class="text-gray-500">اكتب الألوان مفصولة بفاصلة</small>
                                    </div>
                                </div>

                                <!-- المقاسات -->
                                <div class="mb-4">
                                    <label class="flex items-center mb-2">
                                        <input type="checkbox" id="enableSizes" class="ml-2">
                                        <span class="text-gray-700 font-medium">المقاسات المتاحة</span>
                                    </label>
                                    <div id="sizesSection" class="hidden">
                                        <input type="text" id="productSizes" placeholder="S, M, L, XL" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <small class="text-gray-500">اكتب المقاسات مفصولة بفاصلة</small>
                                    </div>
                                </div>

                                <!-- التوصيل -->
                                <div class="mb-4">
                                    <label class="flex items-center mb-2">
                                        <input type="checkbox" id="enableShipping" class="ml-2">
                                        <span class="text-gray-700 font-medium">معلومات التوصيل</span>
                                    </label>
                                    <div id="shippingSection" class="hidden">
                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-3">
                                            <div>
                                                <label class="block text-gray-700 mb-1">تكلفة التوصيل</label>
                                                <input type="number" id="shippingCost" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" min="0" step="0.01">
                                            </div>
                                            <div>
                                                <label class="block text-gray-700 mb-1">مدة التوصيل</label>
                                                <input type="text" id="shippingTime" placeholder="2-3 أيام" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="block text-gray-700 mb-1">تفاصيل التوصيل</label>
                                            <textarea id="shippingDetails" placeholder="تفاصيل إضافية عن التوصيل..." class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2"></textarea>
                                        </div>
                                        <div>
                                            <label class="flex items-center">
                                                <input type="checkbox" id="freeShipping" class="ml-2">
                                                <span class="text-gray-700">توصيل مجاني</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- إعادة المنتج -->
                                <div class="mb-4">
                                    <label class="flex items-center mb-2">
                                        <input type="checkbox" id="enableReturn" class="ml-2">
                                        <span class="text-gray-700 font-medium">سياسة الإرجاع</span>
                                    </label>
                                    <div id="returnSection" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-gray-700 mb-1">مدة الإرجاع (أيام)</label>
                                            <input type="number" id="returnDays" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" min="1" max="365" value="14">
                                        </div>
                                        <div>
                                            <label class="flex items-center">
                                                <input type="checkbox" id="freeReturn" class="ml-2">
                                                <span class="text-gray-700">إرجاع مجاني</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- الضمان -->
                                <div class="mb-4">
                                    <label class="flex items-center mb-2">
                                        <input type="checkbox" id="enableWarranty" class="ml-2">
                                        <span class="text-gray-700 font-medium">الضمان</span>
                                    </label>
                                    <div id="warrantySection" class="hidden">
                                        <div class="mb-3">
                                            <label class="block text-gray-700 mb-1">مدة الضمان</label>
                                            <input type="text" id="warrantyPeriod" placeholder="سنة واحدة" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        </div>
                                        <div>
                                            <label class="block text-gray-700 mb-1">تفاصيل الضمان</label>
                                            <textarea id="warrantyDetails" placeholder="تفاصيل الضمان وشروطه..." class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2"></textarea>
                                        </div>
                                    </div>
                                </div>

                                <!-- المواصفات التقنية -->
                                <div class="mb-4">
                                    <label class="flex items-center mb-2">
                                        <input type="checkbox" id="enableSpecs" class="ml-2">
                                        <span class="text-gray-700 font-medium">المواصفات التقنية</span>
                                    </label>
                                    <div id="specsSection" class="hidden">
                                        <textarea id="productSpecs" placeholder="الوزن: 500 جرام&#10;الأبعاد: 20x15x5 سم&#10;المادة: بلاستيك عالي الجودة" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="4"></textarea>
                                        <small class="text-gray-500">اكتب كل مواصفة في سطر منفصل</small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- حالة المنتج -->
                            <div class="mb-4">
                                <label class="flex items-center">
                                    <input type="checkbox" id="productActive" class="ml-2" checked>
                                    <span class="text-gray-700">منتج نشط (يظهر في المتجر)</span>
                                </label>
                            </div>
                            
                            <div class="flex flex-col md:flex-row gap-4">
                                <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition flex-1">
                                    <span id="submitBtnText">إضافة المنتج</span>
                                </button>
                                <button type="button" id="cancelEdit" class="bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600 transition hidden">
                                    إلغاء
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- إحصائيات سريعة -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold mb-4 text-blue-600">إحصائيات سريعة</h3>
                        <div class="space-y-4">
                            <div class="flex justify-between items-center p-3 bg-blue-50 rounded">
                                <span>إجمالي المنتجات</span>
                                <span class="font-bold text-blue-600" id="totalProducts">0</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-green-50 rounded">
                                <span>المنتجات النشطة</span>
                                <span class="font-bold text-green-600" id="activeProducts">0</span>
                            </div>
                            <div class="flex justify-between items-center p-3 bg-red-50 rounded">
                                <span>المنتجات المخفضة</span>
                                <span class="font-bold text-red-600" id="discountedProducts">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- جدول المنتجات -->
                <div class="mt-8 bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="p-4 border-b flex justify-between items-center">
                        <h3 class="text-xl font-bold text-blue-600">المنتجات الحالية</h3>
                        <span id="productsCount" class="text-gray-600">0 منتج</span>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-right">الصورة</th>
                                    <th class="px-4 py-3 text-right">اسم المنتج</th>
                                    <th class="px-4 py-3 text-right">القسم</th>
                                    <th class="px-4 py-3 text-right">الكود بار</th>
                                    <th class="px-4 py-3 text-right">السعر</th>
                                    <th class="px-4 py-3 text-right">التخفيض</th>
                                    <th class="px-4 py-3 text-right">الكمية</th>
                                    <th class="px-4 py-3 text-right">الحالة</th>
                                    <th class="px-4 py-3 text-right">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="productsTableBody">
                                <!-- سيتم ملء المنتجات هنا -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- محتوى إدارة الأقسام -->
            <div id="categories-content" class="admin-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- إضافة/تعديل قسم -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold mb-4 text-blue-600" id="categoryFormTitle">إضافة قسم جديد</h3>
                        <form id="categoryForm">
                            <input type="hidden" id="editCategoryId">
                            
                            <!-- صورة القسم -->
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">صورة القسم</label>
                                <input type="file" id="categoryImage" accept="image/*" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <small class="text-gray-500">اختر صورة للقسم (اختياري)</small>
                                <div id="categoryImagePreview" class="mt-3 hidden">
                                    <!-- سيتم عرض الصورة هنا -->
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">اسم القسم *</label>
                                <input type="text" id="categoryName" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">وصف القسم</label>
                                <textarea id="categoryDesc" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3"></textarea>
                                <small class="text-gray-500">وصف مختصر للقسم (اختياري)</small>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">أيقونة القسم</label>
                                <input type="text" id="categoryIcon" placeholder="fas fa-laptop" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <small class="text-gray-500">استخدم أيقونات Font Awesome (اختياري)</small>
                            </div>
                            
                            <div class="mb-4">
                                <label class="flex items-center">
                                    <input type="checkbox" id="categoryActive" class="ml-2" checked>
                                    <span class="text-gray-700">قسم نشط</span>
                                </label>
                            </div>
                            
                            <div class="flex flex-col md:flex-row gap-4">
                                <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition flex-1">
                                    <span id="categorySubmitBtnText">إضافة القسم</span>
                                </button>
                                <button type="button" id="cancelCategoryEdit" class="bg-gray-500 text-white px-6 py-2 rounded-md hover:bg-gray-600 transition hidden">
                                    إلغاء
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- إحصائيات الأقسام -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold mb-4 text-blue-600">إحصائيات الأقسام</h3>
                        <div id="categoryStats" class="space-y-4">
                            <!-- سيتم ملء الإحصائيات هنا -->
                        </div>
                    </div>
                </div>
                
                <!-- جدول الأقسام -->
                <div class="mt-8 bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="p-4 border-b">
                        <h3 class="text-xl font-bold text-blue-600">الأقسام الحالية</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-right">الصورة</th>
                                    <th class="px-4 py-3 text-right">الأيقونة</th>
                                    <th class="px-4 py-3 text-right">اسم القسم</th>
                                    <th class="px-4 py-3 text-right">الوصف</th>
                                    <th class="px-4 py-3 text-right">عدد المنتجات</th>
                                    <th class="px-4 py-3 text-right">الحالة</th>
                                    <th class="px-4 py-3 text-right">الإجراءات</th>
                                </tr>
                            </thead>
                            <tbody id="categoriesTableBody">
                                <!-- سيتم ملء الأقسام هنا -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- محتوى إدارة التخفيضات -->
            <div id="discounts-content" class="admin-content">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- تخفيض جماعي -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold mb-4 text-blue-600">تخفيض جماعي</h3>
                        <form id="bulkDiscountForm">
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">اختر القسم</label>
                                <select id="bulkDiscountCategory" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">جميع المنتجات</option>
                                </select>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">نسبة التخفيض (%)</label>
                                <input type="number" id="bulkDiscountPercent" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" min="0" max="100" required>
                            </div>
                            
                            <button type="submit" class="w-full bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700 transition">
                                تطبيق التخفيض
                            </button>
                        </form>
                    </div>
                    
                    <!-- إزالة التخفيضات -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold mb-4 text-blue-600">إزالة التخفيضات</h3>
                        <form id="removeDiscountForm">
                            <div class="mb-4">
                                <label class="block text-gray-700 mb-2">اختر القسم</label>
                                <select id="removeDiscountCategory" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="">جميع المنتجات</option>
                                </select>
                            </div>
                            
                            <button type="submit" class="w-full bg-gray-600 text-white px-6 py-2 rounded-md hover:bg-gray-700 transition">
                                إزالة جميع التخفيضات
                            </button>
                        </form>
                    </div>
                </div>
                
                <!-- المنتجات المخفضة -->
                <div class="mt-8 bg-white rounded-lg shadow-md overflow-hidden">
                    <div class="p-4 border-b">
                        <h3 class="text-xl font-bold text-blue-600">المنتجات المخفضة</h3>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-right">اسم المنتج</th>
                                    <th class="px-4 py-3 text-right">السعر الأصلي</th>
                                    <th class="px-4 py-3 text-right">نسبة التخفيض</th>
                                    <th class="px-4 py-3 text-right">السعر بعد التخفيض</th>
                                    <th class="px-4 py-3 text-right">المبلغ المحفوظ</th>
                                </tr>
                            </thead>
                            <tbody id="discountedProductsBody">
                                <!-- سيتم ملء المنتجات المخفضة هنا -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- محتوى قاعدة البيانات -->
            <div id="database-content" class="admin-content">
                <div class="grid grid-cols-1 gap-8">
                    <!-- إدارة البيانات المحلية -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold mb-6 text-blue-600 flex items-center">
                            <i class="fas fa-database ml-3"></i>إدارة قاعدة البيانات المحلية
                        </h3>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- حفظ البيانات -->
                            <div class="space-y-4">
                                <h4 class="text-lg font-semibold text-gray-700 border-b pb-2">حفظ البيانات</h4>
                                
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <div class="flex items-center mb-3">
                                        <i class="fas fa-save text-green-600 text-xl ml-3"></i>
                                        <div>
                                            <h5 class="font-semibold text-green-800">حفظ تلقائي</h5>
                                            <p class="text-sm text-green-600">يتم حفظ البيانات تلقائياً عند كل تغيير</p>
                                        </div>
                                    </div>
                                    <div class="text-sm text-green-700">
                                        <div>آخر حفظ: <span id="lastSaveTime">-</span></div>
                                        <div>حالة الحفظ: <span id="saveStatus" class="font-medium">محفوظ</span></div>
                                    </div>
                                </div>
                                
                                <button id="manualSave" class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold">
                                    <i class="fas fa-save ml-2"></i>حفظ يدوي للبيانات
                                </button>
                                
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <h5 class="font-semibold text-purple-800 mb-2">حفظ داخل الكود</h5>
                                    <div class="text-sm text-purple-700 space-y-2">
                                        <div>البيانات المحفوظة: <span id="internalDataSize" class="font-medium">0 KB</span></div>
                                        <div>آخر تحديث: <span id="internalLastUpdate" class="font-medium">-</span></div>
                                        <button id="saveToInternalCode" class="w-full bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition text-sm mt-2">
                                            <i class="fas fa-code ml-2"></i>حفظ البيانات داخل الكود
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <h5 class="font-semibold text-blue-800 mb-2">معلومات التخزين</h5>
                                    <div class="text-sm text-blue-700 space-y-1">
                                        <div>المساحة المستخدمة: <span id="storageUsed">0 KB</span></div>
                                        <div>المساحة المتاحة: <span id="storageAvailable">غير محدود</span></div>
                                        <div>نوع التخزين: <span class="font-medium">LocalStorage + Internal</span></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- استيراد وتصدير -->
                            <div class="space-y-4">
                                <h4 class="text-lg font-semibold text-gray-700 border-b pb-2">استيراد وتصدير</h4>
                                
                                <div class="space-y-3">
                                    <button id="importDataFromCode" class="w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold">
                                        <i class="fas fa-database ml-2"></i>استيراد البيانات من الكود
                                    </button>
                                    <p class="text-xs text-gray-500 mt-2 text-center">استيراد جميع البيانات المحفوظة داخل الكود</p>
                                    
                                    <div class="border-t pt-3">
                                        <button id="downloadUpdatedCode" class="w-full bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition font-semibold">
                                            <i class="fas fa-download ml-2"></i>تحميل الكود المحدث
                                        </button>
                                        <p class="text-xs text-gray-500 mt-2 text-center">تحميل الملف مع جميع التعديلات الحالية</p>
                                    </div>
                                    
                                    <div class="border-t pt-3">
                                        <button id="exportToGoogleDrive" class="w-full bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition font-semibold">
                                            <i class="fab fa-google-drive ml-2"></i>نسخ احتياطي لجوجل درايف
                                        </button>
                                        <p class="text-xs text-gray-500 mt-2 text-center">سيتم الحفظ في حساب: ivetchos@gmail.com</p>
                                    </div>
                                </div>
                                
                                <div class="bg-yellow-50 p-4 rounded-lg">
                                    <h5 class="font-semibold text-yellow-800 mb-2">تنبيه مهم</h5>
                                    <p class="text-sm text-yellow-700">
                                        البيانات محفوظة محلياً في المتصفح وداخل الكود. 
                                        استخدم "حفظ داخل الكود" لحفظ دائم حتى بعد النشر.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- إحصائيات قاعدة البيانات -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold mb-6 text-blue-600 flex items-center">
                            <i class="fas fa-chart-bar ml-3"></i>إحصائيات قاعدة البيانات
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-blue-600" id="dbTotalProducts">0</div>
                                <div class="text-sm text-blue-800">إجمالي المنتجات</div>
                            </div>
                            
                            <div class="bg-green-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-green-600" id="dbTotalCategories">0</div>
                                <div class="text-sm text-green-800">إجمالي الأقسام</div>
                            </div>
                            
                            <div class="bg-purple-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-purple-600" id="dbTotalImages">0</div>
                                <div class="text-sm text-purple-800">إجمالي الصور</div>
                            </div>
                            
                            <div class="bg-orange-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-orange-600" id="dbDataSize">0 KB</div>
                                <div class="text-sm text-orange-800">حجم البيانات</div>
                            </div>
                        </div>
                        
                        <div class="mt-6">
                            <h4 class="text-lg font-semibold text-gray-700 mb-4">تفاصيل التخزين</h4>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <div class="font-medium text-gray-700 mb-2">المنتجات:</div>
                                        <div class="space-y-1 text-gray-600">
                                            <div>منتجات نشطة: <span id="dbActiveProducts">0</span></div>
                                            <div>منتجات مخفضة: <span id="dbDiscountedProducts">0</span></div>
                                            <div>منتجات بصور: <span id="dbProductsWithImages">0</span></div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <div class="font-medium text-gray-700 mb-2">الأقسام:</div>
                                        <div class="space-y-1 text-gray-600">
                                            <div>أقسام نشطة: <span id="dbActiveCategories">0</span></div>
                                            <div>أقسام بصور: <span id="dbCategoriesWithImages">0</span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- عمليات قاعدة البيانات -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold mb-6 text-blue-600 flex items-center">
                            <i class="fas fa-tools ml-3"></i>عمليات قاعدة البيانات
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <h4 class="text-lg font-semibold text-gray-700">عمليات الصيانة</h4>
                                
                                <button id="optimizeDatabase" class="w-full bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition font-semibold">
                                    <i class="fas fa-magic ml-2"></i>تحسين قاعدة البيانات
                                </button>
                                
                                <button id="validateData" class="w-full bg-teal-600 text-white px-6 py-3 rounded-lg hover:bg-teal-700 transition font-semibold">
                                    <i class="fas fa-check-circle ml-2"></i>التحقق من سلامة البيانات
                                </button>
                                
                                <button id="cleanupData" class="w-full bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700 transition font-semibold">
                                    <i class="fas fa-broom ml-2"></i>تنظيف البيانات المكررة
                                </button>
                            </div>
                            
                            <div class="space-y-4">
                                <h4 class="text-lg font-semibold text-gray-700">عمليات خطيرة</h4>
                                
                                <button id="resetDatabase" class="w-full bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition font-semibold">
                                    <i class="fas fa-undo ml-2"></i>إعادة تعيين البيانات الافتراضية
                                </button>
                                
                                <button id="clearDatabase" class="w-full bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition font-semibold">
                                    <i class="fas fa-trash ml-2"></i>مسح جميع البيانات
                                </button>
                                
                                <div class="bg-red-50 p-3 rounded-lg">
                                    <p class="text-sm text-red-700">
                                        <i class="fas fa-exclamation-triangle ml-1"></i>
                                        العمليات أعلاه لا يمكن التراجع عنها!
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- سجل العمليات -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold mb-6 text-blue-600 flex items-center">
                            <i class="fas fa-history ml-3"></i>سجل العمليات
                        </h3>
                        
                        <div class="bg-gray-50 p-4 rounded-lg max-h-64 overflow-y-auto">
                            <div id="operationLog" class="space-y-2 text-sm">
                                <div class="text-gray-500 text-center">لا توجد عمليات مسجلة</div>
                            </div>
                        </div>
                        
                        <div class="mt-4 flex justify-between items-center">
                            <button id="clearLog" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition">
                                <i class="fas fa-eraser ml-2"></i>مسح السجل
                            </button>
                            <button id="exportLog" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition">
                                <i class="fas fa-download ml-2"></i>تصدير السجل
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- محتوى الإعدادات -->
            <div id="settings-content" class="admin-content">
                <div class="grid grid-cols-1 gap-8">
                    <!-- إعدادات المتجر -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold mb-6 text-blue-600">إعدادات المتجر</h3>
                        <form id="storeSettingsForm">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                <!-- المعلومات الأساسية -->
                                <div class="space-y-4">
                                    <h4 class="text-lg font-semibold text-gray-700 border-b pb-2">المعلومات الأساسية</h4>
                                    
                                    <div>
                                        <label class="block text-gray-700 mb-2">اسم المتجر</label>
                                        <input type="text" id="storeName" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="متجر الأناقة">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 mb-2">وصف المتجر</label>
                                        <textarea id="storeDescription" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3">اكتشف أحدث المنتجات بأفضل الأسعار</textarea>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 mb-2">العملة</label>
                                        <select id="storeCurrency" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="دج">دينار جزائري</option>
                                            <option value="ريال">ريال سعودي</option>
                                            <option value="درهم">درهم إماراتي</option>
                                            <option value="دينار">دينار كويتي</option>
                                            <option value="دولار">دولار أمريكي</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 mb-2">شعار المتجر</label>
                                        <input type="file" id="storeLogo" accept="image/*" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <small class="text-gray-500">اختر شعار للمتجر (اختياري)</small>
                                        <div id="logoPreview" class="mt-3 hidden">
                                            <!-- سيتم عرض الشعار هنا -->
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- معلومات التواصل -->
                                <div class="space-y-4">
                                    <h4 class="text-lg font-semibold text-gray-700 border-b pb-2">معلومات التواصل</h4>
                                    
                                    <div>
                                        <label class="block text-gray-700 mb-2">رقم الهاتف</label>
                                        <input type="tel" id="storePhone" placeholder="+966 12 345 6789" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 mb-2">البريد الإلكتروني</label>
                                        <input type="email" id="storeEmail" placeholder="info@mystore.com" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 mb-2">العنوان</label>
                                        <textarea id="storeAddress" placeholder="الرياض، المملكة العربية السعودية" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2"></textarea>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 mb-2">ساعات العمل</label>
                                        <input type="text" id="storeHours" placeholder="متاح 24/7 للطلبات الإلكترونية" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- روابط التواصل الاجتماعي -->
                            <div class="mt-8">
                                <h4 class="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">روابط التواصل الاجتماعي</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div>
                                        <label class="block text-gray-700 mb-2">فيسبوك</label>
                                        <input type="url" id="facebookLink" placeholder="https://facebook.com/mystore" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 mb-2">إنستغرام</label>
                                        <input type="url" id="instagramLink" placeholder="https://instagram.com/mystore" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 mb-2">تيك توك</label>
                                        <input type="url" id="tiktokLink" placeholder="https://tiktok.com/@mystore" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 mb-2">واتساب</label>
                                        <input type="tel" id="whatsappLink" placeholder="+966501234567" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- إعدادات إضافية -->
                            <div class="mt-8">
                                <h4 class="text-lg font-semibold text-gray-700 border-b pb-2 mb-4">إعدادات إضافية</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-gray-700 mb-2">سنة التأسيس</label>
                                        <input type="number" id="foundedYear" placeholder="2020" min="1900" max="2024" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    
                                    <div>
                                        <label class="block text-gray-700 mb-2">عدد العملاء</label>
                                        <input type="number" id="customerCount" placeholder="1000" min="0" class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mt-8">
                                <button type="submit" class="w-full bg-blue-600 text-white px-6 py-3 rounded-md hover:bg-blue-700 transition font-semibold">
                                    <i class="fas fa-save ml-2"></i>حفظ جميع الإعدادات
                                </button>
                            </div>
                        </form>
                    </div>
                    
                    <!-- إدارة البيانات -->
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-bold mb-4 text-blue-600">إدارة البيانات</h3>
                        <div class="space-y-4">
                            <button id="clearAllData" class="w-full bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700 transition">
                                <i class="fas fa-trash ml-2"></i>مسح جميع البيانات
                            </button>
                            
                            <button id="resetToDefault" class="w-full bg-orange-600 text-white px-6 py-2 rounded-md hover:bg-orange-700 transition">
                                <i class="fas fa-undo ml-2"></i>إعادة تعيين البيانات الافتراضية
                            </button>
                            
                            <div class="border-t pt-4">
                                <h4 class="font-bold mb-2">إحصائيات البيانات</h4>
                                <div class="text-sm text-gray-600 space-y-1">
                                    <div>عدد المنتجات: <span id="totalProductsStats">0</span></div>
                                    <div>عدد الأقسام: <span id="totalCategories">0</span></div>
                                    <div>حجم البيانات: <span id="dataSize">0 KB</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- نموذج معاينة المنتج -->
    <div id="productPreviewModal" class="product-preview-modal">
        <div class="product-preview-content">
            <div class="preview-image-gallery">
                <img id="previewMainImage" class="preview-main-image" alt="صورة المنتج">
                <div id="previewDiscountBadge" class="preview-discount-badge" style="display: none;">
                    <!-- سيتم ملء التخفيض هنا -->
                </div>
                <button class="absolute top-4 left-4 bg-white bg-opacity-80 hover:bg-opacity-100 text-gray-800 w-10 h-10 rounded-full flex items-center justify-center transition" onclick="closeProductPreview()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="preview-price-section">
                <div class="flex items-center justify-between">
                    <div>
                        <div id="previewCurrentPrice" class="preview-current-price">
                            <!-- سيتم ملء السعر هنا -->
                        </div>
                        <div id="previewPriceRow" class="preview-price-row" style="display: none;">
                            <span id="previewOriginalPrice" class="preview-original-price"></span>
                            <span id="previewSavings" class="preview-savings"></span>
                        </div>
                    </div>
                    <button id="previewOrderBtnSmall" class="preview-order-btn" onclick="orderFromPreview()">
                        <i class="fas fa-shopping-cart"></i>
                        <span>اطلب الآن</span>
                    </button>
                </div>
            </div>
            <div id="previewThumbnails" class="preview-thumbnails">
                <!-- سيتم ملء الصور المصغرة هنا -->
            </div>
            <div class="p-6">
                <div class="flex flex-col md:flex-row gap-6">
                    <div class="flex-1">
                        <h2 id="previewProductName" class="text-2xl font-bold mb-3 text-gray-800"></h2>
                        <div class="flex items-center mb-4">
                            <div class="rating-stars ml-4">
                                <i class="fas fa-star star"></i>
                                <i class="fas fa-star star"></i>
                                <i class="fas fa-star star"></i>
                                <i class="fas fa-star star"></i>
                                <i class="far fa-star star"></i>
                                <span class="mr-1 text-gray-600">(4.0)</span>
                            </div>
                            <span id="previewProductCategory" class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm"></span>
                        </div>
                        <p id="previewProductDescription" class="text-gray-600 mb-4 leading-relaxed"></p>
                        <div class="grid grid-cols-2 gap-4 mb-4 text-sm">
                            <div>
                                <span class="text-gray-500">العلامة التجارية:</span>
                                <span id="previewProductBrand" class="font-medium mr-2"></span>
                            </div>
                            <div>
                                <span class="text-gray-500">الموديل:</span>
                                <span id="previewProductModel" class="font-medium mr-2"></span>
                            </div>
                        </div>
                        <div id="previewStockInfo" class="mb-4">
                            <!-- سيتم ملء معلومات المخزون هنا -->
                        </div>
                        
                        <!-- خصائص المنتج -->
                        <div id="previewProductProperties" class="mb-4">
                            <!-- سيتم ملء خصائص المنتج هنا -->
                        </div>
                    </div>
                    <div class="md:w-80">
                        <div class="bg-gray-50 p-6 rounded-xl">
                            <div class="space-y-3">
                                <button class="w-full btn-secondary" onclick="addToWishlistFromPreview()">
                                    <i class="far fa-heart"></i>
                                    إضافة للمفضلة
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- نافذة المنتجات المفضلة -->
    <div id="wishlistModal" class="order-modal">
        <div class="order-modal-content">
            <div class="p-6 border-b flex justify-between items-center">
                <h3 class="text-xl font-bold text-red-600 flex items-center">
                    <i class="fas fa-heart ml-3"></i>المنتجات المفضلة
                </h3>
                <button id="closeWishlistModal" class="text-gray-500 hover:text-gray-700 p-2 hover:bg-gray-100 rounded-lg transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <div id="wishlistContent">
                    <!-- سيتم ملء المنتجات المفضلة هنا -->
                </div>
            </div>
        </div>
    </div>

    <!-- نموذج الطلب -->
    <div id="orderModal" class="order-modal">
        <div class="order-modal-content">
            <div class="p-6 border-b flex justify-between items-center">
                <h3 class="text-xl font-bold text-blue-600">طلب المنتج</h3>
                <button id="closeOrderModal" class="text-gray-500 hover:text-gray-700 p-2 hover:bg-gray-100 rounded-lg transition">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="p-6">
                <!-- تفاصيل المنتج -->
                <div id="orderProductDetails" class="mb-6 bg-gray-50 p-4 rounded-lg">
                    <div class="flex items-center gap-4">
                        <div id="orderProductImage" class="flex-shrink-0"></div>
                        <div class="flex-1">
                            <h4 class="text-lg font-bold mb-1" id="orderProductName">اسم المنتج</h4>
                            <p class="text-gray-600 text-sm mb-2" id="orderProductDesc">وصف المنتج</p>
                            <div class="flex items-center gap-3">
                                <span class="text-blue-600 font-bold text-xl" id="orderProductPrice">السعر</span>
                                <span class="original-price text-gray-500 line-through" id="orderOriginalPrice" style="display: none;">السعر الأصلي</span>
                            </div>
                        </div>
                    </div>
                </div>

                <form id="orderForm">
                    <!-- معلومات العميل -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-gray-700 mb-2 font-medium">الاسم الكامل *</label>
                            <input type="text" id="customerName" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2 font-medium">رقم الهاتف *</label>
                            <div class="relative">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <span class="text-gray-500 text-sm">🇩🇿</span>
                                </div>
                                <input type="tel" id="customerPhone" placeholder="0555123456" class="w-full px-4 py-3 pl-12 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required pattern="0[5-7][0-9]{8}" title="أدخل رقم هاتف جزائري صحيح (10 أرقام يبدأ بـ 05 أو 06 أو 07)">
                                <div id="phoneError" class="hidden text-red-600 text-sm mt-1 flex items-center">
                                    <i class="fas fa-exclamation-triangle ml-1"></i>
                                    <span>رقم الهاتف غير صحيح. يجب أن يكون 10 أرقام ويبدأ بـ 05 أو 06 أو 07</span>
                                </div>
                                <div id="phoneSuccess" class="hidden text-green-600 text-sm mt-1 flex items-center">
                                    <i class="fas fa-check-circle ml-1"></i>
                                    <span>رقم الهاتف صحيح</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- الولاية والعنوان -->
                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2 font-medium">الولاية *</label>
                        <select id="customerState" class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" required>
                            <option value="">اختر الولاية</option>
                            <option value="01-أدرار">01 - أدرار</option>
                            <option value="02-الشلف">02 - الشلف</option>
                            <option value="03-الأغواط">03 - الأغواط</option>
                            <option value="04-أم البواقي">04 - أم البواقي</option>
                            <option value="05-باتنة">05 - باتنة</option>
                            <option value="06-بجاية">06 - بجاية</option>
                            <option value="07-بسكرة">07 - بسكرة</option>
                            <option value="08-بشار">08 - بشار</option>
                            <option value="09-البليدة">09 - البليدة</option>
                            <option value="10-البويرة">10 - البويرة</option>
                            <option value="11-تمنراست">11 - تمنراست</option>
                            <option value="12-تبسة">12 - تبسة</option>
                            <option value="13-تلمسان">13 - تلمسان</option>
                            <option value="14-تيارت">14 - تيارت</option>
                            <option value="15-تيزي وزو">15 - تيزي وزو</option>
                            <option value="16-الجزائر">16 - الجزائر</option>
                            <option value="17-الجلفة">17 - الجلفة</option>
                            <option value="18-جيجل">18 - جيجل</option>
                            <option value="19-سطيف">19 - سطيف</option>
                            <option value="20-سعيدة">20 - سعيدة</option>
                            <option value="21-سكيكدة">21 - سكيكدة</option>
                            <option value="22-سيدي بلعباس">22 - سيدي بلعباس</option>
                            <option value="23-عنابة">23 - عنابة</option>
                            <option value="24-قالمة">24 - قالمة</option>
                            <option value="25-قسنطينة">25 - قسنطينة</option>
                            <option value="26-المدية">26 - المدية</option>
                            <option value="27-مستغانم">27 - مستغانم</option>
                            <option value="28-المسيلة">28 - المسيلة</option>
                            <option value="29-معسكر">29 - معسكر</option>
                            <option value="30-ورقلة">30 - ورقلة</option>
                            <option value="31-وهران">31 - وهران</option>
                            <option value="32-البيض">32 - البيض</option>
                            <option value="33-إليزي">33 - إليزي</option>
                            <option value="34-برج بوعريريج">34 - برج بوعريريج</option>
                            <option value="35-بومرداس">35 - بومرداس</option>
                            <option value="36-الطارف">36 - الطارف</option>
                            <option value="37-تندوف">37 - تندوف</option>
                            <option value="38-تيسمسيلت">38 - تيسمسيلت</option>
                            <option value="39-الوادي">39 - الوادي</option>
                            <option value="40-خنشلة">40 - خنشلة</option>
                            <option value="41-سوق أهراس">41 - سوق أهراس</option>
                            <option value="42-تيبازة">42 - تيبازة</option>
                            <option value="43-ميلة">43 - ميلة</option>
                            <option value="44-عين الدفلى">44 - عين الدفلى</option>
                            <option value="45-النعامة">45 - النعامة</option>
                            <option value="46-عين تموشنت">46 - عين تموشنت</option>
                            <option value="47-غرداية">47 - غرداية</option>
                            <option value="48-غليزان">48 - غليزان</option>
                            <option value="49-تيميمون">49 - تيميمون</option>
                            <option value="50-برج باجي مختار">50 - برج باجي مختار</option>
                            <option value="51-أولاد جلال">51 - أولاد جلال</option>
                            <option value="52-بني عباس">52 - بني عباس</option>
                            <option value="53-عين صالح">53 - عين صالح</option>
                            <option value="54-عين قزام">54 - عين قزام</option>
                            <option value="55-تقرت">55 - تقرت</option>
                            <option value="56-جانت">56 - جانت</option>
                            <option value="57-المغير">57 - المغير</option>
                            <option value="58-المنيعة">58 - المنيعة</option>
                        </select>
                    </div>

                    <!-- نوع التوصيل -->
                    <div class="mb-4" id="deliveryTypeSection" style="display: none;">
                        <label class="block text-gray-700 mb-2 font-medium">نوع التوصيل مع شركة ياليدين 🚚</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            <label class="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-blue-50 transition">
                                <input type="radio" name="deliveryType" value="office" class="ml-3" checked>
                                <div class="flex-1">
                                    <div class="font-medium text-gray-800">📍 لمكتب شركة التوصيل</div>
                                    <div class="text-sm text-gray-600" id="officePrice">أقل تكلفة</div>
                                </div>
                            </label>
                            <label class="flex items-center p-3 border-2 rounded-lg cursor-pointer hover:bg-blue-50 transition">
                                <input type="radio" name="deliveryType" value="home" class="ml-3">
                                <div class="flex-1">
                                    <div class="font-medium text-gray-800">🏠 لباب المنزل</div>
                                    <div class="text-sm text-gray-600" id="homePrice">خدمة مميزة</div>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label class="block text-gray-700 mb-2 font-medium">العنوان التفصيلي *</label>
                        <textarea id="customerAddress" placeholder="البلدية، الحي، الشارع..." class="w-full px-4 py-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" rows="3" required></textarea>
                    </div>

                    <!-- الكمية وتكلفة التوصيل -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-gray-700 mb-2 font-medium">الكمية</label>
                            <div class="quantity-control">
                                <button type="button" class="quantity-btn decrease-btn">-</button>
                                <input type="number" id="quantity" class="quantity-input" value="1" min="1" max="99">
                                <button type="button" class="quantity-btn increase-btn">+</button>
                            </div>
                        </div>
                        <div>
                            <label class="block text-gray-700 mb-2 font-medium">تكلفة التوصيل</label>
                            <div class="bg-gradient-to-r from-blue-50 to-blue-100 px-4 py-3 rounded-lg border-2 border-blue-200">
                                <div class="flex justify-between items-center">
                                    <div>
                                        <div class="text-sm text-blue-600 font-medium">🚚 ياليدين</div>
                                        <div id="shippingDestination" class="text-gray-700 text-sm">اختر الولاية أولاً</div>
                                    </div>
                                    <span id="shippingCost" class="font-bold text-blue-600 text-lg" style="display: none;">0 دج</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ملخص الطلب -->
                    <div class="bg-blue-50 p-4 rounded-lg mb-6">
                        <h5 class="font-bold text-blue-800 mb-3">ملخص الطلب</h5>
                        <div class="space-y-2 text-sm">
                            <!-- الكود بار -->
                            <div class="flex justify-between items-center pb-2 border-b border-blue-200" id="barcodeRow" style="display: none;">
                                <span class="flex items-center">
                                    <i class="fas fa-barcode text-blue-600 ml-2"></i>
                                    <span>الكود بار</span>
                                </span>
                                <span id="summaryBarcode" class="font-mono text-xs bg-white px-2 py-1 rounded border">-</span>
                            </div>
                            
                            <!-- السعر الأصلي -->
                            <div class="flex justify-between" id="originalPriceRow" style="display: none;">
                                <span>السعر الأصلي × <span id="summaryQuantityOriginal">1</span></span>
                                <span id="summaryOriginalTotal" class="text-gray-500 line-through">0 دج</span>
                            </div>
                            
                            <!-- التخفيض -->
                            <div class="flex justify-between text-red-600" id="discountRow" style="display: none;">
                                <span>التخفيض (<span id="summaryDiscountPercent">0</span>%)</span>
                                <span id="summaryDiscountAmount">-0 دج</span>
                            </div>
                            
                            <!-- السعر بعد التخفيض -->
                            <div class="flex justify-between">
                                <span>سعر المنتج × <span id="summaryQuantity">1</span></span>
                                <span id="summaryProductTotal" class="font-medium">0 دج</span>
                            </div>
                            
                            <!-- تكلفة التوصيل -->
                            <div class="flex justify-between">
                                <span class="flex items-center">
                                    <span>تكلفة التوصيل</span>
                                    <span id="deliveryTypeLabel" class="text-xs text-gray-500 mr-1"></span>
                                </span>
                                <span id="summaryShipping" class="font-medium">0 دج</span>
                            </div>
                            
                            <!-- إجمالي التوفير -->
                            <div class="flex justify-between text-green-600 font-medium" id="totalSavingsRow" style="display: none;">
                                <span>إجمالي التوفير 💰</span>
                                <span id="summaryTotalSavings">0 دج</span>
                            </div>
                            
                            <hr class="border-blue-200">
                            <div class="flex justify-between text-lg font-bold text-blue-800">
                                <span>المجموع الكلي</span>
                                <span id="summaryTotal">0 دج</span>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-4 rounded-lg hover:from-blue-700 hover:to-blue-800 transition font-bold text-lg">
                        <i class="fas fa-check ml-2"></i>تأكيد الطلب
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- بانر رئيسي -->
    <section id="home" class="bg-gradient-to-r from-blue-500 to-blue-700 text-white py-16 md:py-20">
        <div class="container mx-auto px-4 text-center">
            <h2 class="text-3xl md:text-4xl font-bold mb-4" id="storeTitle">أهلاً بك في متجر الأناقة</h2>
            <p class="text-lg md:text-xl mb-8" id="storeSubtitle">اكتشف أحدث المنتجات بأفضل الأسعار</p>
            <a href="#products" class="inline-block bg-white text-blue-600 px-8 py-4 rounded-full font-bold hover:bg-blue-50 transition transform hover:scale-105">
                <i class="fas fa-shopping-bag ml-2"></i>تسوق الآن
            </a>
        </div>
    </section>

    <!-- قسم الأقسام -->
    <section class="py-8 bg-white">
        <div class="container mx-auto px-4">
            <div class="text-center mb-8">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-2">تسوق حسب الأقسام</h2>
                <p class="text-gray-600">اختر القسم المناسب لك</p>
            </div>
            
            <div class="grid grid-cols-3 md:grid-cols-6 gap-4 md:gap-6" id="categoriesGrid">
                <!-- سيتم ملء الأقسام هنا -->
            </div>
        </div>
    </section>

    <!-- قسم المنتجات -->
    <section id="products" class="py-12 md:py-16 bg-gray-50">
        <div class="container mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">منتجاتنا المميزة</h2>
                <p class="text-gray-600 text-lg">اختر من مجموعة واسعة من المنتجات عالية الجودة</p>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6" id="productsContainer">
                <!-- سيتم ملء المنتجات هنا -->
            </div>
            
            <div class="text-center mt-12">
                <button class="bg-gradient-to-r from-blue-600 to-blue-700 text-white px-8 py-4 rounded-full font-bold hover:from-blue-700 hover:to-blue-800 transition transform hover:scale-105">
                    <i class="fas fa-plus ml-2"></i>عرض المزيد من المنتجات
                </button>
            </div>
        </div>
    </section>

    <!-- قسم المميزات -->
    <section id="features" class="py-12 md:py-16 bg-white">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-12 text-gray-800">لماذا تختارنا؟</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-8 rounded-2xl text-center transform hover:scale-105 transition">
                    <div class="w-20 h-20 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-truck text-white text-3xl"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-4 text-gray-800">توصيل سريع</h3>
                    <p class="text-gray-600">نوصل طلبك في أسرع وقت ممكن لجميع ولايات الجزائر</p>
                </div>
                
                <div class="bg-gradient-to-br from-green-50 to-green-100 p-8 rounded-2xl text-center transform hover:scale-105 transition">
                    <div class="w-20 h-20 bg-gradient-to-r from-green-500 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-shield-alt text-white text-3xl"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-4 text-gray-800">ضمان الجودة</h3>
                    <p class="text-gray-600">جميع منتجاتنا أصلية ومضمونة 100%</p>
                </div>
                
                <div class="bg-gradient-to-br from-purple-50 to-purple-100 p-8 rounded-2xl text-center transform hover:scale-105 transition">
                    <div class="w-20 h-20 bg-gradient-to-r from-purple-500 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-6">
                        <i class="fas fa-headset text-white text-3xl"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-4 text-gray-800">دعم على مدار الساعة</h3>
                    <p class="text-gray-600">فريق خدمة العملاء متاح للرد على استفساراتك في أي وقت</p>
                </div>
            </div>
        </div>
    </section>

    <!-- قسم من نحن -->
    <section id="about" class="py-12 md:py-16 bg-gray-50">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-12 text-gray-800">من نحن</h2>
            <div class="max-w-4xl mx-auto text-center">
                <p class="text-gray-600 mb-8 text-lg leading-relaxed">نحن متجر إلكتروني متخصص في توفير أحدث المنتجات التقنية والإلكترونية بأفضل الأسعار. تأسسنا عام 2020 بهدف تقديم تجربة تسوق سهلة وممتعة لعملائنا.</p>
                <p class="text-gray-600 mb-12 text-lg leading-relaxed">نسعى دائماً لتوفير منتجات عالية الجودة مع خدمة عملاء متميزة وتوصيل سريع لجميع مناطق المملكة.</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="bg-white p-8 rounded-2xl shadow-lg transform hover:scale-105 transition">
                        <div class="text-4xl font-bold text-blue-600 mb-2">+1000</div>
                        <div class="text-gray-600 font-medium">عميل سعيد</div>
                    </div>
                    <div class="bg-white p-8 rounded-2xl shadow-lg transform hover:scale-105 transition">
                        <div class="text-4xl font-bold text-blue-600 mb-2" id="productCountDisplay">+500</div>
                        <div class="text-gray-600 font-medium">منتج متنوع</div>
                    </div>
                    <div class="bg-white p-8 rounded-2xl shadow-lg transform hover:scale-105 transition">
                        <div class="text-4xl font-bold text-blue-600 mb-2">3</div>
                        <div class="text-gray-600 font-medium">سنوات خبرة</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- قسم اتصل بنا -->
    <section id="contact" class="py-12 md:py-16 bg-white">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-12 text-gray-800">اتصل بنا</h2>
            <div class="max-w-4xl mx-auto">
                <div class="flex justify-center">
                    <div class="bg-gradient-to-br from-blue-50 to-blue-100 p-8 rounded-2xl w-full max-w-2xl">
                        <h3 class="text-2xl font-bold mb-6 text-blue-600">معلومات التواصل</h3>
                        <ul class="space-y-6">
                            <li class="flex items-center">
                                <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center ml-4">
                                    <i class="fas fa-map-marker-alt text-white"></i>
                                </div>
                                <span class="text-gray-700">الرياض، المملكة العربية السعودية</span>
                            </li>
                            <li class="flex items-center">
                                <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center ml-4">
                                    <i class="fas fa-phone-alt text-white"></i>
                                </div>
                                <span class="text-gray-700">+966 12 345 6789</span>
                            </li>
                            <li class="flex items-center">
                                <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center ml-4">
                                    <i class="fas fa-envelope text-white"></i>
                                </div>
                                <span class="text-gray-700">info@mystore.com</span>
                            </li>
                            <li class="flex items-center">
                                <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center ml-4">
                                    <i class="fas fa-clock text-white"></i>
                                </div>
                                <span class="text-gray-700">متاح 24/7 للطلبات الإلكترونية</span>
                            </li>
                        </ul>
                        <div class="mt-8 flex space-x-4 space-x-reverse">
                            <a href="#" class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white hover:bg-blue-700 transition transform hover:scale-110">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="#" class="w-12 h-12 bg-pink-600 rounded-full flex items-center justify-center text-white hover:bg-pink-700 transition transform hover:scale-110">
                                <i class="fab fa-tiktok"></i>
                            </a>
                            <a href="#" class="w-12 h-12 bg-pink-500 rounded-full flex items-center justify-center text-white hover:bg-pink-600 transition transform hover:scale-110">
                                <i class="fab fa-instagram"></i>
                            </a>
                            <a href="#" class="w-12 h-12 bg-green-600 rounded-full flex items-center justify-center text-white hover:bg-green-700 transition transform hover:scale-110">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </section>

    <!-- فوتر -->
    <footer class="bg-gray-800 text-white py-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                <div>
                    <h3 class="text-2xl font-bold mb-4" id="footerStoreName">متجر الأناقة</h3>
                    <p class="text-gray-400 leading-relaxed">نقدم لكم أفضل المنتجات بأفضل الأسعار مع خدمة توصيل سريعة وموثوقة.</p>
                </div>
                
                <div>
                    <h3 class="text-xl font-bold mb-4">روابط سريعة</h3>
                    <ul class="space-y-3">
                        <li><a href="#home" class="text-gray-400 hover:text-white transition flex items-center"><i class="fas fa-chevron-left ml-2 text-xs"></i>الرئيسية</a></li>
                        <li><a href="#products" class="text-gray-400 hover:text-white transition flex items-center"><i class="fas fa-chevron-left ml-2 text-xs"></i>المنتجات</a></li>
                        <li><a href="#features" class="text-gray-400 hover:text-white transition flex items-center"><i class="fas fa-chevron-left ml-2 text-xs"></i>المميزات</a></li>
                        <li><a href="#about" class="text-gray-400 hover:text-white transition flex items-center"><i class="fas fa-chevron-left ml-2 text-xs"></i>من نحن</a></li>
                        <li><a href="#contact" class="text-gray-400 hover:text-white transition flex items-center"><i class="fas fa-chevron-left ml-2 text-xs"></i>اتصل بنا</a></li>
                    </ul>
                </div>
                
                <div>
                    <h3 class="text-xl font-bold mb-4">تواصل معنا</h3>
                    <p class="text-gray-400 mb-4">اشترك في نشرتنا البريدية للحصول على آخر العروض والتحديثات</p>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <input type="email" placeholder="بريدك الإلكتروني" class="flex-1 px-4 py-3 rounded-lg focus:outline-none text-gray-800">
                        <button class="bg-blue-600 px-6 py-3 rounded-lg hover:bg-blue-700 transition font-medium">اشتراك</button>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-700 pt-8 flex flex-col md:flex-row justify-between items-center">
                <p class="text-gray-400 mb-4 md:mb-0">© 2023 <span id="footerCopyright">متجر الأناقة</span>. جميع الحقوق محفوظة</p>
                
                <div class="flex space-x-4">
                    <a href="#" class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center hover:bg-blue-600 transition transform hover:scale-110">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="#" class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center hover:bg-pink-600 transition transform hover:scale-110">
                        <i class="fab fa-tiktok"></i>
                    </a>
                    <a href="#" class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center hover:bg-pink-500 transition transform hover:scale-110">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="#" class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center hover:bg-green-600 transition transform hover:scale-110">
                        <i class="fab fa-whatsapp"></i>
                    </a>
                </div>
            </div>
        </div>
    </footer>
    


    <script>
        // Firebase is already initialized in the module script above
        // Access Firebase through global variables
        let db, analytics;
        
        // Wait for Firebase to be initialized
        window.addEventListener('load', () => {
            if (window.firebaseDb && window.firebaseAnalytics) {
                db = window.firebaseDb;
                analytics = window.firebaseAnalytics;
                console.log('Firebase initialized successfully');
            } else {
                console.warn('Firebase not available, using local storage only');
            }
        });

        // نظام الإشعارات
        class NotificationSystem {
            constructor() {
                this.notifications = [];
            }

            show(title, message, type = 'info', duration = 4000) {
                const notification = this.create(title, message, type);
                document.body.appendChild(notification);
                
                // إظهار الإشعار
                setTimeout(() => {
                    notification.classList.add('show');
                }, 100);

                // إخفاء الإشعار تلقائياً
                setTimeout(() => {
                    this.hide(notification);
                }, duration);

                return notification;
            }

            create(title, message, type) {
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                
                const icons = {
                    success: 'fas fa-check-circle',
                    error: 'fas fa-times-circle',
                    warning: 'fas fa-exclamation-triangle',
                    info: 'fas fa-info-circle'
                };

                notification.innerHTML = `
                    <div class="notification-icon">
                        <i class="${icons[type] || icons.info}"></i>
                    </div>
                    <div class="notification-content">
                        <div class="notification-title">${title}</div>
                        <div class="notification-message">${message}</div>
                    </div>
                    <button class="notification-close" onclick="notificationSystem.hide(this.parentElement)">
                        <i class="fas fa-times"></i>
                    </button>
                `;

                return notification;
            }

            hide(notification) {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.parentElement.removeChild(notification);
                    }
                }, 300);
            }

            success(title, message) {
                return this.show(title, message, 'success');
            }

            error(title, message) {
                return this.show(title, message, 'error');
            }

            warning(title, message) {
                return this.show(title, message, 'warning');
            }

            info(title, message) {
                return this.show(title, message, 'info');
            }
        }

        // إنشاء نظام الإشعارات العام
        const notificationSystem = new NotificationSystem();

        // نظام إدارة البيانات المحلية المحسن
        class StoreManager {
            constructor() {
                this.products = this.loadData('products') || [];
                this.categories = this.loadData('categories') || this.getDefaultCategories();
                this.settings = this.loadData('settings') || this.getDefaultSettings();
                this.operationLog = this.loadData('operationLog') || [];
                this.lastSaveTime = this.loadData('lastSaveTime') || null;
                this.internalDataStore = this.getInternalDataStore();
                this.init();
            }

            // البيانات المحفوظة داخل الكود - آخر تحديث: 2024-12-19 16:45:00
            getInternalDataStore() {
                return {
                    "lastUpdate": "2024-12-19T13:45:00.000Z",
                    "products": [
                        {
                            "id": "p1",
                            "name": "سماعات بلوتوث لاسلكية",
                            "description": "سماعات لاسلكية عالية الجودة مع عزل للضوضاء وبطارية تدوم 30 ساعة",
                            "price": 299,
                            "discount": 20,
                            "category": "electronics",
                            "brand": "Sony",
                            "model": "WH-1000XM4",
                            "stock": 15,
                            "active": true,
                            "images": [],
                            "barcode": {
                                "enabled": true,
                                "code": "1234567890123"
                            },
                            "properties": {
                                "colors": {
                                    "enabled": true,
                                    "values": ["أسود", "أبيض", "فضي"]
                                },
                                "sizes": {
                                    "enabled": false,
                                    "values": []
                                },
                                "shipping": {
                                    "enabled": true,
                                    "cost": 25,
                                    "time": "2-3 أيام",
                                    "details": "توصيل سريع لجميع مناطق المملكة",
                                    "free": false
                                },
                                "return": {
                                    "enabled": true,
                                    "days": 14,
                                    "free": true
                                },
                                "warranty": {
                                    "enabled": true,
                                    "period": "سنتان",
                                    "details": "ضمان شامل ضد عيوب الصناعة"
                                },
                                "specs": {
                                    "enabled": true,
                                    "details": "الوزن: 254 جرام\nالبطارية: 30 ساعة\nالاتصال: بلوتوث 5.0"
                                }
                            }
                        },
                        {
                            "id": "p2",
                            "name": "ساعة ذكية متطورة",
                            "description": "ساعة ذكية متعددة الاستخدامات مقاومة للماء مع مراقبة الصحة",
                            "price": 449,
                            "discount": 15,
                            "category": "electronics",
                            "brand": "Apple",
                            "model": "Watch Series 8",
                            "stock": 8,
                            "active": true,
                            "images": [],
                            "barcode": {
                                "enabled": true,
                                "code": "2345678901234"
                            },
                            "properties": {
                                "colors": {
                                    "enabled": true,
                                    "values": ["أسود", "أبيض", "وردي"]
                                },
                                "sizes": {
                                    "enabled": true,
                                    "values": ["38mm", "42mm", "44mm"]
                                },
                                "shipping": {
                                    "enabled": true,
                                    "cost": 0,
                                    "time": "1-2 أيام",
                                    "details": "توصيل مجاني خلال 24 ساعة",
                                    "free": true
                                },
                                "return": {
                                    "enabled": true,
                                    "days": 30,
                                    "free": true
                                },
                                "warranty": {
                                    "enabled": true,
                                    "period": "سنة واحدة",
                                    "details": "ضمان من الشركة المصنعة"
                                },
                                "specs": {
                                    "enabled": true,
                                    "details": "الشاشة: OLED\nمقاوم للماء: 50 متر\nالبطارية: 18 ساعة"
                                }
                            }
                        },
                        {
                            "id": "p3",
                            "name": "حقيبة ظهر عصرية",
                            "description": "حقيبة ظهر عصرية مقاومة للماء مع مساحة للحاسوب المحمول",
                            "price": 159,
                            "discount": 0,
                            "category": "accessories",
                            "brand": "Nike",
                            "model": "Backpack Pro",
                            "stock": 25,
                            "active": true,
                            "images": [],
                            "barcode": {
                                "enabled": true,
                                "code": "3456789012345"
                            },
                            "properties": {
                                "colors": {
                                    "enabled": true,
                                    "values": ["أسود", "رمادي", "أزرق"]
                                },
                                "sizes": {
                                    "enabled": false,
                                    "values": []
                                },
                                "shipping": {
                                    "enabled": true,
                                    "cost": 15,
                                    "time": "3-5 أيام",
                                    "details": "توصيل عادي",
                                    "free": false
                                },
                                "return": {
                                    "enabled": true,
                                    "days": 7,
                                    "free": false
                                },
                                "warranty": {
                                    "enabled": false,
                                    "period": "",
                                    "details": ""
                                },
                                "specs": {
                                    "enabled": true,
                                    "details": "السعة: 25 لتر\nمقاوم للماء\nجيب للحاسوب المحمول"
                                }
                            }
                        },
                        {
                            "id": "p4",
                            "name": "مكبر صوت محمول",
                            "description": "مكبر صوت محمول بجودة عالية وبطارية طويلة المدى",
                            "price": 199,
                            "discount": 25,
                            "category": "electronics",
                            "brand": "JBL",
                            "model": "Charge 5",
                            "stock": 0,
                            "active": true,
                            "images": [],
                            "barcode": {
                                "enabled": true,
                                "code": "4567890123456"
                            },
                            "properties": {
                                "colors": {
                                    "enabled": true,
                                    "values": ["أسود", "أحمر", "أزرق"]
                                },
                                "sizes": {
                                    "enabled": false,
                                    "values": []
                                },
                                "shipping": {
                                    "enabled": true,
                                    "cost": 20,
                                    "time": "2-4 أيام",
                                    "details": "توصيل آمن ومحمي",
                                    "free": false
                                },
                                "return": {
                                    "enabled": true,
                                    "days": 14,
                                    "free": true
                                },
                                "warranty": {
                                    "enabled": true,
                                    "period": "سنة واحدة",
                                    "details": "ضمان ضد عيوب التصنيع"
                                },
                                "specs": {
                                    "enabled": true,
                                    "details": "القوة: 20 واط\nالبطارية: 20 ساعة\nمقاوم للماء: IPX7"
                                }
                            }
                        },
                        {
                            "id": "p5",
                            "name": "قميص قطني فاخر",
                            "description": "قميص قطني عالي الجودة مناسب للمناسبات الرسمية والكاجوال",
                            "price": 89,
                            "discount": 10,
                            "category": "clothing",
                            "brand": "Zara",
                            "model": "Classic Shirt",
                            "stock": 50,
                            "active": true,
                            "images": [],
                            "barcode": {
                                "enabled": true,
                                "code": "5678901234567"
                            },
                            "properties": {
                                "colors": {
                                    "enabled": true,
                                    "values": ["أبيض", "أزرق فاتح", "رمادي"]
                                },
                                "sizes": {
                                    "enabled": true,
                                    "values": ["S", "M", "L", "XL", "XXL"]
                                },
                                "shipping": {
                                    "enabled": true,
                                    "cost": 10,
                                    "time": "2-3 أيام",
                                    "details": "توصيل سريع للملابس",
                                    "free": false
                                },
                                "return": {
                                    "enabled": true,
                                    "days": 30,
                                    "free": true
                                },
                                "warranty": {
                                    "enabled": false,
                                    "period": "",
                                    "details": ""
                                },
                                "specs": {
                                    "enabled": true,
                                    "details": "المادة: قطن 100%\nالقصة: عادية\nسهل العناية"
                                }
                            }
                        },
                        {
                            "id": "p6",
                            "name": "نظارات شمسية أنيقة",
                            "description": "نظارات شمسية عصرية مع حماية من الأشعة فوق البنفسجية",
                            "price": 129,
                            "discount": 0,
                            "category": "accessories",
                            "brand": "Ray-Ban",
                            "model": "Aviator",
                            "stock": 30,
                            "active": true,
                            "images": [],
                            "barcode": {
                                "enabled": true,
                                "code": "6789012345678"
                            },
                            "properties": {
                                "colors": {
                                    "enabled": true,
                                    "values": ["ذهبي", "فضي", "أسود"]
                                },
                                "sizes": {
                                    "enabled": false,
                                    "values": []
                                },
                                "shipping": {
                                    "enabled": true,
                                    "cost": 12,
                                    "time": "1-3 أيام",
                                    "details": "توصيل آمن للنظارات",
                                    "free": false
                                },
                                "return": {
                                    "enabled": true,
                                    "days": 14,
                                    "free": true
                                },
                                "warranty": {
                                    "enabled": true,
                                    "period": "6 أشهر",
                                    "details": "ضمان ضد الكسر"
                                },
                                "specs": {
                                    "enabled": true,
                                    "details": "حماية UV400\nعدسات مستقطبة\nإطار معدني"
                                }
                            }
                        }
                    ],
                    "categories": [
                        {
                            "id": "electronics",
                            "name": "إلكترونيات",
                            "description": "أجهزة إلكترونية وملحقاتها",
                            "icon": "fas fa-laptop",
                            "image": "",
                            "active": true
                        },
                        {
                            "id": "clothing",
                            "name": "ملابس",
                            "description": "ملابس رجالية ونسائية وأطفال",
                            "icon": "fas fa-tshirt",
                            "image": "",
                            "active": true
                        },
                        {
                            "id": "accessories",
                            "name": "إكسسوارات",
                            "description": "إكسسوارات متنوعة",
                            "icon": "fas fa-gem",
                            "image": "",
                            "active": true
                        }
                    ],
                    "settings": {
                        "storeName": "متجر الأناقة",
                        "storeDescription": "اكتشف أحدث المنتجات بأفضل الأسعار",
                        "currency": "دج",
                        "logo": "",
                        "phone": "",
                        "email": "",
                        "address": "",
                        "hours": "",
                        "facebookLink": "",
                        "instagramLink": "",
                        "tiktokLink": "",
                        "whatsappLink": "",
                        "foundedYear": "",
                        "customerCount": ""
                    },
                    "version": "1.2"
                };
            }

            // تحميل البيانات من التخزين المحلي
            loadData(key) {
                try {
                    const data = localStorage.getItem(`store_${key}`);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.error(`خطأ في تحميل ${key}:`, error);
                    this.logOperation('خطأ', `فشل في تحميل ${key}: ${error.message}`);
                    return null;
                }
            }

            // حفظ البيانات في التخزين المحلي مع تسجيل العملية
            saveData(key, data) {
                try {
                    const oldData = this.loadData(key);
                    localStorage.setItem(`store_${key}`, JSON.stringify(data));
                    
                    // تحديث وقت آخر حفظ
                    this.lastSaveTime = new Date().toISOString();
                    localStorage.setItem('store_lastSaveTime', JSON.stringify(this.lastSaveTime));
                    
                    // تسجيل العملية
                    const operation = oldData ? 'تحديث' : 'إنشاء';
                    this.logOperation('حفظ', `${operation} ${key} بنجاح`);
                    
                    this.updateStats();
                    this.updateDatabaseStats();
                    this.updateSaveStatus();
                } catch (error) {
                    console.error(`خطأ في حفظ ${key}:`, error);
                    this.logOperation('خطأ', `فشل في حفظ ${key}: ${error.message}`);
                }
            }

            // تسجيل العمليات
            logOperation(type, message) {
                const operation = {
                    id: Date.now(),
                    type: type,
                    message: message,
                    timestamp: new Date().toISOString(),
                    time: new Date().toLocaleString('ar-SA')
                };
                
                this.operationLog.unshift(operation);
                
                // الاحتفاظ بآخر 100 عملية فقط
                if (this.operationLog.length > 100) {
                    this.operationLog = this.operationLog.slice(0, 100);
                }
                
                localStorage.setItem('store_operationLog', JSON.stringify(this.operationLog));
                this.updateOperationLog();
            }

            // حساب حجم البيانات
            calculateDataSize() {
                try {
                    const allData = {
                        products: this.products,
                        categories: this.categories,
                        settings: this.settings,
                        operationLog: this.operationLog
                    };
                    
                    const dataString = JSON.stringify(allData);
                    const sizeInBytes = new Blob([dataString]).size;
                    const sizeInKB = Math.round(sizeInBytes / 1024 * 100) / 100;
                    
                    return { bytes: sizeInBytes, kb: sizeInKB };
                } catch (error) {
                    console.error('خطأ في حساب حجم البيانات:', error);
                    return { bytes: 0, kb: 0 };
                }
            }

            // حساب عدد الصور
            countImages() {
                let totalImages = 0;
                
                // صور المنتجات
                this.products.forEach(product => {
                    if (product.images && Array.isArray(product.images)) {
                        totalImages += product.images.length;
                    }
                });
                
                // صور الأقسام
                this.categories.forEach(category => {
                    if (category.image) {
                        totalImages += 1;
                    }
                });
                
                // شعار المتجر
                if (this.settings.logo) {
                    totalImages += 1;
                }
                
                return totalImages;
            }

            // تحديث إحصائيات قاعدة البيانات
            updateDatabaseStats() {
                const dataSize = this.calculateDataSize();
                const totalImages = this.countImages();
                const activeProducts = this.products.filter(p => p.active).length;
                const discountedProducts = this.products.filter(p => p.discount > 0).length;
                const productsWithImages = this.products.filter(p => p.images && p.images.length > 0).length;
                const activeCategories = this.categories.filter(c => c.active).length;
                const categoriesWithImages = this.categories.filter(c => c.image).length;

                // تحديث العناصر في الواجهة
                const elements = {
                    'dbTotalProducts': this.products.length,
                    'dbTotalCategories': this.categories.length,
                    'dbTotalImages': totalImages,
                    'dbDataSize': `${dataSize.kb} KB`,
                    'dbActiveProducts': activeProducts,
                    'dbDiscountedProducts': discountedProducts,
                    'dbProductsWithImages': productsWithImages,
                    'dbActiveCategories': activeCategories,
                    'dbCategoriesWithImages': categoriesWithImages,
                    'storageUsed': `${dataSize.kb} KB`
                };

                Object.entries(elements).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value;
                    }
                });
            }

            // تحديث حالة الحفظ
            updateSaveStatus() {
                const lastSaveElement = document.getElementById('lastSaveTime');
                const saveStatusElement = document.getElementById('saveStatus');
                
                if (lastSaveElement && this.lastSaveTime) {
                    const saveDate = new Date(this.lastSaveTime);
                    lastSaveElement.textContent = saveDate.toLocaleString('ar-SA');
                }
                
                if (saveStatusElement) {
                    saveStatusElement.textContent = 'محفوظ';
                    saveStatusElement.className = 'font-medium text-green-600';
                }
            }

            // تحديث سجل العمليات في الواجهة
            updateOperationLog() {
                const logContainer = document.getElementById('operationLog');
                if (!logContainer) return;

                if (this.operationLog.length === 0) {
                    logContainer.innerHTML = '<div class="text-gray-500 text-center">لا توجد عمليات مسجلة</div>';
                    return;
                }

                logContainer.innerHTML = this.operationLog.slice(0, 20).map(operation => {
                    const typeColors = {
                        'حفظ': 'text-green-600',
                        'حذف': 'text-red-600',
                        'تحديث': 'text-blue-600',
                        'خطأ': 'text-red-600',
                        'تحسين': 'text-purple-600',
                        'تنظيف': 'text-yellow-600'
                    };
                    
                    const typeIcons = {
                        'حفظ': 'fas fa-save',
                        'حذف': 'fas fa-trash',
                        'تحديث': 'fas fa-edit',
                        'خطأ': 'fas fa-exclamation-triangle',
                        'تحسين': 'fas fa-magic',
                        'تنظيف': 'fas fa-broom'
                    };

                    return `
                        <div class="flex items-start gap-3 p-2 hover:bg-gray-100 rounded">
                            <i class="${typeIcons[operation.type] || 'fas fa-info'} ${typeColors[operation.type] || 'text-gray-600'} mt-1"></i>
                            <div class="flex-1">
                                <div class="font-medium ${typeColors[operation.type] || 'text-gray-800'}">${operation.type}</div>
                                <div class="text-gray-700">${operation.message}</div>
                                <div class="text-xs text-gray-500">${operation.time}</div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // حفظ يدوي للبيانات
            manualSave() {
                try {
                    this.saveData('products', this.products);
                    this.saveData('categories', this.categories);
                    this.saveData('settings', this.settings);
                    
                    this.logOperation('حفظ', 'تم الحفظ اليدوي لجميع البيانات بنجاح');
                    notificationSystem.success('تم الحفظ!', 'تم حفظ جميع البيانات بنجاح');
                } catch (error) {
                    this.logOperation('خطأ', `فشل في الحفظ اليدوي: ${error.message}`);
                    notificationSystem.error('خطأ!', 'فشل في حفظ البيانات');
                }
            }

            // تحسين قاعدة البيانات
            optimizeDatabase() {
                try {
                    let optimizations = 0;
                    
                    // إزالة المنتجات المكررة
                    const uniqueProducts = [];
                    const seenNames = new Set();
                    
                    this.products.forEach(product => {
                        if (!seenNames.has(product.name)) {
                            seenNames.add(product.name);
                            uniqueProducts.push(product);
                        } else {
                            optimizations++;
                        }
                    });
                    
                    this.products = uniqueProducts;
                    
                    // إزالة الأقسام المكررة
                    const uniqueCategories = [];
                    const seenCategoryNames = new Set();
                    
                    this.categories.forEach(category => {
                        if (!seenCategoryNames.has(category.name)) {
                            seenCategoryNames.add(category.name);
                            uniqueCategories.push(category);
                        } else {
                            optimizations++;
                        }
                    });
                    
                    this.categories = uniqueCategories;
                    
                    // تنظيف سجل العمليات القديم
                    if (this.operationLog.length > 50) {
                        this.operationLog = this.operationLog.slice(0, 50);
                        optimizations++;
                    }
                    
                    // حفظ البيانات المحسنة
                    this.saveData('products', this.products);
                    this.saveData('categories', this.categories);
                    
                    this.logOperation('تحسين', `تم تحسين قاعدة البيانات - ${optimizations} عنصر محسن`);
                    notificationSystem.success('تم التحسين!', `تم تحسين قاعدة البيانات بنجاح (${optimizations} عنصر محسن)`);
                    
                    // تحديث الواجهة
                    this.renderProducts();
                    this.renderAdminProducts();
                    this.renderCategories();
                    
                } catch (error) {
                    this.logOperation('خطأ', `فشل في تحسين قاعدة البيانات: ${error.message}`);
                    notificationSystem.error('خطأ!', 'فشل في تحسين قاعدة البيانات');
                }
            }

            // التحقق من سلامة البيانات
            validateData() {
                try {
                    let issues = [];
                    
                    // التحقق من المنتجات
                    this.products.forEach((product, index) => {
                        if (!product.name || product.name.trim() === '') {
                            issues.push(`المنتج ${index + 1}: اسم المنتج فارغ`);
                        }
                        if (!product.price || product.price <= 0) {
                            issues.push(`المنتج ${index + 1}: سعر غير صحيح`);
                        }
                        if (!product.category) {
                            issues.push(`المنتج ${index + 1}: لا يوجد قسم محدد`);
                        }
                    });
                    
                    // التحقق من الأقسام
                    this.categories.forEach((category, index) => {
                        if (!category.name || category.name.trim() === '') {
                            issues.push(`القسم ${index + 1}: اسم القسم فارغ`);
                        }
                    });
                    
                    // التحقق من الإعدادات
                    if (!this.settings.storeName || this.settings.storeName.trim() === '') {
                        issues.push('الإعدادات: اسم المتجر فارغ');
                    }
                    
                    if (issues.length === 0) {
                        this.logOperation('تحقق', 'تم التحقق من سلامة البيانات - لا توجد مشاكل');
                        notificationSystem.success('البيانات سليمة!', 'جميع البيانات صحيحة ولا توجد مشاكل');
                    } else {
                        this.logOperation('تحقق', `تم العثور على ${issues.length} مشكلة في البيانات`);
                        
                        // عرض المشاكل في نافذة
                        this.showDeleteConfirmation(
                            'مشاكل في البيانات',
                            `تم العثور على ${issues.length} مشكلة:\n\n${issues.slice(0, 10).join('\n')}${issues.length > 10 ? '\n...' : ''}`,
                            null,
                            'موافق'
                        );
                    }
                    
                } catch (error) {
                    this.logOperation('خطأ', `فشل في التحقق من البيانات: ${error.message}`);
                    notificationSystem.error('خطأ!', 'فشل في التحقق من سلامة البيانات');
                }
            }

            // تنظيف البيانات المكررة
            cleanupData() {
                try {
                    let cleaned = 0;
                    
                    // تنظيف المنتجات المكررة
                    const uniqueProducts = [];
                    const seenProducts = new Map();
                    
                    this.products.forEach(product => {
                        const key = `${product.name}_${product.price}_${product.category}`;
                        if (!seenProducts.has(key)) {
                            seenProducts.set(key, product);
                            uniqueProducts.push(product);
                        } else {
                            cleaned++;
                        }
                    });
                    
                    this.products = uniqueProducts;
                    
                    // تنظيف الأقسام المكررة
                    const uniqueCategories = [];
                    const seenCategories = new Set();
                    
                    this.categories.forEach(category => {
                        if (!seenCategories.has(category.name)) {
                            seenCategories.add(category.name);
                            uniqueCategories.push(category);
                        } else {
                            cleaned++;
                        }
                    });
                    
                    this.categories = uniqueCategories;
                    
                    // حفظ البيانات المنظفة
                    this.saveData('products', this.products);
                    this.saveData('categories', this.categories);
                    
                    this.logOperation('تنظيف', `تم تنظيف ${cleaned} عنصر مكرر`);
                    notificationSystem.success('تم التنظيف!', `تم تنظيف ${cleaned} عنصر مكرر من البيانات`);
                    
                    // تحديث الواجهة
                    this.renderProducts();
                    this.renderAdminProducts();
                    this.renderCategories();
                    
                } catch (error) {
                    this.logOperation('خطأ', `فشل في تنظيف البيانات: ${error.message}`);
                    notificationSystem.error('خطأ!', 'فشل في تنظيف البيانات');
                }
            }

            // مسح سجل العمليات
            clearOperationLog() {
                this.operationLog = [];
                localStorage.removeItem('store_operationLog');
                this.updateOperationLog();
                notificationSystem.success('تم المسح!', 'تم مسح سجل العمليات بنجاح');
            }

            // تصدير سجل العمليات
            exportOperationLog() {
                try {
                    const logData = {
                        exportDate: new Date().toISOString(),
                        totalOperations: this.operationLog.length,
                        operations: this.operationLog
                    };
                    
                    const blob = new Blob([JSON.stringify(logData, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `operation-log-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.logOperation('تصدير', 'تم تصدير سجل العمليات بنجاح');
                    notificationSystem.success('تم التصدير!', 'تم تصدير سجل العمليات بنجاح');
                } catch (error) {
                    this.logOperation('خطأ', `فشل في تصدير سجل العمليات: ${error.message}`);
                    notificationSystem.error('خطأ!', 'فشل في تصدير سجل العمليات');
                }
            }

            // حفظ البيانات داخل الكود
            saveToInternalCode() {
                try {
                    const currentData = {
                        lastUpdate: new Date().toISOString(),
                        products: this.products,
                        categories: this.categories,
                        settings: this.settings,
                        version: '1.1'
                    };
                    
                    // تحديث البيانات الداخلية
                    this.internalDataStore = currentData;
                    
                    // إنشاء الكود الجديد للحفظ
                    const codeToSave = `
            // البيانات المحفوظة داخل الكود - آخر تحديث: ${new Date().toLocaleString('ar-SA')}
            getInternalDataStore() {
                return ${JSON.stringify(currentData, null, 8)};
            }`;
                    
                    // إنشاء ملف للتحميل مع الكود المحدث
                    const fullCode = this.generateUpdatedCode(currentData);
                    const blob = new Blob([fullCode], { type: 'text/html; charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `store-with-saved-data-${new Date().toISOString().split('T')[0]}.html`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    // تحديث معلومات الحفظ الداخلي
                    this.updateInternalDataInfo();
                    
                    this.logOperation('حفظ داخلي', 'تم حفظ البيانات داخل الكود بنجاح');
                    notificationSystem.success('تم الحفظ!', 'تم حفظ البيانات داخل الكود وتحميل الملف المحدث');
                } catch (error) {
                    this.logOperation('خطأ', `فشل في الحفظ الداخلي: ${error.message}`);
                    notificationSystem.error('خطأ!', 'فشل في حفظ البيانات داخل الكود');
                }
            }

            // إنشاء الكود المحدث مع البيانات الجديدة
            generateUpdatedCode(newData) {
                // الحصول على الكود الحالي
                const currentHTML = document.documentElement.outerHTML;
                
                // البحث عن دالة getInternalDataStore وتحديثها
                const oldFunctionRegex = /getInternalDataStore\(\)\s*\{[\s\S]*?return\s*\{[\s\S]*?\};\s*\}/;
                
                const newFunction = `getInternalDataStore() {
                return ${JSON.stringify(newData, null, 8)};
            }`;
                
                // استبدال الدالة القديمة بالجديدة
                let updatedHTML = currentHTML.replace(oldFunctionRegex, newFunction);
                
                // إذا لم يتم العثور على الدالة، إضافتها
                if (updatedHTML === currentHTML) {
                    const insertPoint = updatedHTML.indexOf('this.internalDataStore = this.getInternalDataStore();');
                    if (insertPoint !== -1) {
                        const beforeInsert = updatedHTML.substring(0, insertPoint);
                        const afterInsert = updatedHTML.substring(insertPoint);
                        updatedHTML = beforeInsert + `
            // البيانات المحفوظة داخل الكود - آخر تحديث: ${new Date().toLocaleString('ar-SA')}
            ${newFunction}

            ` + afterInsert;
                    }
                }
                
                return updatedHTML;
            }

            // استعادة البيانات من الكود الداخلي
            restoreFromInternalCode() {
                try {
                    if (!this.internalDataStore.lastUpdate) {
                        notificationSystem.warning('لا توجد بيانات!', 'لا توجد بيانات محفوظة داخل الكود للاستعادة');
                        return;
                    }
                    
                    // استعادة البيانات
                    if (this.internalDataStore.products) {
                        this.products = [...this.internalDataStore.products];
                    }
                    if (this.internalDataStore.categories) {
                        this.categories = [...this.internalDataStore.categories];
                    }
                    if (this.internalDataStore.settings) {
                        this.settings = { ...this.internalDataStore.settings };
                    }
                    
                    // حفظ البيانات المستعادة
                    this.saveData('products', this.products);
                    this.saveData('categories', this.categories);
                    this.saveData('settings', this.settings);
                    
                    // تحديث الواجهة
                    this.renderProducts();
                    this.renderAdminProducts();
                    this.renderCategories();
                    this.renderCategoriesGrid();
                    this.updateCategorySelects();
                    this.applySettings();
                    
                    const restoreDate = new Date(this.internalDataStore.lastUpdate).toLocaleString('ar-SA');
                    this.logOperation('استعادة', `تم استعادة البيانات من الكود الداخلي (${restoreDate})`);
                    notificationSystem.success('تم الاستعادة!', `تم استعادة البيانات من النسخة المحفوظة في ${restoreDate}`);
                } catch (error) {
                    this.logOperation('خطأ', `فشل في استعادة البيانات: ${error.message}`);
                    notificationSystem.error('خطأ!', 'فشل في استعادة البيانات من الكود الداخلي');
                }
            }

            // تحديث معلومات البيانات الداخلية
            updateInternalDataInfo() {
                const internalDataSizeEl = document.getElementById('internalDataSize');
                const internalLastUpdateEl = document.getElementById('internalLastUpdate');
                
                if (this.internalDataStore.lastUpdate) {
                    const dataSize = Math.round(JSON.stringify(this.internalDataStore).length / 1024 * 100) / 100;
                    const lastUpdate = new Date(this.internalDataStore.lastUpdate).toLocaleString('ar-SA');
                    
                    if (internalDataSizeEl) {
                        internalDataSizeEl.textContent = `${dataSize} KB`;
                    }
                    if (internalLastUpdateEl) {
                        internalLastUpdateEl.textContent = lastUpdate;
                    }
                } else {
                    if (internalDataSizeEl) {
                        internalDataSizeEl.textContent = '0 KB';
                    }
                    if (internalLastUpdateEl) {
                        internalLastUpdateEl.textContent = '-';
                    }
                }
            }

            // تحميل الكود المحدث مع جميع التعديلات
            downloadUpdatedCode() {
                try {
                    const currentData = {
                        lastUpdate: new Date().toISOString(),
                        products: this.products,
                        categories: this.categories,
                        settings: this.settings,
                        version: '1.2'
                    };
                    
                    // إنشاء الكود المحدث
                    const updatedCode = this.generateUpdatedCode(currentData);
                    
                    // تحميل الملف
                    const blob = new Blob([updatedCode], { type: 'text/html; charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `store-updated-${new Date().toISOString().split('T')[0]}.html`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    // تحديث البيانات الداخلية
                    this.internalDataStore = currentData;
                    this.updateInternalDataInfo();
                    
                    this.logOperation('تحميل', 'تم تحميل الكود المحدث بنجاح');
                    notificationSystem.success('تم التحميل!', 'تم تحميل الملف المحدث مع جميع التعديلات');
                    
                    // عرض تعليمات النشر
                    setTimeout(() => {
                        this.showPublishInstructions();
                    }, 1500);
                    
                } catch (error) {
                    this.logOperation('خطأ', `فشل في تحميل الكود المحدث: ${error.message}`);
                    notificationSystem.error('خطأ!', 'فشل في تحميل الكود المحدث');
                }
            }

            // تصدير إلى جوجل درايف (محاكاة)
            exportToGoogleDrive() {
                try {
                    const data = {
                        products: this.products,
                        categories: this.categories,
                        settings: this.settings,
                        operationLog: this.operationLog,
                        exportDate: new Date().toISOString(),
                        storeInfo: {
                            name: this.settings.storeName,
                            version: '1.0',
                            account: 'ivetchos@gmail.com'
                        }
                    };
                    
                    // محاكاة الرفع إلى جوجل درايف
                    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `store-backup-googledrive-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.logOperation('نسخ احتياطي', 'تم إنشاء نسخة احتياطية لجوجل درايف');
                    notificationSystem.success('تم الحفظ!', 'تم إنشاء نسخة احتياطية لجوجل درايف بنجاح');
                } catch (error) {
                    this.logOperation('خطأ', `فشل في النسخ الاحتياطي: ${error.message}`);
                    notificationSystem.error('خطأ!', 'فشل في إنشاء النسخة الاحتياطية');
                }
            }

            // الأقسام الافتراضية
            getDefaultCategories() {
                return [
                    {
                        id: 'electronics',
                        name: 'إلكترونيات',
                        description: 'أجهزة إلكترونية وملحقاتها',
                        icon: 'fas fa-laptop',
                        image: '',
                        active: true
                    },
                    {
                        id: 'clothing',
                        name: 'ملابس',
                        description: 'ملابس رجالية ونسائية وأطفال',
                        icon: 'fas fa-tshirt',
                        image: '',
                        active: true
                    },
                    {
                        id: 'accessories',
                        name: 'إكسسوارات',
                        description: 'إكسسوارات متنوعة',
                        icon: 'fas fa-gem',
                        image: '',
                        active: true
                    }
                ];
            }

            // الإعدادات الافتراضية
            getDefaultSettings() {
                return {
                    storeName: 'متجر الأناقة',
                    storeDescription: 'اكتشف أحدث المنتجات بأفضل الأسعار',
                    currency: 'دج',
                    logo: '',
                    phone: '',
                    email: '',
                    address: '',
                    hours: '',
                    facebookLink: '',
                    instagramLink: '',
                    tiktokLink: '',
                    whatsappLink: '',
                    foundedYear: '',
                    customerCount: ''
                };
            }

            // تهيئة النظام
            init() {
                this.loadDefaultProducts();
                this.renderProducts();
                this.renderCategoriesGrid();
                this.renderCategories();
                this.updateCategorySelects();
                this.updateStats();
                this.updateDatabaseStats();
                this.updateSaveStatus();
                this.updateOperationLog();
                this.updateWishlistCount();
                this.updateInternalDataInfo();
                this.applySettings();
                
                // تسجيل بداية الجلسة
                this.logOperation('نظام', 'تم تشغيل النظام بنجاح');
            }

            // تحميل المنتجات الافتراضية
            loadDefaultProducts() {
                if (this.products.length === 0) {
                    this.products = [
                        {
                            id: 'p1',
                            name: 'سماعات بلوتوث لاسلكية',
                            description: 'سماعات لاسلكية عالية الجودة مع عزل للضوضاء وبطارية تدوم 30 ساعة',
                            price: 299,
                            discount: 20,
                            category: 'electronics',
                            brand: 'Sony',
                            model: 'WH-1000XM4',
                            stock: 15,
                            active: true,
                            images: [],
                            barcode: { enabled: true, code: '1234567890123' },
                            properties: {
                                colors: { enabled: true, values: ['أسود', 'أبيض', 'فضي'] },
                                sizes: { enabled: false, values: [] },
                                shipping: { enabled: true, cost: 25, time: '2-3 أيام', details: 'توصيل سريع لجميع مناطق المملكة', free: false },
                                return: { enabled: true, days: 14, free: true },
                                warranty: { enabled: true, period: 'سنتان', details: 'ضمان شامل ضد عيوب الصناعة' },
                                specs: { enabled: true, details: 'الوزن: 254 جرام\nالبطارية: 30 ساعة\nالاتصال: بلوتوث 5.0' }
                            }
                        },
                        {
                            id: 'p2',
                            name: 'ساعة ذكية متطورة',
                            description: 'ساعة ذكية متعددة الاستخدامات مقاومة للماء مع مراقبة الصحة',
                            price: 449,
                            discount: 15,
                            category: 'electronics',
                            brand: 'Apple',
                            model: 'Watch Series 8',
                            stock: 8,
                            active: true,
                            images: [],
                            barcode: { enabled: true, code: '2345678901234' },
                            properties: {
                                colors: { enabled: true, values: ['أسود', 'أبيض', 'وردي'] },
                                sizes: { enabled: true, values: ['38mm', '42mm', '44mm'] },
                                shipping: { enabled: true, cost: 0, time: '1-2 أيام', details: 'توصيل مجاني خلال 24 ساعة', free: true },
                                return: { enabled: true, days: 30, free: true },
                                warranty: { enabled: true, period: 'سنة واحدة', details: 'ضمان من الشركة المصنعة' },
                                specs: { enabled: true, details: 'الشاشة: OLED\nمقاوم للماء: 50 متر\nالبطارية: 18 ساعة' }
                            }
                        },
                        {
                            id: 'p3',
                            name: 'حقيبة ظهر عصرية',
                            description: 'حقيبة ظهر عصرية مقاومة للماء مع مساحة للحاسوب المحمول',
                            price: 159,
                            discount: 0,
                            category: 'accessories',
                            brand: 'Nike',
                            model: 'Backpack Pro',
                            stock: 25,
                            active: true,
                            images: [],
                            barcode: { enabled: true, code: '3456789012345' },
                            properties: {
                                colors: { enabled: true, values: ['أسود', 'رمادي', 'أزرق'] },
                                sizes: { enabled: false, values: [] },
                                shipping: { enabled: true, cost: 15, time: '3-5 أيام', details: 'توصيل عادي', free: false },
                                return: { enabled: true, days: 7, free: false },
                                warranty: { enabled: false, period: '', details: '' },
                                specs: { enabled: true, details: 'السعة: 25 لتر\nمقاوم للماء\nجيب للحاسوب المحمول' }
                            }
                        },
                        {
                            id: 'p4',
                            name: 'مكبر صوت محمول',
                            description: 'مكبر صوت محمول بجودة عالية وبطارية طويلة المدى',
                            price: 199,
                            discount: 25,
                            category: 'electronics',
                            brand: 'JBL',
                            model: 'Charge 5',
                            stock: 0,
                            active: true,
                            images: [],
                            barcode: { enabled: true, code: '4567890123456' },
                            properties: {
                                colors: { enabled: true, values: ['أسود', 'أحمر', 'أزرق'] },
                                sizes: { enabled: false, values: [] },
                                shipping: { enabled: true, cost: 20, time: '2-4 أيام', details: 'توصيل آمن ومحمي', free: false },
                                return: { enabled: true, days: 14, free: true },
                                warranty: { enabled: true, period: 'سنة واحدة', details: 'ضمان ضد عيوب التصنيع' },
                                specs: { enabled: true, details: 'القوة: 20 واط\nالبطارية: 20 ساعة\nمقاوم للماء: IPX7' }
                            }
                        },
                        {
                            id: 'p5',
                            name: 'قميص قطني فاخر',
                            description: 'قميص قطني عالي الجودة مناسب للمناسبات الرسمية والكاجوال',
                            price: 89,
                            discount: 10,
                            category: 'clothing',
                            brand: 'Zara',
                            model: 'Classic Shirt',
                            stock: 50,
                            active: true,
                            images: [],
                            barcode: { enabled: true, code: '5678901234567' },
                            properties: {
                                colors: { enabled: true, values: ['أبيض', 'أزرق فاتح', 'رمادي'] },
                                sizes: { enabled: true, values: ['S', 'M', 'L', 'XL', 'XXL'] },
                                shipping: { enabled: true, cost: 10, time: '2-3 أيام', details: 'توصيل سريع للملابس', free: false },
                                return: { enabled: true, days: 30, free: true },
                                warranty: { enabled: false, period: '', details: '' },
                                specs: { enabled: true, details: 'المادة: قطن 100%\nالقصة: عادية\nسهل العناية' }
                            }
                        },
                        {
                            id: 'p6',
                            name: 'نظارات شمسية أنيقة',
                            description: 'نظارات شمسية عصرية مع حماية من الأشعة فوق البنفسجية',
                            price: 129,
                            discount: 0,
                            category: 'accessories',
                            brand: 'Ray-Ban',
                            model: 'Aviator',
                            stock: 30,
                            active: true,
                            images: [],
                            barcode: { enabled: true, code: '6789012345678' },
                            properties: {
                                colors: { enabled: true, values: ['ذهبي', 'فضي', 'أسود'] },
                                sizes: { enabled: false, values: [] },
                                shipping: { enabled: true, cost: 12, time: '1-3 أيام', details: 'توصيل آمن للنظارات', free: false },
                                return: { enabled: true, days: 14, free: true },
                                warranty: { enabled: true, period: '6 أشهر', details: 'ضمان ضد الكسر' },
                                specs: { enabled: true, details: 'حماية UV400\nعدسات مستقطبة\nإطار معدني' }
                            }
                        }
                    ];
                    this.saveData('products', this.products);
                }
            }

            // حساب السعر بعد التخفيض
            calculateDiscountedPrice(price, discount) {
                return price - (price * discount / 100);
            }

            // تحديد حالة المخزون
            getStockStatus(stock) {
                if (stock === 0) return { status: 'نفد المخزون', class: 'stock-out' };
                if (stock <= 5) return { status: `متبقي ${stock} فقط`, class: 'stock-low' };
                return { status: 'متوفر', class: 'stock-available' };
            }

            // عرض الأقسام الدائرية
            renderCategoriesGrid() {
                const container = document.getElementById('categoriesGrid');
                const activeCategories = this.categories.filter(c => c.active);
                
                container.innerHTML = activeCategories.map(category => {
                    const productCount = this.products.filter(p => p.category === category.id && p.active).length;
                    
                    return `
                        <div class="category-circle" onclick="filterByCategory('${category.id}')">
                            <div class="category-icon-container">
                                <i class="${category.icon || 'fas fa-folder'} category-icon"></i>
                            </div>
                            <div class="category-name">${category.name}</div>
                            <div class="category-count">${productCount} منتج</div>
                        </div>
                    `;
                }).join('');
            }

            // عرض المنتجات في المتجر
            renderProducts() {
                const container = document.getElementById('productsContainer');
                const activeProducts = this.products.filter(p => p.active);
                
                container.innerHTML = activeProducts.map(product => {
                    const category = this.categories.find(c => c.id === product.category);
                    const discountedPrice = this.calculateDiscountedPrice(product.price, product.discount);
                    const hasDiscount = product.discount > 0;
                    const savedAmount = hasDiscount ? product.price - discountedPrice : 0;
                    const stockInfo = this.getStockStatus(product.stock);
                    
                    return `
                        <div class="product-card" data-product-id="${product.id}">
                            <!-- صورة المنتج -->
                            <div class="product-image-container" style="position: relative;">
                                ${hasDiscount ? `<div class="discount-badge">-${product.discount}%</div>` : ''}
                                ${product.stock > 0 && product.stock <= 5 ? '<div class="product-badge badge-hot">كمية محدودة</div>' : ''}
                                ${product.stock === 0 ? '<div class="product-badge" style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white;">نفد المخزون</div>' : ''}
                                
                                ${product.images && product.images.length > 0 ? 
                                    `<div class="product-image-gallery">
                                        <img src="${product.images[0]}" alt="${product.name}" class="product-image main-image">
                                        ${product.images.length > 1 ? `
                                            <div class="image-indicators">
                                                ${product.images.map((_, index) => `<div class="indicator ${index === 0 ? 'active' : ''}" data-index="${index}"></div>`).join('')}
                                            </div>
                                            <button class="image-nav prev-btn" onclick="changeProductImage('${product.id}', -1)">
                                                <i class="fas fa-chevron-left"></i>
                                            </button>
                                            <button class="image-nav next-btn" onclick="changeProductImage('${product.id}', 1)">
                                                <i class="fas fa-chevron-right"></i>
                                            </button>
                                        ` : ''}
                                    </div>` :
                                    `<div class="w-full h-full flex items-center justify-center text-white">
                                        <div class="text-center">
                                            <i class="fas fa-image text-4xl mb-2 opacity-50"></i>
                                            <div class="text-sm opacity-75">${product.name}</div>
                                        </div>
                                    </div>`
                                }
                                
                                <!-- زر معاينة المنتج -->
                                <button class="product-preview-btn" onclick="showProductPreview('${product.id}')">
                                    <i class="fas fa-eye"></i>
                                    <span>معاينة</span>
                                </button>
                            </div>
                            
                            <!-- محتوى المنتج -->
                            <div class="product-content">
                                <!-- العنوان والتقييم -->
                                <h3 class="product-title">${product.name}</h3>
                                
                                <!-- معلومات إضافية -->
                                <div class="product-meta">
                                    <div class="rating-stars">
                                        <i class="fas fa-star star"></i>
                                        <i class="fas fa-star star"></i>
                                        <i class="fas fa-star star"></i>
                                        <i class="fas fa-star star"></i>
                                        <i class="far fa-star star"></i>
                                        <span class="mr-1">(4.0)</span>
                                    </div>
                                    ${category ? `<span><i class="fas fa-tag ml-1"></i>${category.name}</span>` : ''}
                                </div>
                                
                                <!-- الوصف -->
                                <p class="product-description">${product.description}</p>
                                
                                <!-- معلومات المخزون -->
                                <div class="stock-info ${stockInfo.class}">
                                    <i class="fas fa-box ml-2"></i>
                                    <span class="font-medium">${stockInfo.status}</span>
                                </div>
                                
                                <!-- قسم السعر -->
                                <div class="price-section">
                                    <div class="current-price">${Math.round(discountedPrice)} ${this.settings.currency}</div>
                                    ${hasDiscount ? `
                                        <div class="price-row">
                                            <span class="original-price">${product.price} ${this.settings.currency}</span>
                                            <span class="savings">وفر ${Math.round(savedAmount)} ${this.settings.currency}</span>
                                        </div>
                                    ` : ''}
                                </div>
                                
                                <!-- أزرار الإجراءات -->
                                <div class="product-actions">
                                    <button class="btn-primary order-now ${product.stock === 0 ? 'opacity-50 cursor-not-allowed' : ''}" 
                                            data-product='${JSON.stringify(product)}' ${product.stock === 0 ? 'disabled' : ''}>
                                        <i class="fas fa-shopping-cart"></i>
                                        ${product.stock === 0 ? 'غير متوفر' : 'اطلب الآن'}
                                    </button>
                                    <button class="btn-secondary add-to-wishlist" data-product-id="${product.id}" title="إضافة للمفضلة">
                                        <i class="far fa-heart"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                // إضافة مستمعي الأحداث
                container.querySelectorAll('.order-now').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        if (!e.target.disabled) {
                            const product = JSON.parse(e.target.dataset.product);
                            this.showOrderModal(product);
                        }
                    });
                });

                container.querySelectorAll('.add-to-wishlist').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const productId = e.target.closest('button').dataset.productId;
                        this.toggleWishlist(productId, e.target.closest('button'));
                    });
                });
            }

            // إدارة المفضلة
            toggleWishlist(productId, button) {
                let wishlist = this.loadData('wishlist') || [];
                const isInWishlist = wishlist.includes(productId);
                
                if (isInWishlist) {
                    wishlist = wishlist.filter(id => id !== productId);
                    button.innerHTML = '<i class="far fa-heart"></i>';
                    button.classList.remove('wishlist-active');
                    notificationSystem.info('تم الإزالة', 'تم إزالة المنتج من المفضلة');
                } else {
                    wishlist.push(productId);
                    button.innerHTML = '<i class="fas fa-heart"></i>';
                    button.classList.add('wishlist-active');
                    notificationSystem.success('تم الإضافة', 'تم إضافة المنتج للمفضلة');
                }
                
                this.saveData('wishlist', wishlist);
                this.updateWishlistCount();
            }

            // تحديث عداد المفضلة
            updateWishlistCount() {
                const wishlist = this.loadData('wishlist') || [];
                const countElement = document.getElementById('wishlistCount');
                
                if (wishlist.length > 0) {
                    countElement.textContent = wishlist.length;
                    countElement.classList.remove('hidden');
                } else {
                    countElement.classList.add('hidden');
                }
            }

            // عرض المنتجات المفضلة
            showWishlist() {
                const wishlist = this.loadData('wishlist') || [];
                const modal = document.getElementById('wishlistModal');
                const content = document.getElementById('wishlistContent');
                
                if (wishlist.length === 0) {
                    content.innerHTML = `
                        <div class="text-center py-12">
                            <i class="fas fa-heart text-6xl text-gray-300 mb-4"></i>
                            <h3 class="text-xl font-bold text-gray-600 mb-2">لا توجد منتجات مفضلة</h3>
                            <p class="text-gray-500 mb-6">لم تقم بإضافة أي منتجات للمفضلة بعد</p>
                            <button onclick="closeWishlistModal()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition">
                                تصفح المنتجات
                            </button>
                        </div>
                    `;
                } else {
                    const wishlistProducts = wishlist.map(id => this.products.find(p => p.id === id)).filter(p => p);
                    
                    content.innerHTML = `
                        <div class="grid grid-cols-1 gap-4">
                            ${wishlistProducts.map(product => {
                                const category = this.categories.find(c => c.id === product.category);
                                const discountedPrice = this.calculateDiscountedPrice(product.price, product.discount);
                                const stockInfo = this.getStockStatus(product.stock);
                                
                                return `
                                    <div class="flex items-center gap-4 p-4 border rounded-lg hover:bg-gray-50 transition">
                                        <div class="w-20 h-20 flex-shrink-0">
                                            ${product.images && product.images.length > 0 ? 
                                                `<img src="${product.images[0]}" alt="${product.name}" class="w-full h-full object-cover rounded-lg">` :
                                                `<div class="w-full h-full bg-gray-200 rounded-lg flex items-center justify-center">
                                                    <i class="fas fa-image text-gray-400"></i>
                                                </div>`
                                            }
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="font-bold text-gray-800 mb-1">${product.name}</h4>
                                            <p class="text-sm text-gray-600 mb-2">${product.description}</p>
                                            <div class="flex items-center justify-between">
                                                <div>
                                                    <span class="text-blue-600 font-bold">${Math.round(discountedPrice)} ${this.settings.currency}</span>
                                                    ${product.discount > 0 ? `<span class="text-sm text-gray-500 line-through mr-2">${product.price} ${this.settings.currency}</span>` : ''}
                                                </div>
                                                <div class="flex items-center gap-2">
                                                    <span class="text-xs ${stockInfo.class}">${stockInfo.status}</span>
                                                    ${category ? `<span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">${category.name}</span>` : ''}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="flex flex-col gap-2">
                                            <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition text-sm ${product.stock === 0 ? 'opacity-50 cursor-not-allowed' : ''}" 
                                                    onclick="orderProductFromWishlist('${product.id}')" ${product.stock === 0 ? 'disabled' : ''}>
                                                <i class="fas fa-shopping-cart ml-1"></i>
                                                ${product.stock === 0 ? 'غير متوفر' : 'اطلب'}
                                            </button>
                                            <button class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition text-sm" 
                                                    onclick="removeFromWishlist('${product.id}')">
                                                <i class="fas fa-trash ml-1"></i>
                                                إزالة
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <div class="mt-6 text-center">
                            <button onclick="clearWishlist()" class="bg-gray-600 text-white px-6 py-3 rounded-lg hover:bg-gray-700 transition">
                                <i class="fas fa-trash ml-2"></i>مسح جميع المفضلة
                            </button>
                        </div>
                    `;
                }
                
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            // إزالة منتج من المفضلة
            removeFromWishlist(productId) {
                let wishlist = this.loadData('wishlist') || [];
                wishlist = wishlist.filter(id => id !== productId);
                this.saveData('wishlist', wishlist);
                this.updateWishlistCount();
                this.showWishlist(); // إعادة عرض المفضلة
                
                // تحديث أزرار المفضلة في المنتجات
                const wishlistButtons = document.querySelectorAll(`[data-product-id="${productId}"] .add-to-wishlist`);
                wishlistButtons.forEach(button => {
                    button.innerHTML = '<i class="far fa-heart"></i>';
                    button.classList.remove('wishlist-active');
                });
                
                notificationSystem.info('تم الإزالة', 'تم إزالة المنتج من المفضلة');
            }

            // مسح جميع المفضلة
            clearWishlist() {
                this.showDeleteConfirmation(
                    'مسح المفضلة',
                    'هل تريد مسح جميع المنتجات المفضلة؟',
                    () => {
                        this.saveData('wishlist', []);
                        this.updateWishlistCount();
                        this.showWishlist();
                        
                        // تحديث جميع أزرار المفضلة
                        document.querySelectorAll('.add-to-wishlist').forEach(button => {
                            button.innerHTML = '<i class="far fa-heart"></i>';
                            button.classList.remove('wishlist-active');
                        });
                        
                        notificationSystem.success('تم المسح', 'تم مسح جميع المنتجات المفضلة');
                    },
                    'مسح الكل'
                );
            }

            // عرض نموذج الطلب
            showOrderModal(product) {
                const modal = document.getElementById('orderModal');
                const discountedPrice = this.calculateDiscountedPrice(product.price, product.discount);
                
                document.getElementById('orderProductName').textContent = product.name;
                document.getElementById('orderProductDesc').textContent = product.description;
                document.getElementById('orderProductPrice').textContent = `${Math.round(discountedPrice)} ${this.settings.currency}`;
                
                // عرض الصورة إذا كانت متوفرة
                const imageContainer = document.getElementById('orderProductImage');
                if (product.images && product.images.length > 0) {
                    imageContainer.innerHTML = `<img src="${product.images[0]}" alt="${product.name}" class="w-20 h-20 object-cover rounded-lg shadow-md">`;
                } else {
                    imageContainer.innerHTML = `
                        <div class="w-20 h-20 bg-gradient-to-br from-blue-100 to-blue-200 rounded-lg flex items-center justify-center">
                            <i class="fas fa-image text-blue-400 text-xl"></i>
                        </div>
                    `;
                }
                
                // عرض السعر الأصلي إذا كان هناك تخفيض
                const originalPriceElement = document.getElementById('orderOriginalPrice');
                if (product.discount > 0) {
                    originalPriceElement.textContent = `${product.price} ${this.settings.currency}`;
                    originalPriceElement.style.display = 'inline';
                } else {
                    originalPriceElement.style.display = 'none';
                }
                
                // عرض الكود بار إذا كان متوفراً
                const barcodeRow = document.getElementById('barcodeRow');
                const summaryBarcode = document.getElementById('summaryBarcode');
                if (product.barcode && product.barcode.enabled && product.barcode.code) {
                    barcodeRow.style.display = 'flex';
                    summaryBarcode.textContent = product.barcode.code;
                } else {
                    barcodeRow.style.display = 'none';
                }
                
                // تحديث السعر الإجمالي
                window.currentProductPrice = Math.round(discountedPrice);
                window.currentProduct = product;
                document.getElementById('quantity').value = 1;
                
                // إعادة تعيين النموذج
                document.getElementById('orderForm').reset();
                document.getElementById('quantity').value = 1;
                document.getElementById('customerState').value = '';
                document.getElementById('deliveryTypeSection').style.display = 'none';
                
                updateOrderSummary();
                
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            // إضافة منتج جديد
            addProduct(productData) {
                const product = {
                    id: 'p' + Date.now(),
                    ...productData,
                    discount: productData.discount || 0,
                    stock: productData.stock || 0,
                    active: productData.active !== undefined ? productData.active : true,
                    barcode: productData.barcode || { enabled: false, code: '' },
                    properties: productData.properties || {
                        colors: { enabled: false, values: [] },
                        sizes: { enabled: false, values: [] },
                        shipping: { enabled: false, cost: 0, time: '', free: false },
                        return: { enabled: false, days: 14, free: false },
                        warranty: { enabled: false, period: '' },
                        specs: { enabled: false, details: '' }
                    }
                };
                
                this.products.push(product);
                this.saveData('products', this.products);
                this.renderProducts();
                this.renderAdminProducts();
                notificationSystem.success('تم بنجاح!', 'تم إضافة المنتج الجديد بنجاح');
                return product;
            }

            // تحديث منتج
            updateProduct(id, productData) {
                const index = this.products.findIndex(p => p.id === id);
                if (index !== -1) {
                    this.products[index] = { ...this.products[index], ...productData };
                    this.saveData('products', this.products);
                    this.renderProducts();
                    this.renderAdminProducts();
                    notificationSystem.success('تم التحديث!', 'تم تحديث المنتج بنجاح');
                    return this.products[index];
                }
                return null;
            }

            // حذف منتج
            deleteProduct(id) {
                const product = this.products.find(p => p.id === id);
                this.products = this.products.filter(p => p.id !== id);
                this.saveData('products', this.products);
                this.renderProducts();
                this.renderAdminProducts();
                notificationSystem.success('تم الحذف!', `تم حذف المنتج "${product?.name || 'غير معروف'}" بنجاح`);
            }

            // إضافة قسم جديد
            addCategory(categoryData) {
                const category = {
                    id: 'c' + Date.now(),
                    ...categoryData,
                    active: categoryData.active !== undefined ? categoryData.active : true
                };
                
                this.categories.push(category);
                this.saveData('categories', this.categories);
                this.renderCategoriesGrid();
                this.renderCategories();
                this.updateCategorySelects();
                notificationSystem.success('تم بنجاح!', 'تم إضافة القسم الجديد بنجاح');
                return category;
            }

            // تحديث قسم
            updateCategory(id, categoryData) {
                const index = this.categories.findIndex(c => c.id === id);
                if (index !== -1) {
                    this.categories[index] = { ...this.categories[index], ...categoryData };
                    this.saveData('categories', this.categories);
                    this.renderCategoriesGrid();
                    this.renderCategories();
                    this.updateCategorySelects();
                    notificationSystem.success('تم التحديث!', 'تم تحديث القسم بنجاح');
                    return this.categories[index];
                }
                return null;
            }

            // حذف قسم
            deleteCategory(id) {
                const category = this.categories.find(c => c.id === id);
                this.categories = this.categories.filter(c => c.id !== id);
                this.saveData('categories', this.categories);
                this.renderCategoriesGrid();
                this.renderCategories();
                this.updateCategorySelects();
                notificationSystem.success('تم الحذف!', `تم حذف القسم "${category?.name || 'غير معروف'}" بنجاح`);
                return true;
            }

            // عرض نافذة تأكيد مخصصة
            showDeleteConfirmation(title, message, onConfirm, confirmText = 'حذف', cancelText = 'إلغاء') {
                // إنشاء نافذة التأكيد
                const confirmModal = document.createElement('div');
                confirmModal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
                confirmModal.innerHTML = `
                    <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full mx-4 transform transition-all">
                        <div class="p-6">
                            <div class="flex items-center justify-center w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full">
                                <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
                            </div>
                            <h3 class="text-xl font-bold text-center text-gray-800 mb-3">${title}</h3>
                            <p class="text-gray-600 text-center mb-6 leading-relaxed whitespace-pre-line">${message}</p>
                            <div class="flex gap-3 ${onConfirm ? 'justify-center' : 'justify-center'}">
                                ${onConfirm ? `
                                    <button class="confirm-btn flex-1 bg-red-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-red-700 transition-colors">
                                        ${confirmText}
                                    </button>
                                    <button class="cancel-btn flex-1 bg-gray-200 text-gray-800 px-6 py-3 rounded-xl font-semibold hover:bg-gray-300 transition-colors">
                                        ${cancelText}
                                    </button>
                                ` : `
                                    <button class="cancel-btn bg-blue-600 text-white px-8 py-3 rounded-xl font-semibold hover:bg-blue-700 transition-colors">
                                        ${confirmText}
                                    </button>
                                `}
                            </div>
                        </div>
                    </div>
                `;

                document.body.appendChild(confirmModal);
                document.body.style.overflow = 'hidden';

                // إضافة الأحداث
                const confirmBtn = confirmModal.querySelector('.confirm-btn');
                const cancelBtn = confirmModal.querySelector('.cancel-btn');

                const closeModal = () => {
                    document.body.removeChild(confirmModal);
                    document.body.style.overflow = 'auto';
                };

                if (confirmBtn && onConfirm) {
                    confirmBtn.addEventListener('click', () => {
                        onConfirm();
                        closeModal();
                    });
                }

                if (cancelBtn) {
                    cancelBtn.addEventListener('click', closeModal);
                }

                // إغلاق عند النقر خارج النافذة
                confirmModal.addEventListener('click', (e) => {
                    if (e.target === confirmModal) {
                        closeModal();
                    }
                });

                // إغلاق بمفتاح Escape
                const handleEscape = (e) => {
                    if (e.key === 'Escape') {
                        closeModal();
                        document.removeEventListener('keydown', handleEscape);
                    }
                };
                document.addEventListener('keydown', handleEscape);
            }

            // تطبيق تخفيض جماعي
            applyBulkDiscount(categoryId, discountPercent) {
                let updatedCount = 0;
                this.products.forEach(product => {
                    if (!categoryId || product.category === categoryId) {
                        product.discount = discountPercent;
                        updatedCount++;
                    }
                });
                
                this.saveData('products', this.products);
                this.renderProducts();
                this.renderAdminProducts();
                this.renderDiscountedProducts();
                return updatedCount;
            }

            // إزالة التخفيضات
            removeBulkDiscount(categoryId) {
                let updatedCount = 0;
                this.products.forEach(product => {
                    if (!categoryId || product.category === categoryId) {
                        product.discount = 0;
                        updatedCount++;
                    }
                });
                
                this.saveData('products', this.products);
                this.renderProducts();
                this.renderAdminProducts();
                this.renderDiscountedProducts();
                return updatedCount;
            }

            // عرض المنتجات في لوحة الإدارة
            renderAdminProducts() {
                const tbody = document.getElementById('productsTableBody');
                
                tbody.innerHTML = this.products.map(product => {
                    const category = this.categories.find(c => c.id === product.category);
                    const discountedPrice = this.calculateDiscountedPrice(product.price, product.discount);
                    
                    return `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="px-4 py-3">
                                ${product.images && product.images.length > 0 ? 
                                    `<div class="relative">
                                        <img src="${product.images[0]}" alt="${product.name}" class="w-12 h-12 object-cover rounded">
                                        ${product.images.length > 1 ? `<span class="absolute -top-1 -right-1 bg-blue-600 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">${product.images.length}</span>` : ''}
                                    </div>` :
                                    `<div class="w-12 h-12 bg-gray-200 rounded flex items-center justify-center">
                                        <i class="fas fa-image text-gray-400"></i>
                                    </div>`
                                }
                            </td>
                            <td class="px-4 py-3 font-medium">${product.name}</td>
                            <td class="px-4 py-3">${category ? category.name : 'غير محدد'}</td>
                            <td class="px-4 py-3">
                                ${product.barcode && product.barcode.enabled && product.barcode.code ? 
                                    `<div class="flex items-center">
                                        <i class="fas fa-barcode text-gray-600 ml-2"></i>
                                        <span class="font-mono text-sm">${product.barcode.code}</span>
                                    </div>` :
                                    '<span class="text-gray-400">-</span>'
                                }
                            </td>
                            <td class="px-4 py-3">
                                ${product.discount > 0 ? 
                                    `<span class="text-blue-600 font-bold">${Math.round(discountedPrice)} ${this.settings.currency}</span>
                                     <br><span class="text-sm text-gray-500 line-through">${product.price} ${this.settings.currency}</span>` :
                                    `<span class="text-blue-600 font-bold">${product.price} ${this.settings.currency}</span>`
                                }
                            </td>
                            <td class="px-4 py-3">
                                ${product.discount > 0 ? 
                                    `<span class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm">${product.discount}%</span>` :
                                    '<span class="text-gray-400">-</span>'
                                }
                            </td>
                            <td class="px-4 py-3">${product.stock || 0}</td>
                            <td class="px-4 py-3">
                                <span class="px-2 py-1 rounded text-sm ${product.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                    ${product.active ? 'نشط' : 'غير نشط'}
                                </span>
                            </td>
                            <td class="px-4 py-3">
                                <button class="text-blue-600 hover:text-blue-800 ml-2 edit-product" data-id="${product.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="text-red-600 hover:text-red-800 delete-product" data-id="${product.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');

                // تحديث عداد المنتجات
                document.getElementById('productsCount').textContent = `${this.products.length} منتج`;

                // إضافة مستمعي الأحداث
                tbody.querySelectorAll('.edit-product').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const productId = e.target.closest('button').dataset.id;
                        this.editProduct(productId);
                    });
                });

                tbody.querySelectorAll('.delete-product').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        const productId = e.target.closest('button').dataset.id;
                        const product = this.products.find(p => p.id === productId);
                        const productName = product ? product.name : 'المنتج';
                        
                        // إنشاء نافذة تأكيد مخصصة
                        this.showDeleteConfirmation(
                            'حذف المنتج',
                            `هل أنت متأكد من حذف المنتج "${productName}"؟\nهذا الإجراء لا يمكن التراجع عنه.`,
                            () => {
                                this.deleteProduct(productId);
                            }
                        );
                    });
                });
            }

            // عرض الأقسام في لوحة الإدارة
            renderCategories() {
                const tbody = document.getElementById('categoriesTableBody');
                
                tbody.innerHTML = this.categories.map(category => {
                    const productCount = this.products.filter(p => p.category === category.id).length;
                    
                    return `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="px-4 py-3">
                                ${category.image ? 
                                    `<img src="${category.image}" alt="${category.name}" class="w-12 h-12 object-cover rounded">` :
                                    `<div class="w-12 h-12 bg-gray-200 rounded flex items-center justify-center">
                                        <i class="fas fa-image text-gray-400"></i>
                                    </div>`
                                }
                            </td>
                            <td class="px-4 py-3">
                                <i class="${category.icon || 'fas fa-folder'} text-blue-600"></i>
                            </td>
                            <td class="px-4 py-3 font-medium">${category.name}</td>
                            <td class="px-4 py-3">${category.description || 'لا يوجد وصف'}</td>
                            <td class="px-4 py-3">${productCount}</td>
                            <td class="px-4 py-3">
                                <span class="px-2 py-1 rounded text-sm ${category.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                    ${category.active ? 'نشط' : 'غير نشط'}
                                </span>
                            </td>
                            <td class="px-4 py-3">
                                <button class="text-blue-600 hover:text-blue-800 ml-2 edit-category" data-id="${category.id}">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="text-red-600 hover:text-red-800 delete-category" data-id="${category.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                }).join('');

                // إضافة مستمعي الأحداث
                tbody.querySelectorAll('.edit-category').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const categoryId = e.target.closest('button').dataset.id;
                        this.editCategory(categoryId);
                    });
                });

                tbody.querySelectorAll('.delete-category').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        e.stopPropagation();
                        const categoryId = e.target.closest('button').dataset.id;
                        const category = this.categories.find(c => c.id === categoryId);
                        const categoryName = category ? category.name : 'القسم';
                        const hasProducts = this.products.some(p => p.category === categoryId);
                        
                        if (hasProducts) {
                            const productCount = this.products.filter(p => p.category === categoryId).length;
                            this.showDeleteConfirmation(
                                'لا يمكن حذف القسم',
                                `لا يمكن حذف القسم "${categoryName}" لأنه يحتوي على ${productCount} منتج.\nيجب حذف أو نقل المنتجات أولاً.`,
                                null,
                                'موافق'
                            );
                        } else {
                            this.showDeleteConfirmation(
                                'حذف القسم',
                                `هل أنت متأكد من حذف القسم "${categoryName}"؟\nهذا الإجراء لا يمكن التراجع عنه.`,
                                () => {
                                    this.deleteCategory(categoryId);
                                }
                            );
                        }
                    });
                });

                this.renderCategoryStats();
            }

            // عرض إحصائيات الأقسام
            renderCategoryStats() {
                const statsContainer = document.getElementById('categoryStats');
                
                const stats = this.categories.map(category => {
                    const productCount = this.products.filter(p => p.category === category.id).length;
                    const activeProducts = this.products.filter(p => p.category === category.id && p.active).length;
                    
                    return {
                        ...category,
                        productCount,
                        activeProducts
                    };
                });

                statsContainer.innerHTML = stats.map(stat => `
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded">
                        <div class="flex items-center">
                            <i class="${stat.icon || 'fas fa-folder'} text-blue-600 ml-3"></i>
                            <span class="font-medium">${stat.name}</span>
                        </div>
                        <div class="text-sm text-gray-600">
                            ${stat.activeProducts}/${stat.productCount} منتج نشط
                        </div>
                    </div>
                `).join('');
            }

            // عرض المنتجات المخفضة
            renderDiscountedProducts() {
                const tbody = document.getElementById('discountedProductsBody');
                const discountedProducts = this.products.filter(p => p.discount > 0);
                
                tbody.innerHTML = discountedProducts.map(product => {
                    const discountedPrice = this.calculateDiscountedPrice(product.price, product.discount);
                    const savedAmount = product.price - discountedPrice;
                    
                    return `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="px-4 py-3">${product.name}</td>
                            <td class="px-4 py-3">${product.price} ${this.settings.currency}</td>
                            <td class="px-4 py-3">
                                <span class="bg-red-100 text-red-800 px-2 py-1 rounded text-sm">${product.discount}%</span>
                            </td>
                            <td class="px-4 py-3 font-bold text-blue-600">${Math.round(discountedPrice)} ${this.settings.currency}</td>
                            <td class="px-4 py-3 text-green-600">${Math.round(savedAmount)} ${this.settings.currency}</td>
                        </tr>
                    `;
                }).join('');
            }

            // تحديث قوائم الأقسام
            updateCategorySelects() {
                const selects = [
                    'productCategory',
                    'bulkDiscountCategory',
                    'removeDiscountCategory'
                ];

                selects.forEach(selectId => {
                    const select = document.getElementById(selectId);
                    if (select) {
                        const currentValue = select.value;
                        const isProductCategory = selectId === 'productCategory';
                        
                        select.innerHTML = isProductCategory ? 
                            '<option value="">اختر القسم</option>' : 
                            '<option value="">جميع الأقسام</option>';
                        
                        this.categories.filter(c => c.active).forEach(category => {
                            const option = document.createElement('option');
                            option.value = category.id;
                            option.textContent = category.name;
                            select.appendChild(option);
                        });
                        
                        select.value = currentValue;
                    }
                });
            }

            // تحديث الإحصائيات
            updateStats() {
                const totalProducts = this.products.length;
                const activeProducts = this.products.filter(p => p.active).length;
                const discountedProducts = this.products.filter(p => p.discount > 0).length;
                const totalCategories = this.categories.length;
                const dataSize = Math.round(JSON.stringify({
                    products: this.products,
                    categories: this.categories,
                    settings: this.settings
                }).length / 1024);

                // تحديث الإحصائيات في لوحة الإدارة
                const totalProductsEl = document.getElementById('totalProducts');
                const activeProductsEl = document.getElementById('activeProducts');
                const discountedProductsEl = document.getElementById('discountedProducts');
                const totalCategoriesEl = document.getElementById('totalCategories');
                const dataSizeEl = document.getElementById('dataSize');
                const totalProductsStatsEl = document.getElementById('totalProductsStats');
                const productCountDisplayEl = document.getElementById('productCountDisplay');

                if (totalProductsEl) totalProductsEl.textContent = totalProducts;
                if (activeProductsEl) activeProductsEl.textContent = activeProducts;
                if (discountedProductsEl) discountedProductsEl.textContent = discountedProducts;
                if (totalCategoriesEl) totalCategoriesEl.textContent = totalCategories;
                if (dataSizeEl) dataSizeEl.textContent = `${dataSize} KB`;
                if (totalProductsStatsEl) totalProductsStatsEl.textContent = totalProducts;
                if (productCountDisplayEl) productCountDisplayEl.textContent = `+${activeProducts}`;
            }

            // تطبيق الإعدادات
            applySettings() {
                // تحديث الهيدر
                const headerTitle = document.querySelector('header h1');
                if (headerTitle) headerTitle.textContent = this.settings.storeName;
                
                // إضافة/تحديث الشعار في الهيدر
                const headerContainer = document.querySelector('header .container .flex');
                const existingLogo = document.getElementById('headerLogo');
                
                if (this.settings.logo) {
                    if (existingLogo) {
                        existingLogo.src = this.settings.logo;
                    } else {
                        const logoElement = document.createElement('img');
                        logoElement.id = 'headerLogo';
                        logoElement.src = this.settings.logo;
                        logoElement.alt = this.settings.storeName;
                        logoElement.className = 'h-10 w-auto ml-3 rounded-lg';
                        headerContainer.insertBefore(logoElement, headerContainer.firstChild);
                    }
                } else if (existingLogo) {
                    existingLogo.remove();
                }

                // تحديث البانر الرئيسي
                const storeTitleEl = document.getElementById('storeTitle');
                const storeSubtitleEl = document.getElementById('storeSubtitle');
                if (storeTitleEl) storeTitleEl.textContent = `أهلاً بك في ${this.settings.storeName}`;
                if (storeSubtitleEl) storeSubtitleEl.textContent = this.settings.storeDescription;

                // تحديث قسم "من نحن"
                const aboutSection = document.querySelector('#about .max-w-4xl');
                if (aboutSection && this.settings.storeDescription) {
                    const aboutText = aboutSection.querySelector('p');
                    if (aboutText) {
                        aboutText.textContent = this.settings.storeDescription;
                    }
                }

                // تحديث إحصائيات "من نحن"
                const customerCountEl = document.querySelector('#about .grid .bg-white:first-child .text-4xl');
                if (customerCountEl && this.settings.customerCount) {
                    customerCountEl.textContent = `+${this.settings.customerCount}`;
                }

                const foundedYearEl = document.querySelector('#about .grid .bg-white:last-child .text-4xl');
                if (foundedYearEl && this.settings.foundedYear) {
                    const currentYear = new Date().getFullYear();
                    const yearsInBusiness = currentYear - parseInt(this.settings.foundedYear);
                    foundedYearEl.textContent = yearsInBusiness > 0 ? yearsInBusiness : '1';
                    const yearLabel = foundedYearEl.nextElementSibling;
                    if (yearLabel) yearLabel.textContent = yearsInBusiness > 1 ? 'سنوات خبرة' : 'سنة خبرة';
                }

                // تحديث معلومات الاتصال
                const contactInfo = document.querySelector('#contact .bg-gradient-to-br ul');
                if (contactInfo) {
                    contactInfo.innerHTML = `
                        <li class="flex items-center">
                            <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center ml-4">
                                <i class="fas fa-map-marker-alt text-white"></i>
                            </div>
                            <span class="text-gray-700">${this.settings.address || 'الرياض، المملكة العربية السعودية'}</span>
                        </li>
                        <li class="flex items-center">
                            <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center ml-4">
                                <i class="fas fa-phone-alt text-white"></i>
                            </div>
                            <span class="text-gray-700">${this.settings.phone || '+966 12 345 6789'}</span>
                        </li>
                        <li class="flex items-center">
                            <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center ml-4">
                                <i class="fas fa-envelope text-white"></i>
                            </div>
                            <span class="text-gray-700">${this.settings.email || 'info@mystore.com'}</span>
                        </li>
                        <li class="flex items-center">
                            <div class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center ml-4">
                                <i class="fas fa-clock text-white"></i>
                            </div>
                            <span class="text-gray-700">${this.settings.hours || 'متاح 24/7 للطلبات الإلكترونية'}</span>
                        </li>
                    `;
                }

                // تحديث روابط التواصل الاجتماعي في قسم الاتصال
                const socialLinksContact = document.querySelector('#contact .flex.space-x-4');
                if (socialLinksContact) {
                    socialLinksContact.innerHTML = `
                        <a href="${this.settings.facebookLink || '#'}" class="w-12 h-12 bg-blue-600 rounded-full flex items-center justify-center text-white hover:bg-blue-700 transition transform hover:scale-110" ${this.settings.facebookLink ? 'target="_blank"' : ''}>
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="${this.settings.tiktokLink || '#'}" class="w-12 h-12 bg-pink-600 rounded-full flex items-center justify-center text-white hover:bg-pink-700 transition transform hover:scale-110" ${this.settings.tiktokLink ? 'target="_blank"' : ''}>
                            <i class="fab fa-tiktok"></i>
                        </a>
                        <a href="${this.settings.instagramLink || '#'}" class="w-12 h-12 bg-pink-500 rounded-full flex items-center justify-center text-white hover:bg-pink-600 transition transform hover:scale-110" ${this.settings.instagramLink ? 'target="_blank"' : ''}>
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="${this.settings.whatsappLink ? `https://wa.me/${this.settings.whatsappLink.replace(/[^0-9]/g, '')}` : '#'}" class="w-12 h-12 bg-green-600 rounded-full flex items-center justify-center text-white hover:bg-green-700 transition transform hover:scale-110" ${this.settings.whatsappLink ? 'target="_blank"' : ''}>
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    `;
                }

                // تحديث الفوتر
                const footerStoreNameEl = document.getElementById('footerStoreName');
                const footerCopyrightEl = document.getElementById('footerCopyright');
                if (footerStoreNameEl) footerStoreNameEl.textContent = this.settings.storeName;
                if (footerCopyrightEl) footerCopyrightEl.textContent = this.settings.storeName;

                // تحديث روابط التواصل الاجتماعي في الفوتر
                const socialLinksFooter = document.querySelector('footer .flex.space-x-4');
                if (socialLinksFooter) {
                    socialLinksFooter.innerHTML = `
                        <a href="${this.settings.facebookLink || '#'}" class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center hover:bg-blue-600 transition transform hover:scale-110" ${this.settings.facebookLink ? 'target="_blank"' : ''}>
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="${this.settings.tiktokLink || '#'}" class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center hover:bg-pink-600 transition transform hover:scale-110" ${this.settings.tiktokLink ? 'target="_blank"' : ''}>
                            <i class="fab fa-tiktok"></i>
                        </a>
                        <a href="${this.settings.instagramLink || '#'}" class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center hover:bg-pink-500 transition transform hover:scale-110" ${this.settings.instagramLink ? 'target="_blank"' : ''}>
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="${this.settings.whatsappLink ? `https://wa.me/${this.settings.whatsappLink.replace(/[^0-9]/g, '')}` : '#'}" class="w-10 h-10 bg-gray-700 rounded-full flex items-center justify-center hover:bg-green-600 transition transform hover:scale-110" ${this.settings.whatsappLink ? 'target="_blank"' : ''}>
                            <i class="fab fa-whatsapp"></i>
                        </a>
                    `;
                }
                
                // تحديث العملة في نموذج الطلب
                const currencyElements = document.querySelectorAll('#orderCurrency');
                currencyElements.forEach(el => el.textContent = this.settings.currency);

                // تحميل القيم في نموذج الإعدادات
                this.loadSettingsToForm();
            }

            // تحميل الإعدادات في النموذج
            loadSettingsToForm() {
                document.getElementById('storeName').value = this.settings.storeName || '';
                document.getElementById('storeDescription').value = this.settings.storeDescription || '';
                document.getElementById('storeCurrency').value = this.settings.currency || 'دج';
                document.getElementById('storePhone').value = this.settings.phone || '';
                document.getElementById('storeEmail').value = this.settings.email || '';
                document.getElementById('storeAddress').value = this.settings.address || '';
                document.getElementById('storeHours').value = this.settings.hours || '';
                document.getElementById('facebookLink').value = this.settings.facebookLink || '';
                document.getElementById('instagramLink').value = this.settings.instagramLink || '';
                document.getElementById('tiktokLink').value = this.settings.tiktokLink || '';
                document.getElementById('whatsappLink').value = this.settings.whatsappLink || '';
                document.getElementById('foundedYear').value = this.settings.foundedYear || '';
                document.getElementById('customerCount').value = this.settings.customerCount || '';

                // تحميل الشعار
                if (this.settings.logo) {
                    currentStoreLogo = this.settings.logo;
                    const logoPreview = document.getElementById('logoPreview');
                    logoPreview.classList.remove('hidden');
                    logoPreview.innerHTML = `
                        <div class="image-preview-container">
                            <img src="${this.settings.logo}" class="image-preview" alt="شعار المتجر">
                            <button type="button" class="remove-image-btn" onclick="removeStoreLogo()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                }
            }

            // تحرير منتج
            editProduct(productId) {
                const product = this.products.find(p => p.id === productId);
                if (!product) return;

                document.getElementById('editProductId').value = product.id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productDesc').value = product.description;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productDiscount').value = product.discount || '';
                document.getElementById('productCategory').value = product.category;
                
                // تحديث الكمية
                document.getElementById('enableStock').checked = product.stock !== null && product.stock !== undefined;
                document.getElementById('productStock').value = product.stock || '';
                document.getElementById('stockSection').classList.toggle('hidden', product.stock === null || product.stock === undefined);
                
                // تحديث العلامة التجارية
                document.getElementById('enableBrand').checked = product.brand && product.brand.trim() !== '';
                document.getElementById('productBrand').value = product.brand || '';
                document.getElementById('brandSection').classList.toggle('hidden', !product.brand || product.brand.trim() === '');
                
                // تحديث الموديل
                document.getElementById('enableModel').checked = product.model && product.model.trim() !== '';
                document.getElementById('productModel').value = product.model || '';
                document.getElementById('modelSection').classList.toggle('hidden', !product.model || product.model.trim() === '');
                
                document.getElementById('productActive').checked = product.active;

                // تحديث الكود بار
                document.getElementById('enableBarcode').checked = product.barcode?.enabled || false;
                document.getElementById('productBarcode').value = product.barcode?.code || '';
                document.getElementById('barcodeSection').classList.toggle('hidden', !product.barcode?.enabled);

                // تحديث خصائص المنتج
                if (product.properties) {
                    // الألوان
                    document.getElementById('enableColors').checked = product.properties.colors?.enabled || false;
                    document.getElementById('productColors').value = product.properties.colors?.values?.join(', ') || '';
                    document.getElementById('colorsSection').classList.toggle('hidden', !product.properties.colors?.enabled);

                    // المقاسات
                    document.getElementById('enableSizes').checked = product.properties.sizes?.enabled || false;
                    document.getElementById('productSizes').value = product.properties.sizes?.values?.join(', ') || '';
                    document.getElementById('sizesSection').classList.toggle('hidden', !product.properties.sizes?.enabled);

                    // التوصيل
                    document.getElementById('enableShipping').checked = product.properties.shipping?.enabled || false;
                    document.getElementById('shippingCost').value = product.properties.shipping?.cost || '';
                    document.getElementById('shippingTime').value = product.properties.shipping?.time || '';
                    document.getElementById('shippingDetails').value = product.properties.shipping?.details || '';
                    document.getElementById('freeShipping').checked = product.properties.shipping?.free || false;
                    document.getElementById('shippingSection').classList.toggle('hidden', !product.properties.shipping?.enabled);

                    // الإرجاع
                    document.getElementById('enableReturn').checked = product.properties.return?.enabled || false;
                    document.getElementById('returnDays').value = product.properties.return?.days || 14;
                    document.getElementById('freeReturn').checked = product.properties.return?.free || false;
                    document.getElementById('returnSection').classList.toggle('hidden', !product.properties.return?.enabled);

                    // الضمان
                    document.getElementById('enableWarranty').checked = product.properties.warranty?.enabled || false;
                    document.getElementById('warrantyPeriod').value = product.properties.warranty?.period || '';
                    document.getElementById('warrantyDetails').value = product.properties.warranty?.details || '';
                    document.getElementById('warrantySection').classList.toggle('hidden', !product.properties.warranty?.enabled);

                    // المواصفات
                    document.getElementById('enableSpecs').checked = product.properties.specs?.enabled || false;
                    document.getElementById('productSpecs').value = product.properties.specs?.details || '';
                    document.getElementById('specsSection').classList.toggle('hidden', !product.properties.specs?.enabled);
                }

                if (product.images && product.images.length > 0) {
                    currentProductImages = [...product.images];
                    imagesPreview.classList.remove('hidden');
                    imagesPreview.innerHTML = '';
                    
                    product.images.forEach((image, index) => {
                        const imageContainer = document.createElement('div');
                        imageContainer.className = 'image-preview-container';
                        imageContainer.innerHTML = `
                            <img src="${image}" class="image-preview" alt="صورة ${index + 1}">
                            <button type="button" class="remove-image-btn" onclick="removePreviewImage(${index})">
                                <i class="fas fa-times"></i>
                            </button>
                        `;
                        imagesPreview.appendChild(imageContainer);
                    });
                }

                document.getElementById('productFormTitle').textContent = 'تعديل المنتج';
                document.getElementById('submitBtnText').textContent = 'تحديث المنتج';
                document.getElementById('cancelEdit').classList.remove('hidden');

                document.getElementById('productForm').scrollIntoView({ behavior: 'smooth' });
            }

            // تحرير قسم
            editCategory(categoryId) {
                const category = this.categories.find(c => c.id === categoryId);
                if (!category) return;

                document.getElementById('editCategoryId').value = category.id;
                document.getElementById('categoryName').value = category.name;
                document.getElementById('categoryDesc').value = category.description || '';
                document.getElementById('categoryIcon').value = category.icon || '';
                document.getElementById('categoryActive').checked = category.active;

                // عرض الصورة الحالية إذا كانت موجودة
                const imagePreview = document.getElementById('categoryImagePreview');
                if (category.image) {
                    currentCategoryImage = category.image;
                    imagePreview.classList.remove('hidden');
                    imagePreview.innerHTML = `
                        <div class="image-preview-container">
                            <img src="${category.image}" class="image-preview" alt="صورة القسم">
                            <button type="button" class="remove-image-btn" onclick="removeCategoryImage()">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    `;
                } else {
                    currentCategoryImage = '';
                    imagePreview.classList.add('hidden');
                }

                document.getElementById('categoryFormTitle').textContent = 'تعديل القسم';
                document.getElementById('categorySubmitBtnText').textContent = 'تحديث القسم';
                document.getElementById('cancelCategoryEdit').classList.remove('hidden');

                document.getElementById('categoryForm').scrollIntoView({ behavior: 'smooth' });
            }

            // إلغاء التحرير
            cancelEdit() {
                document.getElementById('productForm').reset();
                document.getElementById('editProductId').value = '';
                document.getElementById('imagesPreview').classList.add('hidden');
                document.getElementById('productFormTitle').textContent = 'إضافة منتج جديد';
                document.getElementById('submitBtnText').textContent = 'إضافة المنتج';
                document.getElementById('cancelEdit').classList.add('hidden');
                currentProductImages = [];
            }

            cancelCategoryEdit() {
                document.getElementById('categoryForm').reset();
                document.getElementById('editCategoryId').value = '';
                document.getElementById('categoryImagePreview').classList.add('hidden');
                document.getElementById('categoryFormTitle').textContent = 'إضافة قسم جديد';
                document.getElementById('categorySubmitBtnText').textContent = 'إضافة القسم';
                document.getElementById('cancelCategoryEdit').classList.add('hidden');
                currentCategoryImage = '';
            }

            // تصدير البيانات
            exportData() {
                const data = {
                    products: this.products,
                    categories: this.categories,
                    settings: this.settings,
                    exportDate: new Date().toISOString()
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `store-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            // استيراد البيانات
            importData(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (data.products) this.products = data.products;
                        if (data.categories) this.categories = data.categories;
                        if (data.settings) this.settings = data.settings;
                        
                        this.saveData('products', this.products);
                        this.saveData('categories', this.categories);
                        this.saveData('settings', this.settings);
                        
                        this.renderProducts();
                        this.renderAdminProducts();
                        this.renderCategories();
                        this.updateCategorySelects();
                        this.applySettings();
                        
                        notificationSystem.success('تم الاستيراد!', 'تم استيراد البيانات بنجاح');
                    } catch (error) {
                        notificationSystem.error('خطأ!', 'خطأ في استيراد البيانات. تأكد من صحة الملف');
                    }
                };
                reader.readAsText(file);
            }

            // مسح جميع البيانات
            clearAllData() {
                this.showDeleteConfirmation(
                    'مسح جميع البيانات',
                    'هل أنت متأكد من مسح جميع البيانات؟\nسيتم حذف جميع المنتجات والأقسام والإعدادات.\nهذا الإجراء لا يمكن التراجع عنه.',
                    () => {
                        localStorage.removeItem('store_products');
                        localStorage.removeItem('store_categories');
                        localStorage.removeItem('store_settings');
                        localStorage.removeItem('store_wishlist');
                        
                        this.products = [];
                        this.categories = this.getDefaultCategories();
                        this.settings = this.getDefaultSettings();
                        
                        this.renderProducts();
                        this.renderAdminProducts();
                        this.renderCategories();
                        this.updateCategorySelects();
                        this.applySettings();
                        
                        notificationSystem.success('تم المسح!', 'تم مسح جميع البيانات بنجاح');
                    },
                    'مسح البيانات'
                );
            }

            // إعادة تعيين البيانات الافتراضية
            resetToDefault() {
                this.showDeleteConfirmation(
                    'إعادة تعيين البيانات',
                    'هل تريد إعادة تعيين البيانات الافتراضية؟\nسيتم حذف جميع البيانات الحالية واستبدالها بالبيانات الافتراضية.\nهذا الإجراء لا يمكن التراجع عنه.',
                    () => {
                        this.products = [];
                        this.categories = this.getDefaultCategories();
                        this.settings = this.getDefaultSettings();
                        
                        this.loadDefaultProducts();
                        
                        this.saveData('products', this.products);
                        this.saveData('categories', this.categories);
                        this.saveData('settings', this.settings);
                        
                        this.renderProducts();
                        this.renderAdminProducts();
                        this.renderCategories();
                        this.updateCategorySelects();
                        this.applySettings();
                        
                        notificationSystem.success('تم الإعادة!', 'تم إعادة تعيين البيانات الافتراضية بنجاح');
                    },
                    'إعادة التعيين'
                );
            }
        }

        // متغيرات عامة
        let storeManager;
        let currentProductPrice = 0;
        let currentCategoryImage = '';
        let currentStoreLogo = '';

        // دالة إنشاء كود بار تلقائي
        function generateBarcode() {
            const timestamp = Date.now().toString();
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            return timestamp.slice(-10) + random;
        }

        // تهيئة النظام عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            // Blogger compatibility check
            initializeBloggerCompatibility();
            storeManager = new StoreManager();
            initializeEventListeners();
        });
        
        // Blogger Compatibility Functions
        function initializeBloggerCompatibility() {
            // Fix for Blogger post container
            const postBody = document.querySelector('.post-body');
            if (postBody) {
                postBody.style.lineHeight = 'inherit';
                postBody.style.fontSize = 'inherit';
            }
            
            // Override Blogger default styles
            const bloggerStyles = document.createElement('style');
            bloggerStyles.innerHTML = `
                .post-body * {
                    line-height: inherit !important;
                    font-size: inherit !important;
                }
                .widget {
                    margin: 0 !important;
                    padding: 0 !important;
                }
                .sidebar {
                    z-index: 1 !important;
                }
            `;
            document.head.appendChild(bloggerStyles);
            
            // Fix for touch events on mobile in Blogger
            if ('ontouchstart' in window) {
                document.body.classList.add('touch-device');
            }
            
            // Ensure proper loading of external resources
            const links = document.querySelectorAll('link[rel="stylesheet"]');
            links.forEach(link => {
                if (!link.href.startsWith('https://')) {
                    console.warn('Non-HTTPS stylesheet detected:', link.href);
                }
            });
            
            // Fix Blogger widget conflicts
            const widgets = document.querySelectorAll('.widget');
            widgets.forEach(widget => {
                widget.style.zIndex = '1';
            });
            
            // Optimize for Blogger loading
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', () => {
                    setTimeout(() => {
                        // Additional Blogger-specific optimizations
                        const container = document.querySelector('.blogger-container');
                        if (container) {
                            container.style.display = 'block';
                            container.style.visibility = 'visible';
                        }
                    }, 100);
                });
            }
        }

        // تهيئة مستمعي الأحداث
        function initializeEventListeners() {
            // القائمة المنبثقة
            const menuBtn = document.getElementById('menuBtn');
            const closeMenu = document.getElementById('closeMenu');
            const menuOverlay = document.getElementById('menuOverlay');
            const overlay = document.getElementById('overlay');

            menuBtn.addEventListener('click', () => {
                menuOverlay.classList.add('active');
                overlay.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            });

            closeMenu.addEventListener('click', closeMenuFunction);
            overlay.addEventListener('click', closeMenuFunction);

            function closeMenuFunction() {
                menuOverlay.classList.remove('active');
                overlay.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }

            // روابط القائمة
            document.querySelectorAll('.menu-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const targetId = link.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        closeMenuFunction();
                        setTimeout(() => {
                            targetElement.scrollIntoView({ behavior: 'smooth' });
                        }, 300);
                    }
                });
            });

            // لوحة الإدارة
            const adminLink = document.getElementById('adminLink');
            const adminPanel = document.getElementById('adminPanel');
            const closeAdmin = document.getElementById('closeAdmin');
            const adminLoginModal = document.getElementById('adminLoginModal');
            const adminLoginForm = document.getElementById('adminLoginForm');
            const cancelAdminLogin = document.getElementById('cancelAdminLogin');

            adminLink.addEventListener('click', (e) => {
                e.preventDefault();
                showAdminLogin();
                closeMenuFunction();
            });

            function showAdminLogin() {
                adminLoginModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                // التركيز على حقل اسم المستخدم
                setTimeout(() => {
                    document.getElementById('adminUsername').focus();
                }, 100);
            }

            function hideAdminLogin() {
                adminLoginModal.classList.add('hidden');
                document.body.style.overflow = 'auto';
                // إعادة تعيين النموذج
                adminLoginForm.reset();
                document.getElementById('loginError').classList.add('hidden');
                document.getElementById('loginModalContent').classList.remove('shake');
            }

            cancelAdminLogin.addEventListener('click', hideAdminLogin);

            // إغلاق النافذة بالنقر خارجها
            adminLoginModal.addEventListener('click', (e) => {
                if (e.target === adminLoginModal) {
                    hideAdminLogin();
                }
            });

            // إغلاق النافذة بمفتاح Escape
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !adminLoginModal.classList.contains('hidden')) {
                    hideAdminLogin();
                }
            });

            adminLoginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const username = document.getElementById('adminUsername').value;
                const password = document.getElementById('adminPassword').value;
                
                // بيانات الدخول المحددة
                const correctUsername = 'admin';
                const correctPassword = 'admin123';
                
                if (username === correctUsername && password === correctPassword) {
                    // تسجيل دخول ناجح
                    hideAdminLogin();
                    
                    // عرض رسالة ترحيب
                    setTimeout(() => {
                        notificationSystem.success('مرحباً بك!', `أهلاً وسهلاً ${username} في لوحة الإدارة`);
                    }, 300);
                    
                    // فتح لوحة الإدارة
                    setTimeout(() => {
                        adminPanel.classList.add('active');
                        storeManager.renderAdminProducts();
                        storeManager.renderDiscountedProducts();
                    }, 500);
                } else {
                    // تسجيل دخول فاشل
                    document.getElementById('loginError').classList.remove('hidden');
                    document.getElementById('loginModalContent').classList.add('shake');
                    
                    // إزالة تأثير الهز بعد انتهاء الأنيميشن
                    setTimeout(() => {
                        document.getElementById('loginModalContent').classList.remove('shake');
                    }, 500);
                    
                    // مسح كلمة المرور
                    document.getElementById('adminPassword').value = '';
                    document.getElementById('adminPassword').focus();
                }
            });

            closeAdmin.addEventListener('click', () => {
                adminPanel.classList.remove('active');
            });

            // المنتجات المفضلة
            const wishlistLink = document.getElementById('wishlistLink');
            const wishlistModal = document.getElementById('wishlistModal');
            const closeWishlistModal = document.getElementById('closeWishlistModal');

            wishlistLink.addEventListener('click', (e) => {
                e.preventDefault();
                storeManager.showWishlist();
                closeMenuFunction();
            });

            closeWishlistModal.addEventListener('click', () => {
                wishlistModal.classList.remove('active');
                document.body.style.overflow = 'auto';
            });

            wishlistModal.addEventListener('click', (e) => {
                if (e.target === wishlistModal) {
                    wishlistModal.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            });

            // التبويبات في لوحة الإدارة
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    
                    document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.admin-content').forEach(c => c.classList.remove('active'));
                    
                    tab.classList.add('active');
                    document.getElementById(`${tabName}-content`).classList.add('active');
                    
                    if (tabName === 'products') {
                        storeManager.renderAdminProducts();
                    } else if (tabName === 'discounts') {
                        storeManager.renderDiscountedProducts();
                    } else if (tabName === 'database') {
                        storeManager.updateDatabaseStats();
                        storeManager.updateOperationLog();
                    }
                });
            });

            // نماذج الإدارة
            setupAdminForms();
            
            // نموذج الطلب
            setupOrderModal();
            
            // إعداد التحقق من رقم الهاتف الجزائري
            setupPhoneValidation();
        }

        // إعداد نماذج الإدارة
        function setupAdminForms() {
            // نموذج المنتج
            const productForm = document.getElementById('productForm');
            const productImages = document.getElementById('productImages');
            const imagesPreview = document.getElementById('imagesPreview');
            let currentProductImages = [];

            productImages.addEventListener('change', (e) => {
                const files = Array.from(e.target.files);
                if (files.length > 5) {
                    alert('يمكنك اختيار 5 صور كحد أقصى');
                    return;
                }
                
                currentProductImages = [];
                imagesPreview.innerHTML = '';
                
                if (files.length > 0) {
                    imagesPreview.classList.remove('hidden');
                    
                    files.forEach((file, index) => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            currentProductImages.push(e.target.result);
                            
                            const imageContainer = document.createElement('div');
                            imageContainer.className = 'image-preview-container';
                            imageContainer.innerHTML = `
                                <img src="${e.target.result}" class="image-preview" alt="صورة ${index + 1}">
                                <button type="button" class="remove-image-btn" onclick="removePreviewImage(${index})">
                                    <i class="fas fa-times"></i>
                                </button>
                            `;
                            imagesPreview.appendChild(imageContainer);
                        };
                        reader.readAsDataURL(file);
                    });
                } else {
                    imagesPreview.classList.add('hidden');
                }
            });

            // إضافة مستمعي الأحداث للكود بار
            document.getElementById('enableBarcode').addEventListener('change', (e) => {
                document.getElementById('barcodeSection').classList.toggle('hidden', !e.target.checked);
                if (e.target.checked && !document.getElementById('productBarcode').value) {
                    document.getElementById('productBarcode').value = generateBarcode();
                }
            });

            document.getElementById('generateBarcode').addEventListener('click', () => {
                document.getElementById('productBarcode').value = generateBarcode();
            });

            // إضافة مستمعي الأحداث للكمية والعلامة والموديل
            document.getElementById('enableStock').addEventListener('change', (e) => {
                document.getElementById('stockSection').classList.toggle('hidden', !e.target.checked);
            });

            document.getElementById('enableBrand').addEventListener('change', (e) => {
                document.getElementById('brandSection').classList.toggle('hidden', !e.target.checked);
            });

            document.getElementById('enableModel').addEventListener('change', (e) => {
                document.getElementById('modelSection').classList.toggle('hidden', !e.target.checked);
            });

            // إضافة مستمعي الأحداث للخصائص
            document.getElementById('enableColors').addEventListener('change', (e) => {
                document.getElementById('colorsSection').classList.toggle('hidden', !e.target.checked);
            });

            document.getElementById('enableSizes').addEventListener('change', (e) => {
                document.getElementById('sizesSection').classList.toggle('hidden', !e.target.checked);
            });

            document.getElementById('enableShipping').addEventListener('change', (e) => {
                document.getElementById('shippingSection').classList.toggle('hidden', !e.target.checked);
            });

            document.getElementById('enableReturn').addEventListener('change', (e) => {
                document.getElementById('returnSection').classList.toggle('hidden', !e.target.checked);
            });

            document.getElementById('enableWarranty').addEventListener('change', (e) => {
                document.getElementById('warrantySection').classList.toggle('hidden', !e.target.checked);
            });

            document.getElementById('enableSpecs').addEventListener('change', (e) => {
                document.getElementById('specsSection').classList.toggle('hidden', !e.target.checked);
            });

            productForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                // جمع بيانات الكود بار
                const barcode = {
                    enabled: document.getElementById('enableBarcode').checked,
                    code: document.getElementById('enableBarcode').checked ? 
                        document.getElementById('productBarcode').value : ''
                };

                // جمع بيانات الخصائص
                const properties = {
                    colors: {
                        enabled: document.getElementById('enableColors').checked,
                        values: document.getElementById('enableColors').checked ? 
                            document.getElementById('productColors').value.split(',').map(c => c.trim()).filter(c => c) : []
                    },
                    sizes: {
                        enabled: document.getElementById('enableSizes').checked,
                        values: document.getElementById('enableSizes').checked ? 
                            document.getElementById('productSizes').value.split(',').map(s => s.trim()).filter(s => s) : []
                    },
                    shipping: {
                        enabled: document.getElementById('enableShipping').checked,
                        cost: document.getElementById('enableShipping').checked ? 
                            parseFloat(document.getElementById('shippingCost').value) || 0 : 0,
                        time: document.getElementById('enableShipping').checked ? 
                            document.getElementById('shippingTime').value : '',
                        details: document.getElementById('enableShipping').checked ? 
                            document.getElementById('shippingDetails').value : '',
                        free: document.getElementById('enableShipping').checked ? 
                            document.getElementById('freeShipping').checked : false
                    },
                    return: {
                        enabled: document.getElementById('enableReturn').checked,
                        days: document.getElementById('enableReturn').checked ? 
                            parseInt(document.getElementById('returnDays').value) || 14 : 14,
                        free: document.getElementById('enableReturn').checked ? 
                            document.getElementById('freeReturn').checked : false
                    },
                    warranty: {
                        enabled: document.getElementById('enableWarranty').checked,
                        period: document.getElementById('enableWarranty').checked ? 
                            document.getElementById('warrantyPeriod').value : '',
                        details: document.getElementById('enableWarranty').checked ? 
                            document.getElementById('warrantyDetails').value : ''
                    },
                    specs: {
                        enabled: document.getElementById('enableSpecs').checked,
                        details: document.getElementById('enableSpecs').checked ? 
                            document.getElementById('productSpecs').value : ''
                    }
                };

                const formData = {
                    name: document.getElementById('productName').value,
                    description: document.getElementById('productDesc').value,
                    price: parseFloat(document.getElementById('productPrice').value),
                    discount: parseInt(document.getElementById('productDiscount').value) || 0,
                    category: document.getElementById('productCategory').value,
                    stock: document.getElementById('enableStock').checked ? 
                        parseInt(document.getElementById('productStock').value) || 0 : null,
                    brand: document.getElementById('enableBrand').checked ? 
                        document.getElementById('productBrand').value : '',
                    model: document.getElementById('enableModel').checked ? 
                        document.getElementById('productModel').value : '',
                    active: document.getElementById('productActive').checked,
                    images: currentProductImages,
                    barcode: barcode,
                    properties: properties
                };

                const editId = document.getElementById('editProductId').value;
                
                if (editId) {
                    storeManager.updateProduct(editId, formData);
                    storeManager.cancelEdit();
                } else {
                    storeManager.addProduct(formData);
                    productForm.reset();
                    imagesPreview.classList.add('hidden');
                    currentProductImages = [];
                    // إخفاء جميع أقسام الخصائص والكود بار
                    document.querySelectorAll('#barcodeSection, #colorsSection, #sizesSection, #shippingSection, #returnSection, #warrantySection, #specsSection').forEach(section => {
                        section.classList.add('hidden');
                    });
                }
            });

            document.getElementById('cancelEdit').addEventListener('click', () => {
                storeManager.cancelEdit();
            });

            // نموذج القسم
            const categoryForm = document.getElementById('categoryForm');
            const categoryImage = document.getElementById('categoryImage');
            const categoryImagePreview = document.getElementById('categoryImagePreview');

            categoryImage.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        currentCategoryImage = e.target.result;
                        categoryImagePreview.classList.remove('hidden');
                        categoryImagePreview.innerHTML = `
                            <div class="image-preview-container">
                                <img src="${e.target.result}" class="image-preview" alt="صورة القسم">
                                <button type="button" class="remove-image-btn" onclick="removeCategoryImage()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `;
                    };
                    reader.readAsDataURL(file);
                } else {
                    currentCategoryImage = '';
                    categoryImagePreview.classList.add('hidden');
                }
            });
            
            categoryForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const formData = {
                    name: document.getElementById('categoryName').value,
                    description: document.getElementById('categoryDesc').value,
                    icon: document.getElementById('categoryIcon').value,
                    image: currentCategoryImage,
                    active: document.getElementById('categoryActive').checked
                };

                const editId = document.getElementById('editCategoryId').value;
                
                if (editId) {
                    storeManager.updateCategory(editId, formData);
                    storeManager.cancelCategoryEdit();
                } else {
                    storeManager.addCategory(formData);
                    categoryForm.reset();
                    currentCategoryImage = '';
                    categoryImagePreview.classList.add('hidden');
                }
            });

            document.getElementById('cancelCategoryEdit').addEventListener('click', () => {
                storeManager.cancelCategoryEdit();
            });

            // نموذج التخفيض الجماعي
            document.getElementById('bulkDiscountForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const categoryId = document.getElementById('bulkDiscountCategory').value;
                const discountPercent = parseInt(document.getElementById('bulkDiscountPercent').value);
                
                const updatedCount = storeManager.applyBulkDiscount(categoryId, discountPercent);
                notificationSystem.success('تم التطبيق!', `تم تطبيق التخفيض على ${updatedCount} منتج`);
                
                e.target.reset();
            });

            // نموذج إزالة التخفيضات
            document.getElementById('removeDiscountForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                const categoryId = document.getElementById('removeDiscountCategory').value;
                const updatedCount = storeManager.removeBulkDiscount(categoryId);
                notificationSystem.success('تم الإزالة!', `تم إزالة التخفيض من ${updatedCount} منتج`);
                
                e.target.reset();
            });

            // نموذج إعدادات المتجر
            const storeLogo = document.getElementById('storeLogo');
            const logoPreview = document.getElementById('logoPreview');

            storeLogo.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        currentStoreLogo = e.target.result;
                        logoPreview.classList.remove('hidden');
                        logoPreview.innerHTML = `
                            <div class="image-preview-container">
                                <img src="${e.target.result}" class="image-preview" alt="شعار المتجر">
                                <button type="button" class="remove-image-btn" onclick="removeStoreLogo()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `;
                    };
                    reader.readAsDataURL(file);
                } else {
                    currentStoreLogo = '';
                    logoPreview.classList.add('hidden');
                }
            });

            document.getElementById('storeSettingsForm').addEventListener('submit', (e) => {
                e.preventDefault();
                
                storeManager.settings = {
                    storeName: document.getElementById('storeName').value,
                    storeDescription: document.getElementById('storeDescription').value,
                    currency: document.getElementById('storeCurrency').value,
                    logo: currentStoreLogo,
                    phone: document.getElementById('storePhone').value,
                    email: document.getElementById('storeEmail').value,
                    address: document.getElementById('storeAddress').value,
                    hours: document.getElementById('storeHours').value,
                    facebookLink: document.getElementById('facebookLink').value,
                    instagramLink: document.getElementById('instagramLink').value,
                    tiktokLink: document.getElementById('tiktokLink').value,
                    whatsappLink: document.getElementById('whatsappLink').value,
                    foundedYear: document.getElementById('foundedYear').value,
                    customerCount: document.getElementById('customerCount').value
                };
                
                storeManager.saveData('settings', storeManager.settings);
                storeManager.applySettings();
                storeManager.renderProducts();
                storeManager.renderAdminProducts();
                
                notificationSystem.success('تم الحفظ!', 'تم حفظ إعدادات المتجر بنجاح');
            });

            // أزرار إدارة البيانات الأساسية
            document.getElementById('exportData').addEventListener('click', () => {
                storeManager.exportData();
            });

            document.getElementById('importData').addEventListener('click', () => {
                document.getElementById('importFile').click();
            });

            document.getElementById('importFile').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    storeManager.importData(file);
                }
            });

            document.getElementById('clearAllData').addEventListener('click', () => {
                storeManager.clearAllData();
            });

            document.getElementById('resetToDefault').addEventListener('click', () => {
                storeManager.resetToDefault();
            });

            // أزرار قاعدة البيانات الجديدة
            document.getElementById('manualSave').addEventListener('click', () => {
                storeManager.manualSave();
            });

            document.getElementById('saveToInternalCode').addEventListener('click', () => {
                storeManager.saveToInternalCode();
            });

            document.getElementById('importDataFromCode').addEventListener('click', () => {
                storeManager.showDeleteConfirmation(
                    'استيراد البيانات من الكود',
                    'هل تريد استيراد جميع البيانات المحفوظة داخل الكود؟\nسيتم استبدال جميع البيانات الحالية بالبيانات المحفوظة داخل الكود.',
                    () => {
                        storeManager.restoreFromInternalCode();
                    },
                    'استيراد البيانات'
                );
            });

            document.getElementById('downloadUpdatedCode').addEventListener('click', () => {
                storeManager.downloadUpdatedCode();
            });

            document.getElementById('exportToGoogleDrive').addEventListener('click', () => {
                storeManager.exportToGoogleDrive();
            });

            document.getElementById('optimizeDatabase').addEventListener('click', () => {
                storeManager.optimizeDatabase();
            });

            document.getElementById('validateData').addEventListener('click', () => {
                storeManager.validateData();
            });

            document.getElementById('cleanupData').addEventListener('click', () => {
                storeManager.cleanupData();
            });

            document.getElementById('resetDatabase').addEventListener('click', () => {
                storeManager.resetToDefault();
            });

            document.getElementById('clearDatabase').addEventListener('click', () => {
                storeManager.clearAllData();
            });

            document.getElementById('clearLog').addEventListener('click', () => {
                storeManager.clearOperationLog();
            });

            document.getElementById('exportLog').addEventListener('click', () => {
                storeManager.exportOperationLog();
            });
        }

        // إعداد التحقق من رقم الهاتف الجزائري
        function setupPhoneValidation() {
            const phoneInput = document.getElementById('customerPhone');
            const phoneError = document.getElementById('phoneError');
            const phoneSuccess = document.getElementById('phoneSuccess');
            
            if (!phoneInput) return;
            
            // التحقق من صحة رقم الهاتف الجزائري
            function validateAlgerianPhone(phone) {
                // إزالة المسافات والرموز
                const cleanPhone = phone.replace(/[\s\-\(\)]/g, '');
                
                // التحقق من أن الرقم يحتوي على 10 أرقام ويبدأ بـ 05 أو 06 أو 07
                const algerianPhoneRegex = /^0[5-7][0-9]{8}$/;
                return algerianPhoneRegex.test(cleanPhone);
            }
            
            // عرض رسالة الخطأ أو النجاح
            function showValidationMessage(isValid) {
                if (isValid) {
                    phoneError.classList.add('hidden');
                    phoneSuccess.classList.remove('hidden');
                    phoneInput.classList.remove('border-red-500');
                    phoneInput.classList.add('border-green-500');
                } else {
                    phoneError.classList.remove('hidden');
                    phoneSuccess.classList.add('hidden');
                    phoneInput.classList.add('border-red-500');
                    phoneInput.classList.remove('border-green-500');
                }
            }
            
            // إخفاء الرسائل عند عدم وجود نص
            function hideValidationMessages() {
                phoneError.classList.add('hidden');
                phoneSuccess.classList.add('hidden');
                phoneInput.classList.remove('border-red-500', 'border-green-500');
            }
            
            // التحقق أثناء الكتابة
            phoneInput.addEventListener('input', function(e) {
                let value = e.target.value;
                
                // إزالة أي أحرف غير رقمية
                value = value.replace(/[^0-9]/g, '');
                
                // تحديد الحد الأقصى لـ 10 أرقام
                if (value.length > 10) {
                    value = value.substring(0, 10);
                }
                
                e.target.value = value;
                
                if (value.length === 0) {
                    hideValidationMessages();
                } else if (value.length === 10) {
                    const isValid = validateAlgerianPhone(value);
                    showValidationMessage(isValid);
                } else {
                    // إظهار رسالة خطأ للأرقام غير المكتملة
                    phoneError.classList.remove('hidden');
                    phoneSuccess.classList.add('hidden');
                    phoneInput.classList.add('border-red-500');
                    phoneInput.classList.remove('border-green-500');
                }
            });
            
            // التحقق عند فقدان التركيز
            phoneInput.addEventListener('blur', function(e) {
                const value = e.target.value;
                if (value.length > 0) {
                    const isValid = validateAlgerianPhone(value);
                    showValidationMessage(isValid);
                }
            });
            
            // منع إدخال أحرف غير رقمية
            phoneInput.addEventListener('keypress', function(e) {
                // السماح بالأرقام فقط ومفاتيح التحكم
                if (!/[0-9]/.test(e.key) && !['Backspace', 'Delete', 'Tab', 'Escape', 'Enter', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                    e.preventDefault();
                }
            });
            
            // منع اللصق للنصوص غير الرقمية
            phoneInput.addEventListener('paste', function(e) {
                e.preventDefault();
                const paste = (e.clipboardData || window.clipboardData).getData('text');
                const numericPaste = paste.replace(/[^0-9]/g, '').substring(0, 10);
                e.target.value = numericPaste;
                
                // تشغيل حدث input للتحقق
                const inputEvent = new Event('input', { bubbles: true });
                e.target.dispatchEvent(inputEvent);
            });
        }

        // إعداد نموذج الطلب
        function setupOrderModal() {
            const orderModal = document.getElementById('orderModal');
            const closeOrderModal = document.getElementById('closeOrderModal');
            const orderForm = document.getElementById('orderForm');
            const quantityInput = document.getElementById('quantity');
            const decreaseBtn = document.querySelector('.decrease-btn');
            const increaseBtn = document.querySelector('.increase-btn');
            const customerState = document.getElementById('customerState');

            closeOrderModal.addEventListener('click', () => {
                orderModal.classList.remove('active');
                document.body.style.overflow = 'auto';
            });

            orderModal.addEventListener('click', (e) => {
                if (e.target === orderModal) {
                    orderModal.classList.remove('active');
                    document.body.style.overflow = 'auto';
                }
            });

            decreaseBtn.addEventListener('click', () => {
                const currentValue = parseInt(quantityInput.value);
                if (currentValue > 1) {
                    quantityInput.value = currentValue - 1;
                    updateOrderSummary();
                }
            });

            increaseBtn.addEventListener('click', () => {
                const currentValue = parseInt(quantityInput.value);
                if (currentValue < 99) {
                    quantityInput.value = currentValue + 1;
                    updateOrderSummary();
                }
            });

            quantityInput.addEventListener('input', updateOrderSummary);
            customerState.addEventListener('change', updateOrderSummary);

            // إضافة مستمعي الأحداث لنوع التوصيل
            document.querySelectorAll('input[name="deliveryType"]').forEach(radio => {
                radio.addEventListener('change', updateOrderSummary);
            });

            orderForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // التحقق من صحة رقم الهاتف قبل الإرسال
                const phoneInput = document.getElementById('customerPhone');
                const phoneValue = phoneInput.value.replace(/[\s\-\(\)]/g, '');
                const algerianPhoneRegex = /^0[5-7][0-9]{8}$/;
                
                if (!algerianPhoneRegex.test(phoneValue)) {
                    // إظهار رسالة خطأ وإيقاف الإرسال
                    const phoneError = document.getElementById('phoneError');
                    phoneError.classList.remove('hidden');
                    phoneInput.classList.add('border-red-500');
                    phoneInput.focus();
                    
                    notificationSystem.error('خطأ في البيانات!', 'يرجى إدخال رقم هاتف جزائري صحيح');
                    return;
                }
                
                // جمع بيانات الطلب
                const deliveryType = document.querySelector('input[name="deliveryType"]:checked')?.value || 'office';
                const calculations = window.orderCalculations;
                const product = window.currentProduct;
                const category = storeManager.categories.find(c => c.id === product.category);
                
                const orderData = {
                    product: {
                        name: product.name,
                        description: product.description,
                        category: category ? category.name : 'غير محدد',
                        brand: product.brand || 'غير محدد',
                        model: product.model || 'غير محدد'
                    },
                    customer: {
                        name: document.getElementById('customerName').value,
                        phone: phoneValue, // رقم الهاتف الجزائري كما هو
                        state: document.getElementById('customerState').value,
                        address: document.getElementById('customerAddress').value
                    },
                    pricing: {
                        originalPrice: calculations.originalPrice,
                        discountPercent: calculations.discountPercent,
                        unitPriceAfterDiscount: calculations.unitPriceAfterDiscount,
                        quantity: calculations.quantity,
                        productSubtotal: calculations.productSubtotal,
                        totalSavings: calculations.totalSavings,
                        shippingCost: calculations.shippingCost,
                        grandTotal: calculations.grandTotal
                    },
                    shipping: {
                        type: deliveryType,
                        company: 'ياليدين',
                        destination: document.getElementById('customerState').value.split('-')[1]
                    },
                    barcode: product?.barcode?.enabled ? product.barcode.code : null,
                    orderDate: new Date().toISOString(),
                    orderTime: new Date().toLocaleString('ar-SA')
                };
                
                // إرسال البريد الإلكتروني
                try {
                    await sendOrderEmail(orderData);
                    
                    // إنشاء رسالة تأكيد مفصلة
                    const deliveryTypeText = deliveryType === 'office' ? 'مكتب شركة التوصيل' : 'باب المنزل';
                    const savingsText = calculations.totalSavings > 0 ? `💰 التوفير: ${calculations.totalSavings} دج\n` : '';
                    
                    const confirmationMessage = `
تم تأكيد طلبك وإرساله بنجاح! 🎉

📦 المنتج: ${orderData.product.name}
${orderData.barcode ? `🏷️ الكود بار: ${orderData.barcode}\n` : ''}👤 العميل: ${orderData.customer.name}
📱 الهاتف: ${orderData.customer.phone}
📍 الولاية: ${orderData.shipping.destination}
📦 الكمية: ${calculations.quantity}
💰 سعر الوحدة: ${calculations.unitPriceAfterDiscount} دج
💰 إجمالي المنتج: ${calculations.productSubtotal} دج
${savingsText}🚚 التوصيل (${deliveryTypeText}): ${calculations.shippingCost} دج
💰 المجموع الكلي: ${calculations.grandTotal} دج

📋 شركة التوصيل: ياليدين 🚚
📧 تم إرسال تفاصيل الطلب بالبريد الإلكتروني
سنتواصل معك قريباً لتأكيد التوصيل.
                    `.trim();
                    
                    // عرض رسالة التأكيد
                    storeManager.showDeleteConfirmation(
                        'تم تأكيد الطلب!',
                        confirmationMessage,
                        null,
                        'موافق'
                    );
                    
                } catch (error) {
                    console.error('خطأ في إرسال البريد:', error);
                    
                    // رسالة في حالة فشل الإرسال
                    const deliveryTypeText = deliveryType === 'office' ? 'مكتب شركة التوصيل' : 'باب المنزل';
                    const confirmationMessage = `
تم تأكيد طلبك! 🎉

📦 المنتج: ${orderData.product.name}
👤 العميل: ${orderData.customer.name}
📱 الهاتف: ${orderData.customer.phone}
📍 الولاية: ${orderData.shipping.destination}
📦 الكمية: ${calculations.quantity}
💰 المجموع الكلي: ${calculations.grandTotal} دج

⚠️ ملاحظة: لم يتم إرسال البريد الإلكتروني تلقائياً
سنتواصل معك قريباً لتأكيد التوصيل.
                    `.trim();
                    
                    storeManager.showDeleteConfirmation(
                        'تم تأكيد الطلب!',
                        confirmationMessage,
                        null,
                        'موافق'
                    );
                }
                
                orderModal.classList.remove('active');
                document.body.style.overflow = 'auto';
                orderForm.reset();
                quantityInput.value = 1;
                updateOrderSummary();
            });
            
            // وظيفة إرسال البريد الإلكتروني
            async function sendOrderEmail(orderData) {
                const emailContent = createEmailContent(orderData);
                
                // استخدام EmailJS أو خدمة مماثلة
                // هذا مثال باستخدام EmailJS (يتطلب إعداد حساب)
                const emailParams = {
                    to_email: 'ivetchos@gmail.com',
                    subject: `طلب جديد - ${orderData.product.name}`,
                    message: emailContent,
                    from_name: orderData.customer.name,
                    reply_to: orderData.customer.phone
                };
                
                // محاولة إرسال البريد باستخدام EmailJS
                try {
                    // يجب تحميل مكتبة EmailJS وإعدادها
                    if (typeof emailjs !== 'undefined') {
                        await emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', emailParams);
                    } else {
                        // بديل: إنشاء رابط mailto
                        const mailtoLink = `mailto:ivetchos@gmail.com?subject=${encodeURIComponent(emailParams.subject)}&body=${encodeURIComponent(emailContent)}`;
                        
                        // فتح تطبيق البريد الافتراضي
                        const link = document.createElement('a');
                        link.href = mailtoLink;
                        link.target = '_blank';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                } catch (error) {
                    // في حالة فشل EmailJS، استخدم mailto كبديل
                    const mailtoLink = `mailto:ivetchos@gmail.com?subject=${encodeURIComponent(emailParams.subject)}&body=${encodeURIComponent(emailContent)}`;
                    window.open(mailtoLink, '_blank');
                }
            }
            
            // إنشاء محتوى البريد الإلكتروني
            function createEmailContent(orderData) {
                const { product, customer, pricing, shipping, barcode, orderTime } = orderData;
                
                let content = `
🛒 طلب جديد من المتجر الإلكتروني
═══════════════════════════════════

📅 تاريخ الطلب: ${orderTime}

👤 معلومات العميل:
────────────────────
• الاسم: ${customer.name}
• الهاتف: ${customer.phone}
• الولاية: ${customer.state}
• العنوان: ${customer.address}

📦 تفاصيل المنتج:
─────────────────────
• اسم المنتج: ${product.name}
• الوصف: ${product.description}
• القسم: ${product.category}
• العلامة التجارية: ${product.brand}
• الموديل: ${product.model}
${barcode ? `• الكود بار: ${barcode}` : ''}

💰 تفاصيل الأسعار:
──────────────────────
• السعر الأصلي للوحدة: ${pricing.originalPrice} دج
${pricing.discountPercent > 0 ? `• نسبة التخفيض: ${pricing.discountPercent}%` : ''}
• سعر الوحدة بعد التخفيض: ${pricing.unitPriceAfterDiscount} دج
• الكمية المطلوبة: ${pricing.quantity}
• إجمالي المنتج: ${pricing.productSubtotal} دج
${pricing.totalSavings > 0 ? `• إجمالي التوفير: ${pricing.totalSavings} دج 💰` : ''}

🚚 معلومات التوصيل:
────────────────────────
• شركة التوصيل: ${shipping.company}
• نوع التوصيل: ${shipping.type === 'office' ? 'مكتب شركة التوصيل' : 'باب المنزل'}
• الوجهة: ${shipping.destination} - الجزائر
• تكلفة التوصيل: ${pricing.shippingCost} دج

💵 الملخص المالي:
─────────────────────
• إجمالي المنتج: ${pricing.productSubtotal} دج
• تكلفة التوصيل: ${pricing.shippingCost} دج
${pricing.totalSavings > 0 ? `• إجمالي التوفير: ${pricing.totalSavings} دج` : ''}
• المجموع الكلي: ${pricing.grandTotal} دج

═══════════════════════════════════
يرجى التواصل مع العميل لتأكيد الطلب وترتيب التوصيل.
                `.trim();
                
                return content;
            }
        }

        // تحديث ملخص الطلب
        function updateOrderSummary() {
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            const product = window.currentProduct;
            
            if (!product) return;
            
            // حساب الأسعار
            const originalPrice = product.price; // السعر الأصلي
            const discountPercent = product.discount || 0; // نسبة التخفيض
            const unitPriceAfterDiscount = originalPrice - (originalPrice * discountPercent / 100); // سعر الوحدة بعد التخفيض
            const totalSavings = discountPercent > 0 ? (originalPrice - unitPriceAfterDiscount) * quantity : 0; // إجمالي التوفير
            const productSubtotal = unitPriceAfterDiscount * quantity; // إجمالي المنتج بعد التخفيض
            
            const selectedState = document.getElementById('customerState').value;
            const deliveryType = document.querySelector('input[name="deliveryType"]:checked')?.value || 'office';
            
            // حساب تكلفة التوصيل حسب الولاية ونوع التوصيل مع ياليدين
            let shippingCost = 0;
            let shippingDestination = 'اختر الولاية أولاً';
            let deliveryTypeLabel = '';
            
            if (selectedState) {
                const stateName = selectedState.split('-')[1];
                shippingDestination = `${stateName} - الجزائر`;
                
                // إظهار قسم نوع التوصيل
                document.getElementById('deliveryTypeSection').style.display = 'block';
                
                // أسعار التوصيل مع شركة ياليدين (ثابتة بغض النظر عن الكمية)
                const yalidineRates = {
                    // العاصمة
                    'الجزائر': { office: 350, home: 500 },
                    
                    // البليدة / بومرداس / تيبازة
                    'البليدة': { office: 450, home: 700 },
                    'بومرداس': { office: 450, home: 700 },
                    'تيبازة': { office: 450, home: 700 },
                    
                    // المجموعة الثانية
                    'وهران': { office: 550, home: 1000 },
                    'تلمسان': { office: 550, home: 1000 },
                    'عين تموشنت': { office: 550, home: 1000 },
                    'عين الدفلى': { office: 550, home: 1000 },
                    'تيارت': { office: 550, home: 1000 },
                    'معسكر': { office: 550, home: 1000 },
                    'سيدي بلعباس': { office: 550, home: 1000 },
                    'مستغانم': { office: 550, home: 1000 },
                    'غليزان': { office: 550, home: 1000 },
                    'سعيدة': { office: 550, home: 1000 },
                    'الشلف': { office: 550, home: 1000 },
                    'عنابة': { office: 550, home: 1000 },
                    'أم البواقي': { office: 550, home: 1000 },
                    'قالمة': { office: 550, home: 1000 },
                    'المدية': { office: 550, home: 1000 },
                    'ميلة': { office: 550, home: 1000 },
                    'تيسمسيلت': { office: 550, home: 1000 },
                    'سوق أهراس': { office: 550, home: 1000 },
                    'سكيكدة': { office: 550, home: 1000 },
                    'تيزي وزو': { office: 550, home: 1000 },
                    'سطيف': { office: 550, home: 1000 },
                    'جيجل': { office: 550, home: 1000 },
                    'خنشلة': { office: 550, home: 1000 },
                    'باتنة': { office: 550, home: 1000 },
                    'برج بوعريريج': { office: 550, home: 1000 },
                    'الطارف': { office: 550, home: 1000 },
                    'قسنطينة': { office: 550, home: 1000 },
                    'المسيلة': { office: 550, home: 1000 },
                    'بجاية': { office: 550, home: 1000 },
                    'البويرة': { office: 550, home: 1000 },
                    
                    // المجموعة الثالثة
                    'بسكرة': { office: 750, home: 1150 },
                    'الجلفة': { office: 750, home: 1150 },
                    'تبسة': { office: 750, home: 1150 },
                    'غرداية': { office: 750, home: 1150 },
                    'ورقلة': { office: 750, home: 1150 },
                    'الأغواط': { office: 750, home: 1150 },
                    'النعامة': { office: 750, home: 1150 },
                    'الوادي': { office: 750, home: 1150 },
                    
                    // المجموعة الرابعة
                    'أدرار': { office: 1000, home: 1450 },
                    'بشار': { office: 1000, home: 1450 },
                    'البيض': { office: 1000, home: 1450 },
                    
                    // المجموعة الخامسة
                    'تمنراست': { office: 1000, home: 1250 },
                    'تندوف': { office: 1000, home: 1250 },
                    
                    // إليزي
                    'إليزي': { office: 1000, home: 1400 }
                };
                
                const rates = yalidineRates[stateName];
                if (rates) {
                    shippingCost = rates[deliveryType];
                    deliveryTypeLabel = deliveryType === 'office' ? '(مكتب)' : '(منزل)';
                    
                    // تحديث أسعار نوع التوصيل
                    document.getElementById('officePrice').textContent = `${rates.office} دج`;
                    document.getElementById('homePrice').textContent = `${rates.home} دج`;
                } else {
                    // ولايات أخرى (افتراضي)
                    shippingCost = deliveryType === 'office' ? 550 : 1000;
                    deliveryTypeLabel = deliveryType === 'office' ? '(مكتب)' : '(منزل)';
                    document.getElementById('officePrice').textContent = '550 دج';
                    document.getElementById('homePrice').textContent = '1000 دج';
                }
                
                // إذا كان المنتج يوفر توصيل مجاني
                if (product.properties?.shipping?.free) {
                    shippingCost = 0;
                    deliveryTypeLabel = '(مجاني)';
                }
                
                // إظهار السعر في خانة التوصيل
                const shippingCostElement = document.getElementById('shippingCost');
                if (shippingCostElement) {
                    shippingCostElement.style.display = 'inline';
                    shippingCostElement.textContent = `${shippingCost} دج`;
                }
            } else {
                // إخفاء قسم نوع التوصيل وإخفاء السعر
                document.getElementById('deliveryTypeSection').style.display = 'none';
                const shippingCostElement = document.getElementById('shippingCost');
                if (shippingCostElement) {
                    shippingCostElement.style.display = 'none';
                }
            }
            
            // المجموع النهائي = إجمالي المنتج + تكلفة التوصيل
            const grandTotal = productSubtotal + shippingCost;
            
            // تحديث العناصر في الملخص
            document.getElementById('summaryQuantity').textContent = quantity;
            document.getElementById('summaryProductTotal').textContent = `${Math.round(productSubtotal)} دج`;
            document.getElementById('summaryShipping').textContent = `${shippingCost} دج`;
            document.getElementById('summaryTotal').textContent = `${Math.round(grandTotal)} دج`;
            
            // تحديث وجهة التوصيل والسعر
            const shippingDestinationElement = document.getElementById('shippingDestination');
            const deliveryTypeLabelElement = document.getElementById('deliveryTypeLabel');
            
            if (shippingDestinationElement) {
                shippingDestinationElement.textContent = shippingDestination;
            }
            
            if (deliveryTypeLabelElement) {
                deliveryTypeLabelElement.textContent = deliveryTypeLabel;
            }
            
            // إظهار/إخفاء تفاصيل التخفيض
            if (discountPercent > 0) {
                const originalTotal = originalPrice * quantity;
                
                document.getElementById('originalPriceRow').style.display = 'flex';
                document.getElementById('discountRow').style.display = 'flex';
                document.getElementById('totalSavingsRow').style.display = 'flex';
                
                document.getElementById('summaryQuantityOriginal').textContent = quantity;
                document.getElementById('summaryOriginalTotal').textContent = `${Math.round(originalTotal)} دج`;
                document.getElementById('summaryDiscountPercent').textContent = discountPercent;
                document.getElementById('summaryDiscountAmount').textContent = `-${Math.round(totalSavings)} دج`;
                document.getElementById('summaryTotalSavings').textContent = `${Math.round(totalSavings)} دج`;
            } else {
                document.getElementById('originalPriceRow').style.display = 'none';
                document.getElementById('discountRow').style.display = 'none';
                document.getElementById('totalSavingsRow').style.display = 'none';
            }
            
            // حفظ البيانات للاستخدام عند الإرسال
            window.orderCalculations = {
                originalPrice: originalPrice,
                discountPercent: discountPercent,
                unitPriceAfterDiscount: Math.round(unitPriceAfterDiscount),
                quantity: quantity,
                productSubtotal: Math.round(productSubtotal),
                totalSavings: Math.round(totalSavings),
                shippingCost: shippingCost,
                grandTotal: Math.round(grandTotal)
            };
        }

        // للتوافق مع الكود القديم
        function updateTotalPrice() {
            updateOrderSummary();
        }

        // تصفية المنتجات حسب القسم
        function filterByCategory(categoryId) {
            const productsSection = document.getElementById('products');
            const container = document.getElementById('productsContainer');
            
            // التمرير إلى قسم المنتجات
            productsSection.scrollIntoView({ behavior: 'smooth' });
            
            // تصفية المنتجات
            const filteredProducts = storeManager.products.filter(p => 
                p.active && p.category === categoryId
            );
            
            // عرض المنتجات المفلترة
            container.innerHTML = filteredProducts.map(product => {
                const category = storeManager.categories.find(c => c.id === product.category);
                const discountedPrice = storeManager.calculateDiscountedPrice(product.price, product.discount);
                const hasDiscount = product.discount > 0;
                const savedAmount = hasDiscount ? product.price - discountedPrice : 0;
                const stockInfo = storeManager.getStockStatus(product.stock);
                
                return `
                    <div class="product-card" data-product-id="${product.id}">
                        <!-- صورة المنتج -->
                        <div class="product-image-container" style="position: relative;">
                            ${hasDiscount ? `<div class="discount-badge">-${product.discount}%</div>` : ''}
                            ${product.stock > 0 && product.stock <= 5 ? '<div class="product-badge badge-hot">كمية محدودة</div>' : ''}
                            ${product.stock === 0 ? '<div class="product-badge" style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white;">نفد المخزون</div>' : ''}
                            
                            ${product.images && product.images.length > 0 ? 
                                `<div class="product-image-gallery">
                                    <img src="${product.images[0]}" alt="${product.name}" class="product-image main-image">
                                    ${product.images.length > 1 ? `
                                        <div class="image-indicators">
                                            ${product.images.map((_, index) => `<div class="indicator ${index === 0 ? 'active' : ''}" data-index="${index}"></div>`).join('')}
                                        </div>
                                        <button class="image-nav prev-btn" onclick="changeProductImage('${product.id}', -1)">
                                            <i class="fas fa-chevron-left"></i>
                                        </button>
                                        <button class="image-nav next-btn" onclick="changeProductImage('${product.id}', 1)">
                                            <i class="fas fa-chevron-right"></i>
                                        </button>
                                    ` : ''}
                                </div>` :
                                `<div class="w-full h-full flex items-center justify-center text-white">
                                    <div class="text-center">
                                        <i class="fas fa-image text-4xl mb-2 opacity-50"></i>
                                        <div class="text-sm opacity-75">${product.name}</div>
                                    </div>
                                </div>`
                            }
                            
                            <!-- زر معاينة المنتج -->
                            <button class="product-preview-btn" onclick="showProductPreview('${product.id}')">
                                <i class="fas fa-eye"></i>
                                <span>معاينة</span>
                            </button>
                        </div>
                        
                        <!-- محتوى المنتج -->
                        <div class="product-content">
                            <!-- العنوان والتقييم -->
                            <h3 class="product-title">${product.name}</h3>
                            
                            <!-- معلومات إضافية -->
                            <div class="product-meta">
                                <div class="rating-stars">
                                    <i class="fas fa-star star"></i>
                                    <i class="fas fa-star star"></i>
                                    <i class="fas fa-star star"></i>
                                    <i class="fas fa-star star"></i>
                                    <i class="far fa-star star"></i>
                                    <span class="mr-1">(4.0)</span>
                                </div>
                                ${category ? `<span><i class="fas fa-tag ml-1"></i>${category.name}</span>` : ''}
                            </div>
                            
                            <!-- الوصف -->
                            <p class="product-description">${product.description}</p>
                            
                            <!-- معلومات المخزون -->
                            <div class="stock-info ${stockInfo.class}">
                                <i class="fas fa-box ml-2"></i>
                                <span class="font-medium">${stockInfo.status}</span>
                            </div>
                            
                            <!-- قسم السعر -->
                            <div class="price-section">
                                <div class="current-price">${Math.round(discountedPrice)} ${storeManager.settings.currency}</div>
                                ${hasDiscount ? `
                                    <div class="price-row">
                                        <span class="original-price">${product.price} ${storeManager.settings.currency}</span>
                                        <span class="savings">وفر ${Math.round(savedAmount)} ${storeManager.settings.currency}</span>
                                    </div>
                                ` : ''}
                            </div>
                            
                            <!-- أزرار الإجراءات -->
                            <div class="product-actions">
                                <button class="btn-primary order-now ${product.stock === 0 ? 'opacity-50 cursor-not-allowed' : ''}" 
                                        data-product='${JSON.stringify(product)}' ${product.stock === 0 ? 'disabled' : ''}>
                                    <i class="fas fa-shopping-cart"></i>
                                    ${product.stock === 0 ? 'غير متوفر' : 'اطلب الآن'}
                                </button>
                                <button class="btn-secondary add-to-wishlist" data-product-id="${product.id}" title="إضافة للمفضلة">
                                    <i class="far fa-heart"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // إضافة مستمعي الأحداث للمنتجات المفلترة
            container.querySelectorAll('.order-now').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    if (!e.target.disabled) {
                        const product = JSON.parse(e.target.dataset.product);
                        storeManager.showOrderModal(product);
                    }
                });
            });

            container.querySelectorAll('.add-to-wishlist').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const productId = e.target.closest('button').dataset.productId;
                    storeManager.toggleWishlist(productId, e.target.closest('button'));
                });
            });
            
            // إضافة زر لإظهار جميع المنتجات
            const categoryName = storeManager.categories.find(c => c.id === categoryId)?.name || 'القسم';
            const showAllBtn = document.createElement('div');
            showAllBtn.className = 'text-center mt-8';
            showAllBtn.innerHTML = `
                <div class="mb-4">
                    <span class="bg-blue-100 text-blue-800 px-4 py-2 rounded-full text-sm font-medium">
                        عرض منتجات: ${categoryName} (${filteredProducts.length} منتج)
                    </span>
                </div>
                <button onclick="showAllProducts()" class="bg-gray-600 text-white px-6 py-3 rounded-full font-bold hover:bg-gray-700 transition">
                    <i class="fas fa-grid-3x3 ml-2"></i>عرض جميع المنتجات
                </button>
            `;
            container.appendChild(showAllBtn);
        }

        // عرض جميع المنتجات
        function showAllProducts() {
            storeManager.renderProducts();
        }

        // إزالة صورة من المعاينة
        function removePreviewImage(index) {
            currentProductImages.splice(index, 1);
            const imagesPreview = document.getElementById('imagesPreview');
            imagesPreview.innerHTML = '';
            
            if (currentProductImages.length === 0) {
                imagesPreview.classList.add('hidden');
            } else {
                currentProductImages.forEach((image, newIndex) => {
                    const imageContainer = document.createElement('div');
                    imageContainer.className = 'image-preview-container';
                    imageContainer.innerHTML = `
                        <img src="${image}" class="image-preview" alt="صورة ${newIndex + 1}">
                        <button type="button" class="remove-image-btn" onclick="removePreviewImage(${newIndex})">
                            <i class="fas fa-times"></i>
                        </button>
                    `;
                    imagesPreview.appendChild(imageContainer);
                });
            }
        }

        // إزالة صورة القسم
        function removeCategoryImage() {
            currentCategoryImage = '';
            const categoryImagePreview = document.getElementById('categoryImagePreview');
            categoryImagePreview.classList.add('hidden');
            categoryImagePreview.innerHTML = '';
            document.getElementById('categoryImage').value = '';
        }

        // إزالة شعار المتجر
        function removeStoreLogo() {
            currentStoreLogo = '';
            const logoPreview = document.getElementById('logoPreview');
            logoPreview.classList.add('hidden');
            logoPreview.innerHTML = '';
            document.getElementById('storeLogo').value = '';
        }

        // تغيير صورة المنتج في البطاقة
        function changeProductImage(productId, direction) {
            const product = storeManager.products.find(p => p.id === productId);
            if (!product || !product.images || product.images.length <= 1) return;
            
            const imageElement = document.querySelector(`[data-product-id="${productId}"] .main-image`);
            const indicators = document.querySelectorAll(`[data-product-id="${productId}"] .indicator`);
            
            if (!imageElement) return;
            
            let currentIndex = 0;
            indicators.forEach((indicator, index) => {
                if (indicator.classList.contains('active')) {
                    currentIndex = index;
                }
            });
            
            let newIndex = currentIndex + direction;
            if (newIndex >= product.images.length) newIndex = 0;
            if (newIndex < 0) newIndex = product.images.length - 1;
            
            imageElement.src = product.images[newIndex];
            
            indicators.forEach((indicator, index) => {
                indicator.classList.toggle('active', index === newIndex);
            });
        }

        // عرض معاينة المنتج
        let currentPreviewProduct = null;
        let currentPreviewImageIndex = 0;

        function showProductPreview(productId) {
            const product = storeManager.products.find(p => p.id === productId);
            if (!product) return;
            
            currentPreviewProduct = product;
            currentPreviewImageIndex = 0;
            
            const modal = document.getElementById('productPreviewModal');
            const category = storeManager.categories.find(c => c.id === product.category);
            const discountedPrice = storeManager.calculateDiscountedPrice(product.price, product.discount);
            const stockInfo = storeManager.getStockStatus(product.stock);
            
            // تحديث المعلومات الأساسية
            document.getElementById('previewProductName').textContent = product.name;
            document.getElementById('previewProductDescription').textContent = product.description;
            document.getElementById('previewProductBrand').textContent = product.brand || 'غير محدد';
            document.getElementById('previewProductModel').textContent = product.model || 'غير محدد';
            document.getElementById('previewProductCategory').textContent = category ? category.name : 'غير محدد';
            
            // تحديث معلومات المخزون
            const stockInfoEl = document.getElementById('previewStockInfo');
            stockInfoEl.innerHTML = `
                <div class="flex items-center ${stockInfo.class}">
                    <i class="fas fa-box ml-2"></i>
                    <span class="font-medium">${stockInfo.status}</span>
                </div>
            `;
            
            // تحديث شارة التخفيض
            const discountBadge = document.getElementById('previewDiscountBadge');
            if (product.discount > 0) {
                discountBadge.style.display = 'block';
                discountBadge.textContent = `-${product.discount}%`;
            } else {
                discountBadge.style.display = 'none';
            }

            // تحديث معلومات السعر
            document.getElementById('previewCurrentPrice').textContent = `${Math.round(discountedPrice)} ${storeManager.settings.currency}`;
            
            const priceRow = document.getElementById('previewPriceRow');
            if (product.discount > 0) {
                priceRow.style.display = 'flex';
                document.getElementById('previewOriginalPrice').textContent = `${product.price} ${storeManager.settings.currency}`;
                document.getElementById('previewSavings').textContent = `وفر ${Math.round(product.price - discountedPrice)} ${storeManager.settings.currency}`;
            } else {
                priceRow.style.display = 'none';
            }
            
            // تحديث زر الطلب الصغير
            const orderBtnSmall = document.getElementById('previewOrderBtnSmall');
            if (product.stock === 0) {
                orderBtnSmall.disabled = true;
                orderBtnSmall.innerHTML = '<i class="fas fa-times"></i><span>غير متوفر</span>';
                orderBtnSmall.classList.add('opacity-50', 'cursor-not-allowed');
                orderBtnSmall.style.animation = 'none';
                orderBtnSmall.onclick = null;
            } else {
                orderBtnSmall.disabled = false;
                orderBtnSmall.innerHTML = '<i class="fas fa-shopping-cart"></i><span>اطلب الآن</span>';
                orderBtnSmall.classList.remove('opacity-50', 'cursor-not-allowed');
                orderBtnSmall.style.animation = 'pulse-order 2s infinite';
                orderBtnSmall.onclick = orderFromPreview;
            }
            
            // تحديث الصور
            updatePreviewImages();
            
            // تحديث خصائص المنتج
            updatePreviewProperties(product);
            
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function updatePreviewImages() {
            const mainImage = document.getElementById('previewMainImage');
            const thumbnailsContainer = document.getElementById('previewThumbnails');
            
            if (currentPreviewProduct.images && currentPreviewProduct.images.length > 0) {
                mainImage.src = currentPreviewProduct.images[currentPreviewImageIndex];
                
                if (currentPreviewProduct.images.length > 1) {
                    thumbnailsContainer.innerHTML = currentPreviewProduct.images.map((image, index) => `
                        <img src="${image}" 
                             class="preview-thumbnail ${index === currentPreviewImageIndex ? 'active' : ''}" 
                             onclick="changePreviewImage(${index})"
                             alt="صورة ${index + 1}">
                    `).join('');
                } else {
                    thumbnailsContainer.innerHTML = '';
                }
            } else {
                mainImage.src = '';
                thumbnailsContainer.innerHTML = '';
            }
        }

        function changePreviewImage(index) {
            currentPreviewImageIndex = index;
            updatePreviewImages();
        }

        function closeProductPreview() {
            const modal = document.getElementById('productPreviewModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
            currentPreviewProduct = null;
        }

        function orderFromPreview() {
            if (currentPreviewProduct && currentPreviewProduct.stock > 0) {
                closeProductPreview();
                setTimeout(() => {
                    storeManager.showOrderModal(currentPreviewProduct);
                }, 300);
            }
        }

        // ربط زر اطلب الآن في المعاينة مع نموذج الطلب
        window.orderFromPreview = orderFromPreview;

        function addToWishlistFromPreview() {
            if (currentPreviewProduct) {
                const wishlistBtn = document.querySelector(`[data-product-id="${currentPreviewProduct.id}"] .add-to-wishlist`);
                if (wishlistBtn) {
                    storeManager.toggleWishlist(currentPreviewProduct.id, wishlistBtn);
                }
            }
        }

        // تحديث خصائص المنتج في المعاينة
        function updatePreviewProperties(product) {
            const propertiesContainer = document.getElementById('previewProductProperties');
            let propertiesHTML = '';

            if (product.properties) {
                // الألوان المتاحة
                if (product.properties.colors?.enabled && product.properties.colors.values?.length > 0) {
                    propertiesHTML += `
                        <div class="mb-4">
                            <h4 class="font-semibold text-gray-700 mb-2">الألوان المتاحة:</h4>
                            <div class="flex flex-wrap gap-2">
                                ${product.properties.colors.values.map(color => `
                                    <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">${color}</span>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }

                // المقاسات المتاحة
                if (product.properties.sizes?.enabled && product.properties.sizes.values?.length > 0) {
                    propertiesHTML += `
                        <div class="mb-4">
                            <h4 class="font-semibold text-gray-700 mb-2">المقاسات المتاحة:</h4>
                            <div class="flex flex-wrap gap-2">
                                ${product.properties.sizes.values.map(size => `
                                    <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm">${size}</span>
                                `).join('')}
                            </div>
                        </div>
                    `;
                }

                // معلومات التوصيل
                if (product.properties.shipping?.enabled) {
                    propertiesHTML += `
                        <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                            <h4 class="font-semibold text-blue-700 mb-2 flex items-center">
                                <i class="fas fa-truck ml-2"></i>معلومات التوصيل
                            </h4>
                            <div class="text-sm text-gray-700 space-y-1">
                                <div><strong>التكلفة:</strong> ${product.properties.shipping.free ? 'مجاني' : `${product.properties.shipping.cost} ${storeManager.settings.currency}`}</div>
                                ${product.properties.shipping.time ? `<div><strong>المدة:</strong> ${product.properties.shipping.time}</div>` : ''}
                                ${product.properties.shipping.details ? `<div><strong>التفاصيل:</strong> ${product.properties.shipping.details}</div>` : ''}
                            </div>
                        </div>
                    `;
                }

                // سياسة الإرجاع
                if (product.properties.return?.enabled) {
                    propertiesHTML += `
                        <div class="mb-4 p-3 bg-green-50 rounded-lg">
                            <h4 class="font-semibold text-green-700 mb-2 flex items-center">
                                <i class="fas fa-undo ml-2"></i>سياسة الإرجاع
                            </h4>
                            <div class="text-sm text-gray-700">
                                <div><strong>المدة:</strong> ${product.properties.return.days} يوم</div>
                                <div><strong>التكلفة:</strong> ${product.properties.return.free ? 'مجاني' : 'على حساب العميل'}</div>
                            </div>
                        </div>
                    `;
                }

                // معلومات الضمان
                if (product.properties.warranty?.enabled) {
                    propertiesHTML += `
                        <div class="mb-4 p-3 bg-yellow-50 rounded-lg">
                            <h4 class="font-semibold text-yellow-700 mb-2 flex items-center">
                                <i class="fas fa-shield-alt ml-2"></i>الضمان
                            </h4>
                            <div class="text-sm text-gray-700 space-y-1">
                                ${product.properties.warranty.period ? `<div><strong>المدة:</strong> ${product.properties.warranty.period}</div>` : ''}
                                ${product.properties.warranty.details ? `<div><strong>التفاصيل:</strong> ${product.properties.warranty.details}</div>` : ''}
                            </div>
                        </div>
                    `;
                }

                // المواصفات التقنية
                if (product.properties.specs?.enabled && product.properties.specs.details) {
                    const specs = product.properties.specs.details.split('\n').filter(spec => spec.trim());
                    if (specs.length > 0) {
                        propertiesHTML += `
                            <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                                <h4 class="font-semibold text-gray-700 mb-2 flex items-center">
                                    <i class="fas fa-cogs ml-2"></i>المواصفات التقنية
                                </h4>
                                <div class="text-sm text-gray-700 space-y-1">
                                    ${specs.map(spec => `<div>• ${spec}</div>`).join('')}
                                </div>
                            </div>
                        `;
                    }
                }
            }

            propertiesContainer.innerHTML = propertiesHTML;
        }

        // وظائف المفضلة العامة
        function closeWishlistModal() {
            const modal = document.getElementById('wishlistModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        function orderProductFromWishlist(productId) {
            const product = storeManager.products.find(p => p.id === productId);
            if (product && product.stock > 0) {
                closeWishlistModal();
                setTimeout(() => {
                    storeManager.showOrderModal(product);
                }, 300);
            }
        }

        function removeFromWishlist(productId) {
            storeManager.removeFromWishlist(productId);
        }

        function clearWishlist() {
            storeManager.clearWishlist();
        }

    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96f2bc169190ba9e',t:'MTc1NTE5ODQ0Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
